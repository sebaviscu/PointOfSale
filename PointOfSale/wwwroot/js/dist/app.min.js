let typeValuesGlobal=0,proveedoresListDashboard=[],tipoGastosListDashboard=[],tipoDeGasto="1",chartVentas,charGastosSueldos,charGastosProveedor,charGastos,charTipoVentas,chartVentasGlobal,charGastosProveedorGlobal,charGastosGlobal,visionGlobal=!1,gastoTotal=0,proveedorTotal=0,sueldoTotal=0,saleTotal=0,prueba_ver_si_lo_agarra=0,BASIC_MODEL_GASTO_DASHBOARD={idGastos:0,idTipoGasto:0,importe:0,comentario:null,idUsuario:0,modificationDate:null,modificationUser:"",estadoPago:0},BASIC_MODEL_PAGO_PROVEEDOR_DASHBOARD={idProveedor:0,tipoFactura:null,nroFactura:null,iva:0,ivaImporte:0,importe:0,importeSinIva:0,comentario:null,estadoPago:0,facturaPendiente:0};function changeChart(t){dateFilter=$("#txtDay").val(),typeValuesGlobal=t,LoadingText("show"),fetch(`/Admin/GetSummary?typeValues=${t}&dateFilter=${dateFilter}&visionGlobal=`+visionGlobal,{method:"GET"}).then(t=>(LoadingText("hide"),t.json())).then(t=>{t.state&&(t=t.object,$("#txtTotalSale").text("$ "+t.totalSales),saleTotal=t.totalSales,setGastosGanancia(),$("#txtCantidadClientes").text(t.cantidadClientes),$("#idTextFilter").text(t.textoFiltroDiaSemanaMes),SetGraficoVentas(t))}),SetTopSeler(typeValuesGlobal,$("#cboCategory").val()),SetTipoVentas(t,dateFilter),SetGraficoGastos(t,dateFilter),SetGraficoGastosProveedor(t,dateFilter),SetGraficoGastosSueldos(t,dateFilter),document.getElementById("divGraficosGlobales").style.display=visionGlobal?"":"none",visionGlobal&&(SetVentasByTiendas(t,dateFilter),SetProveedoresByTiendas(t,dateFilter),SetGastosByTiendas(t,dateFilter))}function LoadingText(t){$("#btnSearch").LoadingOverlay(t),$("#chartVentas").LoadingOverlay(t),$("#txtTotalSale").LoadingOverlay(t),$("#txtTotalGastos").LoadingOverlay(t),$("#txtCantidadClientes").LoadingOverlay(t),$("#txtGanancia").LoadingOverlay(t),$("#idTextFilter").LoadingOverlay(t)}function SetGraficoVentas(t){var e={series:[{name:t.actual,data:t.salesList},{name:t.anterior,data:t.salesListComparacion}],chart:{height:350,type:"line",dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1}},colors:["#2275ba","#c4c4c4"],dataLabels:{enabled:!0},stroke:{curve:"smooth"},title:{text:"Ventas",align:"left"},grid:{borderColor:"#e7e7e7",row:{colors:["#f3f3f3","transparent"],opacity:.5}},markers:{size:1},xaxis:{categories:t.ejeX,title:{text:t.ejeXLeyenda}},yaxis:{title:{text:"$"}},legend:{position:"top",horizontalAlign:"right",floating:!0,offsetY:-25,offsetX:-5}};chartVentas?chartVentas.updateOptions({series:[{name:t.actual,data:t.salesList},{name:t.anterior,data:t.salesListComparacion}],xaxis:{categories:t.ejeX,title:{text:t.ejeXLeyenda}}}):(chartVentas=new ApexCharts(document.querySelector("#chartVentas"),e)).render()}function SetTopSeler(t,e){null==e&&(e="Todo");let a=document.querySelector("#tableTopSeller");a.innerHTML="",$("#chartTopSeller").LoadingOverlay("show");var o=$("#txtDay").val();fetch(`/Admin/GetSalesByTypoVenta?typeValues=${t}&idCategoria=${e}&dateFilter=${o}&visionGlobal=`+visionGlobal,{method:"GET"}).then(t=>($("#chartTopSeller").LoadingOverlay("hide"),t.json())).then(t=>{var e;t.state?(e=t.object.map(t=>`<tr>
                       <td><h3 style="color: darkgray;">${t.product}&nbsp;</h3></td>
                       <td style="text-align: right;"><h4>&nbsp;${t.quantity}</h4></td>
                    </tr>`).join(""),a.innerHTML=e):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")}).catch(t=>{$("#chartTopSeller").LoadingOverlay("hide")})}function SetGraficoGastosSueldos(t,e){$("#charGastosSueldos").LoadingOverlay("show"),$("#gastosSueldosTexto").LoadingOverlay("show"),fetch(`/Admin/GetGastosSueldos?typeValues=${t}&dateFilter=${e}&visionGlobal=`+visionGlobal,{method:"GET"}).then(t=>($("#charGastosSueldos").LoadingOverlay("hide"),t.json())).then(t=>{var e;t.state?((e=t.object).gastosPorTipoSueldos,$("#gastosSueldosTexto").LoadingOverlay("hide"),$("#gastosSueldosTexto").text("$ "+e.gastosSueldosTexto),sueldoTotal=e.gastosSueldosTexto,setGastosGanancia()):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")})}function SetGraficoGastosProveedor(t,e){$("#charGastosProveedor").LoadingOverlay("show"),$("#gastosProvvedoresTexto").LoadingOverlay("show"),fetch(`/Admin/GetMovimientosProveedores?typeValues=${t}&dateFilter=${e}&visionGlobal=`+visionGlobal,{method:"GET"}).then(t=>($("#charGastosProveedor").LoadingOverlay("hide"),t.json())).then(t=>{var e,a;t.state?(e=(a=t.object).gastosPorTipoProveedor,$("#gastosProvvedoresTexto").LoadingOverlay("hide"),$("#gastosProvvedoresTexto").text("$ "+a.gastosProvvedoresTexto),proveedorTotal=a.gastosProvvedoresTexto,setGastosGanancia(),a={series:e.map(t=>t.total),chart:{type:"pie"},labels:e.map(t=>t.descripcion),responsive:[{breakpoint:480,options:{chart:{width:"100%"}}}],theme:{palette:"palette2"},title:{text:"Proveedores",align:"left",margin:10,offsetX:0,offsetY:0,floating:!1,style:{fontSize:"14px",fontWeight:"bold",fontFamily:void 0,color:"#263238"}}},charGastosProveedor?charGastosProveedor.updateOptions({series:e.map(t=>t.total),labels:e.map(t=>t.descripcion)}):(charGastosProveedor=new ApexCharts(document.querySelector("#charGastosProveedor"),a)).render()):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")})}function SetGraficoGastos(t,e){$("#charGastos").LoadingOverlay("show"),$("#gastoTexto").LoadingOverlay("show"),fetch(`/Admin/GetGastos?typeValues=${t}&dateFilter=${e}&visionGlobal=`+visionGlobal,{method:"GET"}).then(t=>($("#charGastos").LoadingOverlay("hide"),t.json())).then(t=>{var e,a;t.state?(e=(a=t.object).gastosPorTipo,$("#gastoTexto").LoadingOverlay("hide"),$("#gastoTexto").text("$ "+a.gastosTexto),gastoTotal=a.gastosTexto,setGastosGanancia(),a={series:e.map(t=>t.total),chart:{type:"pie"},labels:e.map(t=>t.descripcion),responsive:[{breakpoint:480,options:{chart:{width:"100%"}}}],theme:{palette:"palette10"},title:{text:"Gastos Particulares",align:"left",margin:10,offsetX:0,offsetY:0,floating:!1,style:{fontSize:"14px",fontWeight:"bold",fontFamily:void 0,color:"#263238"}}},charGastos?charGastos.updateOptions({series:e.map(t=>t.total),labels:e.map(t=>t.descripcion)}):(charGastos=new ApexCharts(document.querySelector("#charGastos"),a)).render()):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")})}function SetTipoVentas(t,e){$("#charTipoVentas").LoadingOverlay("show"),fetch(`/Admin/GetSalesByTypoVentaByGrafico?typeValues=${t}&dateFilter=${e}&visionGlobal=`+visionGlobal,{method:"GET"}).then(t=>($("#charTipoVentas").LoadingOverlay("hide"),t.json())).then(t=>{var e,a;t.state?(a={series:(e=t.object.ventasPorTipoVenta).map(t=>t.total),chart:{type:"pie"},labels:e.map(t=>t.descripcion),responsive:[{breakpoint:480,options:{chart:{width:"100%"}}}],title:{text:"Ventas",align:"left",margin:10,offsetX:0,offsetY:0,floating:!1,style:{fontSize:"14px",fontWeight:"bold",fontFamily:void 0,color:"#263238"}}},charTipoVentas?charTipoVentas.updateOptions({series:e.map(t=>t.total),labels:e.map(t=>t.descripcion)}):(charTipoVentas=new ApexCharts(document.querySelector("#charTipoVentas"),a)).render()):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")})}function SetVentasByTiendas(t,e){$("#charTipoVentasGlobal").LoadingOverlay("show"),fetch(`/Admin/GetSalesByTypoVentaByTienda?typeValues=${t}&dateFilter=`+e,{method:"GET"}).then(t=>($("#charTipoVentasGlobal").LoadingOverlay("hide"),t.json())).then(t=>{var e,a;t.state?(a={series:(e=t.object.gastosPorTipo).map(t=>t.total),chart:{type:"pie"},labels:e.map(t=>t.descripcion),responsive:[{breakpoint:480,options:{chart:{width:"100%"}}}],theme:{palette:"palette7"},title:{text:"Ventas",align:"left",margin:10,offsetX:0,offsetY:0,floating:!1,style:{fontSize:"14px",fontWeight:"bold",fontFamily:void 0,color:"#263238"}}},chartVentasGlobal?chartVentasGlobal.updateOptions({series:e.map(t=>t.total),labels:e.map(t=>t.descripcion)}):(chartVentasGlobal=new ApexCharts(document.querySelector("#charTipoVentasGlobal"),a)).render()):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")})}function SetProveedoresByTiendas(t,e){$("#charGastosProveedorGlobal").LoadingOverlay("show"),fetch(`/Admin/GetMovimientosProveedoresByTienda?typeValues=${t}&dateFilter=`+e,{method:"GET"}).then(t=>($("#charGastosProveedorGlobal").LoadingOverlay("hide"),t.json())).then(t=>{var e,a;t.state?(a={series:(e=t.object.gastosPorTipo).map(t=>t.total),chart:{type:"pie"},labels:e.map(t=>t.descripcion),responsive:[{breakpoint:480,options:{chart:{width:"100%"}}}],theme:{palette:"palette7"},title:{text:"Proveedores",align:"left",margin:10,offsetX:0,offsetY:0,floating:!1,style:{fontSize:"14px",fontWeight:"bold",fontFamily:void 0,color:"#263238"}}},charGastosProveedorGlobal?charGastosProveedorGlobal.updateOptions({series:e.map(t=>t.total),labels:e.map(t=>t.descripcion)}):(charGastosProveedorGlobal=new ApexCharts(document.querySelector("#charGastosProveedorGlobal"),a)).render()):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")})}function SetGastosByTiendas(t,e){$("#charGastosGlobal").LoadingOverlay("show"),fetch(`/Admin/GetGastosByTienda?typeValues=${t}&dateFilter=`+e,{method:"GET"}).then(t=>($("#charGastosGlobal").LoadingOverlay("hide"),t.json())).then(t=>{var e,a;t.state?(a={series:(e=t.object.gastosPorTipo).map(t=>t.total),chart:{type:"pie"},labels:e.map(t=>t.descripcion),responsive:[{breakpoint:480,options:{chart:{width:"100%"}}}],theme:{palette:"palette7"},title:{text:"Gastos Particulares",align:"left",margin:10,offsetX:0,offsetY:0,floating:!1,style:{fontSize:"14px",fontWeight:"bold",fontFamily:void 0,color:"#263238"}}},charGastosGlobal?charGastosGlobal.updateOptions({series:e.map(t=>t.total),labels:e.map(t=>t.descripcion)}):(charGastosGlobal=new ApexCharts(document.querySelector("#charGastosGlobal"),a)).render()):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")})}function calcularIva(){var t=$("#txtImporte").val(),t=parseFloat(""==t?0:t),e=parseFloat($("#txtIva").val());isNaN(t)||isNaN(e)||(e=t-(t=t/(1+e/100)),$("#txtImporteSinIva").val(t.toFixed(2)),$("#txtImporteIva").val(e.toFixed(2)))}function setGastosGanancia(){var t=parseFloat(parseFloat(gastoTotal)+parseFloat(proveedorTotal)+parseFloat(sueldoTotal));$("#txtTotalGastos").text("$ "+t.toFixed(0)),$("#txtGanancia").text("$ "+(parseFloat(saleTotal)-t).toFixed(0))}$(document).ready(function(){fetch("/Tienda/GetTienda").then(t=>t.json()).then(t=>{document.getElementById("divSwitchVisionGlobal").style.display=null!=t.data&&1<t.data.length?"":"none"}),fetch("/Gastos/GetTipoDeGasto").then(t=>t.json()).then(t=>{t.state?0<t.object.length&&(tipoGastosListDashboard=t.object,t.object.forEach(t=>{$("#cboTipoDeGastoEnGasto").append($("<option>").val(t.idTipoGastos).text(t.descripcion))})):swal("Lo sentimos",t.message,"error")}),fetch("/Access/GetAllUsers").then(t=>t.json()).then(t=>{t.state?0<t.object.length&&(tipoGastosListDashboard=t.object,t.object.forEach(t=>{$("#cboUsuario").append($("<option>").val(t.idUsers).text(t.name))})):swal("Lo sentimos",t.message,"error")}),fetch("/Admin/GetProveedores").then(t=>t.json()).then(t=>{0<t.data.length&&(proveedoresListDashboard=t.data,t.data.forEach(t=>{$("#cboProveedor").append($("<option>").val(t.idProveedor).text(t.nombre))}))}),fetch("/Inventory/GetCategories").then(t=>t.json()).then(t=>{$("#cboCategory").append($("<option>").val("Todo").text("Todo")),0<t.data.length&&t.data.forEach(t=>{$("#cboCategory").append($("<option>").val(t.description).text(t.description))})}),$("#txtDay").datepicker(),changeChart(1)}),$("#switchVisionGlobal").change(function(){visionGlobal=$(this).is(":checked"),changeChart(typeValuesGlobal)}),$("#btnSearch").click(function(){""==$("#txtDay").val().trim()?toastr.warning("","Debes ingresar una fecha."):changeChart(typeValuesGlobal)}),$("#cboCategory").change(function(){SetTopSeler(typeValuesGlobal,$(this).val())}),$("#cboTipoDeGastoEnGasto").change(function(){let e=$(this).val();var t=tipoGastosListDashboard.find(t=>t.idTipoGastos==e);null!=t?($("#txtGasto").val(t.gastoParticular),$("#txtIva").val(t.iva??""),$("#cboTipoFactura").val(t.tipoFactura??"")):($("#txtGasto").val(""),$("#txtIva").val(""),$("#cboTipoFactura").val(""))}),$("#cboTipoDePago").change(function(){tipoDeGasto=$(this).val(),$("#txtImporte").val(""),$("#txtIva").val(""),$("#txtImporteSinIva").val(""),$("#txtImporteIva").val(""),"1"==tipoDeGasto?($(".pago-gasto").show(),$(".pago-proveedor").hide()):($(".pago-gasto").hide(),$(".pago-proveedor").show())}),$("#cboProveedor").change(function(){let e=$(this).val();var t=proveedoresListDashboard.find(t=>t.idProveedor==e);$("#txtImporte").val(""),$("#txtIva").val(""),$("#txtImporteSinIva").val(""),$("#txtImporteIva").val(""),null!=t?($("#txtCuilPago").val(t.cuil),$("#txtDireccionPago").val(t.direccion),$("#txtIva").val(null!=t.iva?t.iva:""),$("#cboTipoFactura").val(t.tipoFactura??"")):($("#txtCuilPago").val(""),$("#txtDireccionPago").val(""),$("#txtIva").val(""),$("#cboTipoFactura").val("")),calcularIva()}),$("#btnNuevoGasto").on("click",function(){$("#modalNuevoGasto").modal("show"),$("#cboTipoDeGastoEnGasto").val(""),$("#txtImporte").val(""),$("#txtComentario").val(""),$("#cboUsuario").val(""),$("#cboTipoFactura").val(""),$("#txtNroFactura").val(""),$("#txtIva").val(""),$("#txtImporteIva").val(""),$("#txtImporteSinIva").val(""),$("#txtCuilPago").val(""),$("#txtDireccionPago").val("")}),$("#btnSavePagoProveedor").on("click",function(){let e,a;if(showLoading(),"1"==tipoDeGasto){e="/Gastos/CreateGastos";let t=!0;if($(".input-validate-gasto").each(function(){t=""!=$(this).val().trim()&&t}),!(t=""==$("#txtImporte").val().trim()?!1:t))return void toastr.warning("Debe completar todos los campos obligatorios","");(a=structuredClone(BASIC_MODEL_GASTO_DASHBOARD)).idGastos=0,a.idTipoGasto=$("#cboTipoDeGastoEnGasto").val(),a.importe=$("#txtImporte").val(),a.comentario=$("#txtComentario").val(),a.idUsuario=0!=$("#cboUsuario").val()?$("#cboUsuario").val():null,a.tipoFactura=$("#cboTipoFactura").val(),a.nroFactura=$("#txtNroFactura").val(),a.iva=""!=$("#txtIva").val()?$("#txtIva").val():0,a.ivaImporte=""!=$("#txtImporteIva").val()?$("#txtImporteIva").val():0,a.importeSinIva=""!=$("#txtImporteSinIva").val()?$("#txtImporteSinIva").val():0}else{e="/Admin/RegistrarPagoProveedor";var t,o=$(".input-validate-proveedor").serializeArray().filter(t=>""==t.value.trim());if(0<o.length)return t=`Debe completar los campos : "${o[0].name}"`,toastr.warning(t,""),void $(`input[name="${o[0].name}"]`).focus();if(""==$("#cboProveedor").val())return void toastr.warning("Debe completar el campo del Proveedor","");(a=structuredClone(BASIC_MODEL_PAGO_PROVEEDOR_DASHBOARD)).idProveedor=parseInt($("#cboProveedor").val()),a.tipoFactura=$("#cboTipoFactura").val(),a.nroFactura=$("#txtNroFactura").val(),a.iva=""!=$("#txtIva").val()?$("#txtIva").val():0,a.ivaImporte=""!=$("#txtImporteIva").val()?$("#txtImporteIva").val():0,a.importe=$("#txtImporte").val(),a.importeSinIva=""!=$("#txtImporteSinIva").val()?$("#txtImporteSinIva").val():0,a.comentario=$("#txtComentario").val()}a.estadoPago=parseInt($("#cboEstado").val()),a.facturaPendiente=document.querySelector("#cbxFacturaPendiente").checked,$("#modalNuevoGasto").modal("hide"),fetch(e,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(a)}).then(t=>(removeLoading(),t.json())).then(t=>{t.state?(swal("Exitoso!","Se registró con éxito","success"),SetGraficoGastosProveedor(typeValuesGlobal,""),SetGraficoGastos(typeValuesGlobal,""),SetGraficoGastosSueldos(typeValuesGlobal,"")):swal("Lo sentimos",t.message,"error")})}),$("#txtIva").change(function(){calcularIva()}),$("#txtImporte").keyup(function(){calcularIva()});let tableDataUsers,rowSelectedUser,BASIC_MODEL_USER={idUsers:0,name:"",email:"",phone:"",idRol:0,password:"",isActive:1,photo:"",idTienda:0,tiendaName:"",modificationDate:"",modificationUser:null},openModalUser=($(document).ready(function(){fetch("/Admin/GetRoles").then(t=>t.json()).then(t=>{t.state?0<t.object.length&&t.object.forEach(t=>{$("#cboRol").append($("<option>").val(t.idRol).text(t.description))}):swal("Lo sentimos","Se ha producido un error: "+t.message,"error")}),fetch("/Tienda/GetTienda").then(t=>t.json()).then(t=>{$("#cboTiendas").append($("<option>").val("-1").text(" ")),0<t.data.length&&t.data.forEach(t=>{$("#cboTiendas").append($("<option>").val(t.idTienda).text(t.nombre))})}),tableDataUsers=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Admin/GetUsers",type:"GET",datatype:"json"},columns:[{data:"idUsers",visible:!1,searchable:!1},{data:"name"},{data:"email"},{data:"phone"},{data:"nameRol"},{data:"tiendaName"},{data:"isActive",render:function(t){return 1==t?'<span class="badge badge-info">Activo</span>':'<span class="badge badge-danger">Inactivo</span>'}},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"100px"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Report Users",exportOptions:{columns:[1,2,3,4,5,6]}},"pageLength"]});let t=$("#txtPassWord");var e=$("#togglePassword");e.on("mousedown",function(){t.attr("type","text")}),e.on("mouseup mouseleave",function(){t.attr("type","password")}),e.on("click",function(t){t.preventDefault()})}),(t=BASIC_MODEL_USER)=>{var e=0==t.idRol?$("#cboRol option:first").val():t.idRol,a=0==t.idTienda?$("#cboTiendas option:first").val():t.idTienda;$("#txtId").val(t.idUsers),$("#txtName").val(t.name),$("#txtEmail").val(t.email),$("#txtPhone").val(t.phone),$("#cboRol").val(e),$("#cboState").val(t.isActive),$("#txtPassWord").val(t.password),$("#cboTiendas").val(a),$("#cboTiendas").prop("disabled","1"==e),null==t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",a=new Date(t.modificationDate),$("#txtModificado").val(a.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#modalData").modal("show")}),BASIC_MODEL_AJUSTE=($("#btnNewUser").on("click",function(){openModalUser()}),$("#cboRol").change(function(){var t=$(this).val();$("#cboTiendas").val("1"==t?"":null),$("#cboTiendas").prop("disabled","1"==t)}),$("#btnSave").on("click",function(){var t,e,a=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<a.length?(e=`Debe completar los campos : "${a[0].name}"`,toastr.warning(e,""),$(`input[name="${a[0].name}"]`).focus()):(e=$("#cboRol").val(),a=$("#cboTiendas").val(),"1"==e||"-1"!=a&&null!=a?"1"==e&&"-1"!=a&&null!=a?toastr.warning("No se debe seleccionar tienda para un Administrador",""):((t=structuredClone(BASIC_MODEL_USER)).idUsers=parseInt($("#txtId").val()),t.name=$("#txtName").val(),t.email=$("#txtEmail").val(),t.phone=$("#txtPhone").val(),t.idRol=e,t.isActive=$("#cboState").val(),t.idTienda=a,t.password=$("#txtPassWord").val(),(e=new FormData).append("model",JSON.stringify(t)),$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idUsers?fetch("/Admin/CreateUser",{method:"POST",body:e}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataUsers.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","El usuario fué creado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Admin/UpdateUser",{method:"PUT",body:e}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataUsers.row(rowSelectedUser).data(t.object).draw(!1),rowSelectedUser=null,$("#modalData").modal("hide"),swal("Exitoso!","El usuario fué modificado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")})):toastr.warning("Se debe seleccionar una tienda",""))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedUser=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataUsers.row(rowSelectedUser).data();showLoading(),fetch("/Admin/GetUser?idUser="+t.idUsers).then(t=>t.json()).then(t=>{removeLoading(),t.state?openModalUser(t.object):swal("Lo sentimos",t.message,"error")})}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataUsers.row(e).data());swal({title:"¿Estas seguro?",text:`Que desea eliminar el usuario "${a.name}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/DeleteUser?IdUser="+a.idUsers,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataUsers.row(e).remove().draw(),swal("Exitoso!","El usuario fué eliminado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),{idAjuste:0,modificationDate:null,modificationUser:null,codigoSeguridad:"",imprimirDefault:!1,controlStock:!1,nombreTiendaTicket:"",nombreImpresora:"",minimoIdentificarConsumidor:0,facturaElectronica:!1,controlEmpleado:!1}),BASIC_MODEL_AJUSTE_WEB={idAjusteWeb:0,montoEnvioGratis:0,aumentoWeb:0,whatsapp:"",lunes:"",martes:"",miercoles:"",jueves:"",viernes:"",sabado:"",domingo:"",feriado:"",facebook:"",instagram:"",twitter:"",tiktok:"",youtube:""},BASIC_MODEL_AJUSTES_FACTURACION={idAjustesFacturacion:0,logo:"",cuit:0,condicionIva:null,puntoVenta:0,certificadoFechaInicio:null,certificadoFechaCaducidad:null,certificadoPassword:"",certificadoNombre:"",nombreTitular:"",ingresosBurutosNro:"",direccionFacturacion:""},isHealthyAjustes=!1;async function healthcheck(){(isHealthyAjustes=await getHealthcheck())?(getPrintersTienda(),document.getElementById("lblErrorPrintService").style.display="none"):document.getElementById("lblErrorPrintService").style.display=""}async function getPrintersTienda(){try{(await getPrinters()).forEach(t=>{$("#cboNombreImpresora").append($("<option>").val(t).text(t))})}catch(t){console.error("Error fetching printers:",t)}}function formatDateToDDMMYYYY(t){return null==t?"":(t=new Date(t)).getDate().toString().padStart(2,"0")+`/${(t.getMonth()+1).toString().padStart(2,"0")}/`+t.getFullYear()}$(document).ready(function(){showLoading(),fetch("/Admin/GetAjuste").then(t=>t.json()).then(t=>{var e,a;t.state?(e=t.object,$("#txtId").val(e.idAjuste),$("#txtCodigoSeguridad").val(e.codigoSeguridad),$("#txtNombreTiendaTicket").val(e.nombreTiendaTicket),$("#txtMinimoIdentificarConsumidor").val(e.minimoIdentificarConsumidor),$("#cboNombreImpresora").val(e.nombreImpresora),document.getElementById("switchImprimirDefault").checked=e.imprimirDefault,document.getElementById("switchControlStock").checked=e.controlStock,document.getElementById("switchFacturaElectronica").checked=e.facturaElectronica,document.getElementById("switchControlEmpleado").checked=e.controlEmpleado,null==e.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",a=new Date(e.modificationDate),$("#txtModificado").val(a.toLocaleString()),$("#txtModificadoUsuario").val(e.modificationUser))):swal("Lo sentimos",t.message,"error")}),fetch("/Admin/GetAjusteWeb").then(t=>t.json()).then(t=>{var e;t.state?(e=t.object,$("#txtNombreTienda").val(e.nombre),$("#txtDireccion").val(e.direccion),$("#txtEnvioGratis").val(e.montoEnvioGratis),$("#txtAumento").val(e.aumentoWeb),$("#txtWhatsApp").val(e.whatsapp),$("#txtLunes").val(e.lunes),$("#txtMartes").val(e.martes),$("#txtMiercoles").val(e.miercoles),$("#txtJueves").val(e.jueves),$("#txtViernes").val(e.viernes),$("#txtSabado").val(e.sabado),$("#txtDomingo").val(e.domingo),$("#txtFeriados").val(e.feriado),$("#txtFacebook").val(e.facebook),$("#txtInstagram").val(e.instagram),$("#txtTikTok").val(e.tiktok),$("#txtTwitter").val(e.twitter),$("#txtYouTube").val(e.youtube)):swal("Lo sentimos",t.message,"error")}),fetch("/Admin/GetAjustesFacturacion").then(t=>t.json()).then(t=>{var e;t.state?(e=t.object,$("#txtIdAjustesFacturacion").val(e.idAjustesFacturacion),$("#cboCondicionIva").val(e.condicionIva),$("#txtPuntoVentaCertificado").val(e.puntoVenta),$("#txtContraseñaCertificado").val(e.certificadoPassword),$("#txtFechaIniCert").val(formatDateToDDMMYYYY(e.certificadoFechaInicio)),$("#txtFechaCadCert").val(formatDateToDDMMYYYY(e.certificadoFechaCaducidad)),$("#txtCuilCertificado").val(e.cuit),$("#txtNombreArchivo").val(e.certificadoNombre),$("#txtNombreTitular").val(e.nombreTitular),$("#txtIIBB").val(e.ingresosBurutosNro),$("#txtDireccionFacturacion").val(e.direccionFacturacion),null!=e.fechaInicioActividad&&(e=e.fechaInicioActividad.split("T")[0],$("#txtInicioActividad").val(e)),removeLoading()):swal("Lo sentimos",t.message,"error")}),setupPasswordToggle($("#txtCodigoSeguridad"),$("#togglePassword")),setupPasswordToggle($("#txtContraseñaCertificado"),$("#togglePasswordCert")),healthcheck()}),$("#btnCargarCertificado").on("click",function(){var t,e,a=$("#txtContraseñaCertificado").val();""==a.trim()?toastr.warning("Debe completar la contraseña para poder cargar la informacion del certificado.",""):0==(t=document.getElementById("fileCertificado")).files.length?toastr.warning("Debe buscar un certificado.",""):((e=new FormData).append("Certificado",t.files[0]),e.append("password",a),showLoading(),fetch("/Admin/UpdateCertificateInformation",{method:"PUT",body:e}).then(t=>(removeLoading(),t.json())).then(t=>{var e;t.state?(e=t.object,$("#txtFechaIniCert").val(formatDateToDDMMYYYY(e.certificadoFechaInicio)),$("#txtFechaCadCert").val(formatDateToDDMMYYYY(e.certificadoFechaCaducidad)),$("#txtCuilCertificado").val(e.cuit),$("#txtNombreArchivo").val(e.certificadoNombre),swal("Exitoso!","Certificado cargado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{}))}),$("#btnSave").on("click",function(){var t=document.getElementById("switchFacturaElectronica");if(t.checked&&0<$("input.input-validate-facturacion").serializeArray().filter(t=>""==t.value.trim()).length)return void toastr.warning("Si selecciona FACTURA ELECTRONICA, debe completar todos los campos de la sección Facturacion.","");var e=structuredClone(BASIC_MODEL_AJUSTE_WEB),a=(e.montoEnvioGratis=$("#txtEnvioGratis").val(),e.aumentoWeb=$("#txtAumento").val(),e.whatsapp=$("#txtWhatsApp").val(),e.lunes=$("#txtLunes").val(),e.martes=$("#txtMartes").val(),e.miercoles=$("#txtMiercoles").val(),e.jueves=$("#txtJueves").val(),e.viernes=$("#txtViernes").val(),e.sabado=$("#txtSabado").val(),e.domingo=$("#txtDomingo").val(),e.feriado=$("#txtFeriados").val(),e.facebook=$("#txtFacebook").val(),e.instagram=$("#txtInstagram").val(),e.tiktok=$("#txtTikTok").val(),e.twitter=$("#txtTwitter").val(),e.youtube=$("#txtYouTube").val(),e.nombre=$("#txtNombreTienda").val(),e.direccion=$("#txtDireccion").val(),structuredClone(BASIC_MODEL_AJUSTE)),o=(a.idAjuste=parseInt($("#txtId").val()),document.getElementById("switchImprimirDefault")),o=(a.imprimirDefault=o.checked,document.getElementById("switchControlStock")),o=(a.controlStock=o.checked,document.getElementById("switchControlEmpleado")),o=(a.controlEmpleado=o.checked,a.facturaElectronica=t.checked,a.codigoSeguridad=$("#txtCodigoSeguridad").val(),a.nombreTiendaTicket=$("#txtNombreTiendaTicket").val(),a.minimoIdentificarConsumidor=$("#txtMinimoIdentificarConsumidor").val(),a.nombreImpresora=$("#cboNombreImpresora").val(),structuredClone(BASIC_MODEL_AJUSTES_FACTURACION)),t=(o.idAjustesFacturacion=parseInt($("#txtIdAjustesFacturacion").val()),o.puntoVenta=parseInt($("#txtPuntoVentaCertificado").val()),o.condicionIva=parseInt($("#cboCondicionIva").val()),o.nombreTitular=$("#txtNombreTitular").val(),o.ingresosBurutosNro=$("#txtIIBB").val(),o.direccionFacturacion=$("#txtDireccionFacturacion").val(),o.fechaInicioActividad=$("#txtInicioActividad").val(),o.certificadoPassword=$("#txtContraseñaCertificado").val(),document.getElementById("fileCertificado")),i=new FormData;i.append("modelWeb",JSON.stringify(e)),i.append("modelFacturacion",JSON.stringify(o)),i.append("modelAjustes",JSON.stringify(a)),i.append("Certificado",t.files[0]),showLoading(),fetch("/Admin/UpdateAjuste",{method:"PUT",body:i}).then(t=>(removeLoading(),t.json())).then(t=>{t.state?(swal("Exitoso!","Ajustes fué modificado","success"),location.reload()):swal("Lo sentimos",t.message,"error")}).catch(t=>{})});let tableDataClients,tableDataMovimientosClientes,rowSelectedClient,BASIC_MODEL_CLIENTE={idCliente:0,nombre:"",cuil:null,telefono:null,direccion:null,comentario:null,condicionIva:null,isActive:!0,registrationDate:null,modificationDate:null,modificationUser:null};function validateCuil(){$("#txtCuil").on("input",function(){var t=formatCuil($(this).val());$(this).val(t)}),$("#txtCuil").on("keypress",function(t){var e=t.which||t.keyCode;(e<48||57<e)&&t.preventDefault()}),$("#txtCuil").on("blur",function(){11!==$(this).val().replace(/\D/g,"").length&&alert("El CUIL debe tener exactamente 11 dígitos.")})}function formatCuil(t){if(null==t)return"";let e="";return 0<(t=t.replace(/\D/g,"")).length&&(e+=t.substring(0,2)),2<t.length&&(e+="-"+t.substring(2,10)),10<t.length&&(e+="-"+t.substring(10,11)),e}$(document).ready(function(){fetch("/Sales/ListTypeDocumentSale").then(t=>t.json()).then(t=>{$("#cboTypeDocumentSale").append($("<option>").val("").text("")),0<t.state?0<t.object.length&&t.object.forEach(t=>{$("#cboTypeDocumentSale").append($("<option>").val(t.idTypeDocumentSale).text(t.description))}):swal("Lo sentimos",t.message,"error")}),tableDataClients=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Admin/GetCliente",type:"GET",datatype:"json"},columns:[{data:"idCliente",visible:!1,searchable:!1},{data:"nombre"},{data:"cuil"},{data:"telefono"},{data:"isActive",render:function(t){return 1==t?'<span class="badge badge-info">Activo</span>':'<span class="badge badge-danger">Inactivo</span>'}},{data:"total"},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"100px"}],order:[[1,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Clientes",exportOptions:{columns:[1,2,3,4]}},"pageLength"]}),validateCuil()});let openModalCliente=(t=BASIC_MODEL_CLIENTE)=>{$("#txtId").val(t.idCliente),$("#txtNombre").val(t.nombre),$("#txtCuil").val(formatCuil(t.cuil)),$("#txtDireccion").val(t.direccion),$("#txtTelefono").val(t.telefono),$("#txtTotal").val(t.total),$("#txtComentario").val(t.comenario),$("#cboCondicionIva").val(t.condicionIva),$("#cboEstado").val(t.isActive?1:0),null==t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),null!=tableDataMovimientosClientes&&tableDataMovimientosClientes.destroy();var e="/Admin/GetMovimientoCliente?idCliente="+t.idCliente;tableDataMovimientosClientes=$("#tbMovimientos").DataTable({responsive:!0,pageLength:5,ajax:{url:e,type:"GET",datatype:"json"},columnDefs:[{targets:[3],render:function(t,e,a){return"display"==e||"filter"==e?t?moment(t).format("DD/MM/YYYY HH:mm"):"":t}}],columns:[{data:"idClienteMovimiento",visible:!1,searchable:!1},{data:"totalString"},{data:"sale.saleNumber"},{data:"registrationDate"},{data:"registrationUser"},{data:"idSale",visible:!1,searchable:!1},{defaultContent:'<button class="btn btn-primary btn-open-sale btn-sm me-2"><i class="mdi mdi-eye"></i></button>',orderable:!1,searchable:!1,width:"40px"}],order:[[3,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Clientes",exportOptions:{columns:[1,2]}},"pageLength"]}),$("#modalData").modal("show")};$("#btnNew").on("click",function(){openModalCliente()}),$("#btnSave").on("click",function(){var t,e=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):((t=structuredClone(BASIC_MODEL_CLIENTE)).nombre=$("#txtNombre").val(),t.direccion=$("#txtDireccion").val(),t.cuil=""!=$("#txtCuil").val()?$("#txtCuil").val().replace(/-/g,""):null,t.telefono=$("#txtTelefono").val(),t.idCliente=$("#txtId").val(),t.comentario=$("#txtComentario").val(),t.condicionIva=$("#cboCondicionIva").val(),t.isActive=1==$("#cboEstado").val(),$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idCliente?fetch("/Admin/CreateCliente",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataClients.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","Cliente fué creada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Admin/UpdateCliente",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataClients.row(rowSelectedClient).data(t.object).draw(!1),rowSelectedClient=null,$("#modalData").modal("hide"),swal("Exitoso!","Cliente fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedClient=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataClients.row(rowSelectedClient).data();openModalCliente(t)}),$("#tbMovimientos tbody").on("click","button.btn-open-sale",function(t){t.preventDefault();t=tableDataMovimientosClientes.row($(this).parents("tr")).data().sale.saleNumber,t="/Sales/ReportSale?saleNumber="+encodeURIComponent(t);window.open(t,"_blank")}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataClients.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar Cliente "${a.nombre}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/DeleteCliente?idCliente="+a.idCliente,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataClients.row(e).remove().draw(),swal("Exitoso!","Cliente  fué eliminada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),$(document).on("click","button.finalizeSale",function(){var t;""==document.getElementById("cboTypeDocumentSale").value?toastr.warning("Debe completaro el campo Tipo de Venta",""):""==document.getElementById("txtImporte").value?toastr.warning("Debe completaro el campo Importe",""):(t={idTypeDocumentSale:$("#cboTypeDocumentSale").val(),clientId:$("#txtId").val(),total:$("#txtImporte").val(),tipoMovimiento:1},$("#btnFinalizeSale").closest("div.card-body").LoadingOverlay("show"),fetch("/Sales/RegisterSale",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#btnFinalizeSale").closest("div.card-body").LoadingOverlay("hide"),t.json())).then(t=>{t.state?($("#cboTypeDocumentSale").val($("#cboTypeDocumentSale option:first").val()),swal("Registrado!","success")):swal("Lo sentimos","La venta no fué registrada","error")}).catch(t=>{$("#btnFinalizeSale").closest("div.card-body").LoadingOverlay("hide")}))});let tableDataFactura,rowSelectedFactura,url_qr=null,BASIC_MODEL_FACTURACION={idFacturaEmitida:0,cae:"",caeVencimiento:"",fechaEmicion:"",nroDocumento:"",tipoDocumento:"",resultado:"",observaciones:"",registrationDate:"",registrationUser:"",nroFacturaString:"",puntoVentaString:"",tipoFactura:"",importeTotal:0,importeNeto:0,importeIVA:0,qr:"",sale:null,cliente:null},openModalFactura=($(document).ready(function(){tableDataFactura=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Admin/GetFacturas",type:"GET",datatype:"json"},columnDefs:[{targets:[1],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY HH:mm"):"":t}},{targets:[7],render:function(t,e,a){return"display"===e||"filter"===e?t&&"0001-01-01T00:00:00"!=t?moment(t).format("DD/MM/YYYY"):"":t}}],columns:[{data:"idFacturaEmitida",visible:!1,searchable:!1},{data:"registrationDate"},{data:"tipoFactura",render:function(t,e,a){let o="";return t+" "+(o=null!=a.observaciones?"A"!=a.resultado?' <span class="badge rounded-pill bg-danger"> ERROR </span>':' <span class="badge rounded-pill bg-info"> Obs </span>':o)}},{data:"nroFacturaString",render:function(t,e,a){return""!=t?a.puntoVentaString+`-${t} `:""}},{data:"sale.typeDocumentSale"},{data:"importeTotal",render:function(t,e,a){return"$ "+t}},{data:"cae"},{data:"caeVencimiento"},{defaultContent:'<button class="btn btn-primary btn-ver btn-sm me-2"><i class="mdi mdi-eye"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[1,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Formas de Pago",exportOptions:{columns:[1,2]}},"pageLength"]})}),(t=BASIC_MODEL_FACTURACION)=>{var e;url_qr=null,$("#txtIdFacturacion").val(t.idFacturaEmitida),$("#txtFechaEmision").val(moment(t.registrationDate).format("DD/MM/YYYY HH:mm")),$("#txtTipoFactura").val(t.tipoFactura),$("#txtNumeroFactura").val(t.nroFacturaString),$("#txtFormaPago").val(t.sale.typeDocumentSale),$("#txtImporteTotal").val(t.importeTotal),$("#txtImporteNeto").val(t.importeNeto),$("#txtImporteIva").val(t.importeIVA),$("#txtCae").val(t.cae),$("#txtVencimientoCae").val(moment(t.caeVencimiento).format("DD/MM/YYYY")),$("#txtRegistrationUser").val(t.registrationUser),$("#txtPuntoVenta").val(t.puntoVentaString),$("#txtCuil").val(t.tipoDocumento+": "+t.nroDocumento),$("#btnVerVenta").attr("sale-number",t.sale.saleNumber),null!=t.observaciones?((e=document.getElementById("divError")).style.display="","A"===t.resultado?(e.className="alert alert-warning d-flex align-items-center",document.getElementById("alertTitle").textContent="ALERTA: "):(e.className="alert alert-danger d-flex align-items-center",document.getElementById("alertTitle").textContent="ERROR: "),$("#txtError").text(t.observaciones),e.classList.add("d-flex")):($("#txtError").text(""),document.getElementById("alertTitle").textContent="",(e=document.getElementById("divError")).classList.remove("d-flex"),e.style.display="none",""!=t.qr&&(url_qr=t.qr)),$("#modalData").modal("show")});$("#tbData tbody").on("click",".btn-ver",function(){rowSelectedFactura=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataFactura.row(rowSelectedFactura).data();showLoading(),fetch("/Admin/GetFactura?idFacturaEmitida="+t.idFacturaEmitida).then(t=>t.json()).then(t=>{removeLoading(),t.state?openModalFactura(t.object):swal("Lo sentimos",t.message,"error")})}),$("#btnVerVenta").on("click",function(){var t=$(this).attr("sale-number"),t="/Sales/ReportSale?saleNumber="+encodeURIComponent(t);window.open(t,"_blank")}),$("#bntAfip").on("click",function(){null!=url_qr&&window.open(url_qr,"_blank")}),$("#btnConfiguracion").on("click",function(){showLoading(),fetch("/Admin/GetAjustesFacturacion").then(t=>t.json()).then(t=>{removeLoading(),t.state?openModalAjustesFacturacion(t.object):swal("Lo sentimos",t.message,"error")})});let tableDataGastos,rowSelectedGastos,tipoGastosList=[],monthNames=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],BASIC_MODEL_GASTO={idGastos:0,idTipoGasto:0,importe:0,comentario:null,idUsuario:0,modificationDate:null,modificationUser:"",estadoPago:0},BASIC_MODEL_TIPO_DE_GASTOS={IdTipoGastos:0,gastoParticular:-1,descripcion:""};function cargarTablaGastos(t){t="/Gastos/GetGastos?visionGlobal="+t;tableDataGastos=$("#tbData").DataTable({responsive:!0,rowCallback:function(t,e){1==e.facturaPendiente&&$("td:eq(2)",t).addClass("factura-pendiente")},ajax:{url:t,type:"GET",datatype:"json"},columns:[{data:"idGastos",visible:!1,searchable:!1},{data:"tipoGastoString"},{data:"gastoParticular"},{data:"nroFactura"},{data:"fechaString"},{data:"comentario"},{data:"estadoPago",className:"text-center",render:function(t){return 0==t?'<span class="badge rounded-pill bg-success">Pagado</span>':'<span class="badge rounded-pill bg-warning text-dark">Pendiente</span>'}},{data:"importeString"},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Gastos",exportOptions:{columns:[1,2,3,4,5,6]}},"pageLength"]})}$(document).ready(function(){showLoading(),fetch("/Gastos/GetTipoDeGasto").then(t=>t.json()).then(t=>{t.state?0<t.object.length&&(tipoGastosList=t.object,t.object.forEach(t=>{$("#cboTipoDeGastoEnGasto").append($("<option>").val(t.idTipoGastos).text(t.descripcion))})):swal("Lo sentimos",t.message,"error")}),fetch("/Access/GetAllUsers").then(t=>t.json()).then(t=>{t.state?0<t.object.length&&t.object.forEach(t=>{$("#cboUsuario").append($("<option>").val(t.idUsers).text(t.name))}):swal("Lo sentimos",t.message,"error")}),fetch("/Tienda/GetTienda").then(t=>t.json()).then(t=>{document.getElementById("divSwitchVisionGlobalGastos").style.display=null!=t.data&&1<t.data.length?"":"none"}),cargarTablaGastos(!1),cargarTablaDinamicaGastos(!1),removeLoading()});let openModalTipoDeGasto=(t=BASIC_MODEL_TIPO_DE_GASTOS)=>{$("#txtIdTipoGastos").val(t.IdTipoGastos),$("#cboTipoDeGasto").val(t.gastoParticular),$("#txtDescripcionTipoDeGasto").val(t.descripcion),$("#modalDataTipoDeGasto").modal("show")},openModalNuevoGasto=($("#SwitchVisionGlobalGastos").change(function(){var t=$(this).is(":checked");cargarTablaDinamicaGastos(t),cargarTablaGastos(t)}),$("#btnNewTipoDeGasto").on("click",function(){openModalTipoDeGasto()}),$("#btnSaveTipoDeGastos").on("click",function(){var t,e=$("input.input-validate-TipoDeGastos").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):((t=structuredClone(BASIC_MODEL_TIPO_DE_GASTOS)).IdTipoGastos=parseInt($("#txtIdTipoGastos").val()),t.gastoParticular=$("#cboTipoDeGasto").val(),t.descripcion=$("#txtDescripcionTipoDeGasto").val(),t.tipoFactura=parseInt($("#cboTipoFacturaTipoGasto").val()),t.iva=""!=$("#txtIvaTipoGasto").val()?parseInt($("#txtIvaTipoGasto").val()):0,$("#modalDataTipoDeGasto").find("div.modal-content").LoadingOverlay("show"),0==t.IdTipoGastos&&fetch("/Gastos/CreateTipoDeGastos",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalDataTipoDeGasto").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?location.reload():swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),(t=BASIC_MODEL_GASTO)=>{var e;$("#txtIdGastos").val(t.idGastos),$("#cboTipoDeGastoEnGasto").val(t.idTipoGasto),$("#txtImporte").val(t.importe),$("#cboUsuario").val(t.idUsuario),$("#cboTipoFactura").val(t.tipoFactura),$("#txtNroFactura").val(t.nroFactura),$("#txtIva").val(t.iva),$("#txtImporteIva").val(t.ivaImporte),$("#txtImporteSinIva").val(t.importeSinIva),$("#txtComentario").val(t.comentario),$("#cboEstado").val(t.estadoPago),document.getElementById("cbxFacturaPendiente").checked=t.facturaPendiente,null==t.modificationDate?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#modalData").modal("show")});function calcularImportes(){var t=$("#txtImporte").val(),e=$("#txtIva").val();""!==t&&""!==e&&(e=parseFloat(t)*(1-parseFloat(e)/100),$("#txtImporteSinIva").val(e),$("#txtImporteIva").val(t-e))}function calcularIva(){var t=$("#txtImporte").val(),t=parseFloat(""==t?0:t),e=parseFloat($("#txtIva").val());isNaN(t)||isNaN(e)||(e=t-(t=t/(1+e/100)),$("#txtImporteSinIva").val(t.toFixed(2)),$("#txtImporteIva").val(e.toFixed(2)))}function cargarTablaDinamicaGastos(t){t="/Gastos/GetGastosTablaDinamica?visionGlobal="+t;$("#wdr-component").LoadingOverlay("show"),fetch(t,{method:"GET"}).then(t=>($("#wdr-component").LoadingOverlay("hide"),t.ok||500==t.status?t.json():Promise.reject(t))).then(t=>{if(void 0!==t.error)return console.error(t.error),!1;var e,a;t.state?t.data!=[]&&(a=new Date,e="fecha.Month."+monthNames[a.getMonth()],a="fecha.Year."+a.getFullYear(),new WebDataRocks({container:"#wdr-component",toolbar:!0,report:{dataSource:{data:t.object},formats:[{name:"currency",currencySymbol:"$"}],slice:{reportFilters:[{uniqueName:"fecha.Day"},{uniqueName:"fecha.Month",filter:{members:[e]}},{uniqueName:"fecha.Year",filter:{members:[a]}}],rows:[{uniqueName:"gasto",sort:"desc"},{uniqueName:"tipo_Gasto",sort:"desc"},{uniqueName:"tipo_Factura",sort:"desc"},{uniqueName:"nro_Factura",sort:"desc"}],columns:[{uniqueName:"[Measures]"}],measures:[{uniqueName:"importe",caption:"Importe",aggregation:"sum",format:"currency"},{uniqueName:"importe_Sin_Iva",caption:"Importe sin IVA",aggregation:"sum",format:"currency"},{uniqueName:"iva_Importe",caption:"Importe IVA",aggregation:"sum",format:"currency"}]}},global:{localization:"https://cdn.webdatarocks.com/loc/es.json"}})):swal("Lo sentimos",t.message,"error")})}$("#btnNew").on("click",function(){openModalNuevoGasto()}),$("#btnSave").on("click",function(){var t,e=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):null==$("#cboTipoDeGastoEnGasto").val()?toastr.warning("Debe completar el tipo de gasto",""):((t=structuredClone(BASIC_MODEL_GASTO)).idGastos=parseInt($("#txtIdGastos").val()),t.idTipoGasto=$("#cboTipoDeGastoEnGasto").val(),t.importe=$("#txtImporte").val(),t.comentario=$("#txtComentario").val(),t.idUsuario=0!=$("#cboUsuario").val()?$("#cboUsuario").val():null,t.tipoFactura=$("#cboTipoFactura").val(),t.nroFactura=$("#txtNroFactura").val(),t.iva=""!=$("#txtIva").val()?$("#txtIva").val():0,t.ivaImporte=""!=$("#txtImporteIva").val()?$("#txtImporteIva").val():0,t.importeSinIva=""!=$("#txtImporteSinIva").val()?$("#txtImporteSinIva").val():0,t.estadoPago=parseInt($("#cboEstado").val()),t.facturaPendiente=document.querySelector("#cbxFacturaPendiente").checked,$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idGastos?fetch("/Gastos/CreateGastos",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(swal("Exitoso!","Guardado con éxito","success"),$("#modalData").modal("hide"),location.reload()):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Gastos/UpdateGastos",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(swal("Exitoso!","Modificado con éxito","success"),location.reload()):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedGastos=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataGastos.row(rowSelectedGastos).data();openModalNuevoGasto(t)}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataGastos.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar gasto "${a.gastoParticular} ${a.tipoGastoString} ${a.comentario}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Gastos/DeleteGastos?idGastos="+a.idGastos,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataGastos.row(e).remove().draw(),swal("Exitoso!","El gasto  fue eliminada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),$("#cboTipoDeGastoEnGasto").change(function(){let e=$(this).val();var t=tipoGastosList.find(t=>t.idTipoGastos==e);null!=t?($("#txtGasto").val(t.gastoParticular),$("#txtIva").val(t.iva??""),$("#cboTipoFactura").val(t.tipoFactura??"")):($("#txtGasto").val(""),$("#txtIva").val(""),$("#cboTipoFactura").val(""))}),$("#txtIva").change(function(){calcularIva()}),$("#txtImporte").keyup(function(){calcularIva()});let tableDataCategory,rowSelectedCategory,BASIC_MODEL_CATEGORIA={idCategory:0,description:"",isActive:1,modificationDate:null,modificationUser:null},openModalCategory=($(document).ready(function(){tableDataCategory=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Inventory/GetCategories",type:"GET",datatype:"json"},columns:[{data:"idCategory",visible:!1,searchable:!1},{data:"description"},{data:"isActive",render:function(t){return 1==t?'<span class="badge badge-info">Activo</span>':'<span class="badge badge-danger">Inactivo</span>'}},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte categories",exportOptions:{columns:[1,2]}},"pageLength"]})}),(t=BASIC_MODEL_CATEGORIA)=>{var e;$("#txtId").val(t.idCategory),$("#txtDescription").val(t.description),$("#cboState").val(t.isActive),null==t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#modalData").modal("show")});$("#btnNew").on("click",function(){openModalCategory()}),$("#btnSave").on("click",function(){var t,e=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):((t=structuredClone(BASIC_MODEL_CATEGORIA)).idCategory=parseInt($("#txtId").val()),t.description=$("#txtDescription").val(),t.isActive=$("#cboState").val(),$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idCategory?fetch("/Inventory/CreateCategory",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataCategory.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","La categoria fué creada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Inventory/UpdateCategory",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataCategory.row(rowSelectedCategory).data(t.object).draw(!1),rowSelectedCategory=null,$("#modalData").modal("hide"),swal("Exitoso!","La categoria fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedCategory=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataCategory.row(rowSelectedCategory).data();openModalCategory(t)}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataCategory.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar categoria "${a.description}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Inventory/DeleteCategory?idCategory="+a.idCategory,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataCategory.row(e).remove().draw(),swal("Exitoso!","Categoria fué eliminada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})});let tableDataProduct,rowSelectedProduct,edicionMasiva=!1,aProductos=[],aumentoWeb=0,cantProductosImportar=0,BASIC_MODEL_PRODUCTOS={idProduct:0,barCode:"",description:"",idCategory:0,quantity:0,price:0,isActive:1,photo:"",modificationDate:null,modificationUser:null,priceWeb:"",porcentajeProfit:0,costPrice:"",tipoVenta:"",idProveedor:"",comentario:"",minimo:0,precio2:"",precio3:"",porcentajeProfit2:0,porcentajeProfit3:0,vencimientos:[],iva:0},BASIC_MASSIVE_EDIT={precio:0,idProductos:[],isActive:null},BASIC_IMPRIMIR_PRECIOS={idProductos:[],listaPrecio:0,fechaModificacion:!1,codigoBarras:!1,path:""},BASIC_vencimientos={idVencimiento:0,lote:"",fechaVencimiento:null,fechaElaboracion:null,notificar:0,registrationDate:!1,registrationUser:!1};function editAll(){if(0!=document.querySelectorAll("input[type=checkbox]:checked").length){aProductos=[],document.querySelectorAll("#tbData tr").forEach((t,e)=>{null!=t.querySelector("input[type=checkbox]")&&t.querySelector("input[type=checkbox]").checked&&""!==t.id&&aProductos.push([t.id,t.childNodes[1].textContent,t.childNodes[4].textContent])}),$("#txtPriceMasivo").val(""),$("#txtPriceWebMasivo").val(""),$("#txtProfitMasivo").val(""),$("#txtCostoMasivo").val(""),$("#txtPrice2Masivo").val(parseInt("")),$("#txtProfit2Masivo").val(""),$("#txtPrice3Masivo").val(""),$("#txtProfit3Masivo").val("");var t=document.getElementById("listProductosEditar"),a=(t.innerHTML="",document.createElement("ul"));for(a.setAttribute("style","padding: 0; margin: 0;"),a.setAttribute("id","theList"),i=0;i<=aProductos.length-1;i++){var o=document.createElement("li");o.innerHTML=aProductos[i][1]+": "+aProductos[i][2],o.setAttribute("style","display: block;"),a.appendChild(o)}t.appendChild(a);t=tableDataProduct.ajax.json().data;let e=aProductos.map(t=>parseInt(t[0]));t=t.filter(t=>e.includes(t.idProduct));cargarTabla(t),$("#modalDataMasivo").modal("show")}}$(document).ready(function(){showLoading(),$(document).ready(function(){tableDataProduct=$("#tbData").DataTable({pageLength:50,responsive:!0,ajax:{url:"/Inventory/GetProducts",type:"GET",datatype:"json"},rowId:"idProduct",columnDefs:[{targets:[8],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY HH:mm"):"":t}}],columns:[{data:"idProduct",visible:!1,searchable:!1},{defaultContent:'<input type="checkbox" class="chkProducto">',orderable:!1,searchable:!1,width:"40px",className:"text-center"},{data:"description"},{data:"idCategoryNavigation.description"},{data:"proveedor.nombre",render:function(t,e,a){return t||""}},{data:"listaPrecios",render:function(t,e,a){return t&&0<t.length?"$ "+t[0].precio:""}},{data:"listaPrecios",render:function(t,e,a){return t&&1<t.length?"$ "+t[1].precio:""}},{data:"priceWeb",render:function(t,e,a){return"$ "+t}},{data:"modificationDate"},{data:"isActive",className:"text-center",render:function(t){return 1==t?'<span class="badge badge-info">Activo</span>':'<span class="badge badge-danger">Inactivo</span>'}},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"130px",className:"text-center"}],order:[[2,"asc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Report Productos",exportOptions:{columns:[2,3,4,5,6,7,8]}},"pageLength"]})}),fetch("/Inventory/GetCategories").then(t=>t.json()).then(t=>{0<t.data.length&&t.data.forEach(t=>{$("#cboCategory").append($("<option>").val(t.idCategory).text(t.description))})}),fetch("/Admin/GetProveedores").then(t=>t.json()).then(t=>{0<t.data.length&&($("#cboProveedor").append($("<option>").val("").text("")),t.data.forEach(t=>{$("#cboProveedor").append($("<option>").val(t.idProveedor).text(t.nombre))}))}),fetch("/Admin/GetAjustesProductos").then(t=>t.json()).then(t=>{t.state?($("#txtAumento").val(t.object+" %"),$("#txtAumentoMasivo").val(t.object+" %"),aumentoWeb=t.object):swal("Lo sentimos",t.message,"error")}),$("#txtfVencimiento").datepicker({dateFormat:"dd/mm/yy"}),$("#txtfElaborado").datepicker({dateFormat:"dd/mm/yy"}),removeLoading()}),$("#chkSelectAll").on("click",function(){var e=document.querySelector("#chkSelectAll").checked,a=document.querySelectorAll('input[type="checkbox"].chkProducto');for(let t=0;t<a.length;t++)a[t].checked=e});let openModalProduct=(t=BASIC_MODEL_PRODUCTOS)=>{var e;$("#txtId").val(t.idProduct),$("#txtBarCode").val(t.barCode),$("#txtDescription").val(t.description),$("#cboCategory").val(0==t.idCategory?$("#cboCategory option:first").val():t.idCategory),$("#txtQuantity").val(t.quantity),$("#txtMinimo").val(t.minimo),$("#txtPrice").val(0!=t.price?t.price.replace(/,/g,"."):""),$("#txtPriceWeb").val(t.priceWeb),$("#txtProfit").val(t.porcentajeProfit),$("#txtCosto").val(t.costPrice),$("#cboTipoVenta").val(t.tipoVenta),$("#cboState").val(t.isActive),$("#txtPhoto").val(""),$("#cboProveedor").val(0==t.idProveedor?$("#cboProveedor option:first").val():t.idProveedor),$("#txtComentario").val(t.comentario),$("#txtIva").val(t.iva),$("#txtPrice2").val(t.precio2.replace(/,/g,".")),$("#txtProfit2").val(t.porcentajeProfit2),$("#txtPrice3").val(t.precio3.replace(/,/g,".")),$("#txtProfit3").val(t.porcentajeProfit3),null!=t.photoBase64?$("#imgProduct").attr("src","data:image/png;base64,"+t.photoBase64):$("#imgProduct").attr("src",""),null===t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#tbVencimientos tbody").html(""),t.vencimientos&&0<t.vencimientos.length&&(t.vencimientos.sort((t,e)=>e.idVencimiento-t.idVencimiento),t.vencimientos.slice(0,3).forEach(t=>{addVencimientoTable(t)})),$("#txtfVencimiento").val(""),$("#txtfElaborado").val(""),$("#txtLote").val(""),$("#modalData").modal("show")};function addVencimientoTable(t){let e="",a="",o="";null!=t.fechaVencimiento&&(o=t.fechaVencimiento,a=o.split("T")[0].replace(/-/g,"/")),null!=t.fechaElaboracion&&(o=t.fechaElaboracion,e=o.split("T")[0].replace(/-/g,"/")),$("#tbVencimientos tbody").append($("<tr>").append($("<td>").text(a),$("<td>").text(e),$("<td>").text(t.lote),$("<td>").append($("<input>").attr("type","checkbox").prop("checked",t.notificar).data("estado-inicial",t.notificar)),$("<td>").append($("<button>").addClass("btn btn-danger btn-sm btn-delete-vencimiento").append($("<i>").addClass("mdi mdi-trash-can")).data("vencimiento",t))))}function obtenerDatosTabla(){let a=[];return $("#tbVencimientos tbody tr").each(function(){var t={},e=(t.fechaVencimiento=$(this).find("td:eq(0)").text(),t.fechaElaboracion=$(this).find("td:eq(1)").text(),t.lote=$(this).find("td:eq(2)").text(),t.notificar=$(this).find("td:eq(3) input[type=checkbox]").prop("checked"),t.idVencimiento=$(this).find("button").data("vencimiento").idVencimiento,$(this).find("td:eq(3) input[type=checkbox]").data("estado-inicial"));(void 0!==e&&t.notificar!==e||0===t.idVencimiento)&&a.push(t)}),a}function compressImage(a,n,r,l){return new Promise((i,e)=>{var t=new FileReader;t.readAsDataURL(a),t.onload=t=>{let o=new Image;o.src=t.target.result,o.onload=()=>{var t=document.createElement("canvas"),e=t.getContext("2d"),a=Math.min(r/o.width,l/o.height);t.width=o.width*a,t.height=o.height*a,e.drawImage(o,0,0,t.width,t.height),t.toBlob(t=>{i(t)},"image/jpeg",n)},o.onerror=e},t.onerror=e})}function calcularPrecio(){var t=$("#txtIva").val();let a=$("#txtCosto").val();t=""==t||null==t?0:parseFloat(t),""!==a&&(a=parseFloat(a)*(1+t/100),["","2","3"].forEach(t=>{var e=$("#txtProfit"+t).val();""!==e&&(e=a*(1+parseFloat(e)/100),$("#txtPrice"+t).val(e.toFixed(2)))}));var t=$("#txtAumento").val(),e=$("#txtPrice").val();""!==t&&""!==e&&(e=parseFloat(e)*(1+parseFloat(t)/100),$("#txtPriceWeb").val(e))}function calcularPrecioMasivo(){var t,e=$("#txtIvaMasivo").val();let a=$("#txtCostoMasivo").val(),o=(e=""===e?0:parseFloat(e),parseInt($("#rounding").val()));isNaN(o)||o<0?alert("Por favor, ingrese un valor de redondeo válido."):(""!==a&&(a=parseFloat(a)*(1+e/100),["Masivo","2Masivo","3Masivo"].forEach(t=>{var e=$("#txtProfit"+t).val();""!==e&&(e=roundToDigits(a*(1+parseFloat(e)/100),o),$("#txtPrice"+t).val(e.replace(",",".")))})),e=$("#txtAumento").val(),t=$("#txtPriceMasivo").val(),""!==e&&""!==t&&(t=roundToDigits(parseFloat(t)*(1+parseFloat(e)/100),o),$("#txtPriceWebMasivo").val(t.replace(",","."))))}function imprimirPrecios(){if(0!=document.querySelectorAll("input[type=checkbox]:checked").length){aProductos=[],document.querySelectorAll("#tbData tr").forEach((t,e)=>{null!=t.querySelector("input[type=checkbox]")&&t.querySelector("input[type=checkbox]").checked&&""!==t.id&&aProductos.push([t.id,t.childNodes[1].textContent,t.childNodes[4].textContent])});var t=document.getElementById("listProdImprimir"),e=(t.innerHTML="",document.createElement("ul"));for(e.setAttribute("style","padding: 0; margin: 0;text-align: left;"),e.setAttribute("id","theList"),i=0;i<=aProductos.length-1;i++){var a=document.createElement("li");a.innerHTML="· "+aProductos[i][1],a.setAttribute("style","display: block;"),e.appendChild(a)}t.appendChild(e),$("#modalDataImprimirPrecios").modal("show")}}function cargarTabla(t){let d=$("#tablaProductosEditar tbody");d.empty(),t.forEach(t=>{var e=t.idProduct,a=t.description,o=null==t.costPrice?0:t.costPrice,i=t.price,n=t.precio2,r=t.precio3,l=t.priceWeb,s=$("<tr>");s.append($("<td hidden>").text(e)),s.append($("<td>").text(a)),s.append($("<td>").text("$ "+o).addClass("editable costo").attr({contenteditable:!0,inputmode:"numeric",pattern:"[0-9]*",min:0})),s.append($("<td>").text("$ "+i).addClass("editable").attr({"data-profit":t.porcentajeProfit,"data-web":0,"data-iva":t.iva,contenteditable:!0,inputmode:"numeric",pattern:"[0-9]*",min:0})),s.append($("<td>").text("$ "+n).addClass("editable").attr({"data-profit":t.porcentajeProfit2,"data-web":0,"data-iva":t.iva,contenteditable:!0,inputmode:"numeric",pattern:"[0-9]*",min:0})),s.append($("<td>").text("$ "+r).addClass("editable").attr({"data-profit":t.porcentajeProfit3,"data-web":0,"data-iva":t.iva,contenteditable:!0,inputmode:"numeric",pattern:"[0-9]*",min:0})),s.append($("<td>").text("$ "+l).addClass("editable").attr({"data-profit":t.porcentajeProfit,"data-web":aumentoWeb,"data-iva":t.iva,contenteditable:!0,inputmode:"numeric",pattern:"[0-9]*",min:0})),d.append(s)}),$("#rounding").change(function(){("edit-tabla-tab"==$("#myTab .nav-link.active").attr("id")?recalculatePrices:calcularPrecioMasivo)()}),$(".editable.costo").on("blur",function(){recalculatePrices()}),document.querySelectorAll(".editable").forEach(function(t){document.querySelectorAll(".editable").forEach(function(t){let e=t.textContent.trim();t.addEventListener("click",function(){this.textContent.trim()===e&&(this.textContent=""),this.focus()}),t.addEventListener("input",function(){var t=this.textContent.trim();/^\$?\s?\d*\.?\d*$/.test(t)?(t=parseFloat(t.replace(/\$|\s/g,"").replace(".",",")),isNaN(t)||(this.textContent=t)):this.textContent=""}),t.addEventListener("blur",function(){var t=this.textContent.trim();""===t?this.textContent=e:/^\d*\.?\d*$/.test(t)&&(t=parseFloat(t.replace(".",",")),isNaN(t)||(this.textContent="$ "+t.toFixed(2).replace(".",",")))})})})}function roundToDigits(t,e){return 0===e?t.toFixed(2).replace(".",","):(e=Math.pow(10,e),(Math.round(t/e)*e).toFixed(2))}function recalculatePrices(){let n=parseInt($("#rounding").val());isNaN(n)||n<0?alert("Por favor, ingrese un valor de redondeo válido."):$("#tablaProductosEditar tbody tr").each(function(){var t=$(this);let i=t.find(".editable.costo").text().replace("$ ","").replace(",",".");t.find("td:nth-child(n+4)").each(function(){var t=parseFloat(i)||0,e=parseFloat($(this).attr("data-profit")),a=parseFloat($(this).attr("data-iva")),o=parseFloat($(this).attr("data-web")),a=""==a||isNaN(a)?0:a,o=""==o?0:o;0!=e&&0!=t&&(a=(t*=1+a/100)*(1+e/100),t=roundToDigits(a*=1+o/100,n),$(this).text("$ "+t))})})}function cerrarTurno(){fetch("/Turno/GetTurnoActual",{method:"GET"}).then(t=>($("div.container-fluid").LoadingOverlay("hide"),t.json())).then(t=>{if(t.state){var e=t.object,a=new Date(e.fechaInicio),o=($("#txtInicioTurno").val(a.toLocaleString()),$("#contMetodosPagoLayout").empty(),document.getElementById("contMetodosPagoLayout"));for(i=0;i<e.ventasPorTipoVenta.length;++i){var n=document.createElement("li");n.innerText=e.ventasPorTipoVenta[i].descripcion+": $ "+e.ventasPorTipoVenta[i].total,console.log(e.ventasPorTipoVenta[i].descripcion+": $ "+e.ventasPorTipoVenta[i].total),o.appendChild(n)}$("#modalDataTurno").modal("show")}else swal("Lo sentimos",t.message,"error")}).catch(t=>{$("div.container-fluid").LoadingOverlay("hide")})}function generarDatos(){showLoading(),fetch("/Access/GenerarDatos",{method:"POST"}).then(t=>{removeLoading(),200==t.status?swal("Exitoso!","Datos cerados","success"):swal("Lo sentimos","","error")}).catch(t=>{$("div.container-fluid").LoadingOverlay("hide")})}function showLoading(){if(null==document.getElementById("divLoadingFrame")){var t=document.createElement("style"),e=(t.id="styleLoadingWindow",t.innerHTML=`
        .loading-frame {
            position: fixed;
            background-color: rgba(80, 80, 80, 0.3);
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            z-index: 4;
        }

        .loading-track {
            height: 50px;
            display: inline-block;
            position: absolute;
            top: calc(50% - 50px);
            left: 50%;
        }

        .loading-dot {
            height: 5px;
            width: 5px;
            background-color: white;
            border-radius: 100%;
            opacity: 0;
        }

        .loading-dot-animated {
            animation-name: loading-dot-animated;
            animation-direction: alternate;
            animation-duration: .75s;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
        }

        @keyframes loading-dot-animated {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    `,document.body.appendChild(t),document.createElement("div"));e.id="divLoadingFrame",e.classList.add("loading-frame");for(var a=0;a<10;a++){var o=document.createElement("div"),i=(o.classList.add("loading-track"),document.createElement("div"));i.classList.add("loading-dot"),o.style.transform="rotate("+String(36*a)+"deg)",o.appendChild(i),e.appendChild(o)}document.body.appendChild(e);for(var n=0,r=document.getElementsByClassName("loading-dot"),a=0;a<r.length;a++)window.setTimeout(function(t){t.classList.add("loading-dot-animated")},n,r[a]),n+=150}}function removeLoading(){document.body.removeChild(document.getElementById("divLoadingFrame")),document.body.removeChild(document.getElementById("styleLoadingWindow"))}function setupPasswordToggle(t,e){e.on("mousedown",function(){t.attr("type","text")}),e.on("mouseup mouseleave",function(){t.attr("type","password")}),e.on("click",function(t){t.preventDefault()})}function formatCuil(t){let e="";return 0<(t=t.replace(/\D/g,"")).length&&(e+=t.substring(0,2)),2<t.length&&(e+="-"+t.substring(2,10)),10<t.length&&(e+="-"+t.substring(10,11)),e}function validateCuilCuit(){return 11==$("#txtCuilCliente").val().replace(/\D/g,"").length}function validateDni(){return 8==$("#txtCuilCliente").val().replace(/\D/g,"").length}function inicializarClientesFactura(){toggleFields($("#switchNuevoCliente").is(":checked")),$("#switchNuevoCliente").change(function(){toggleFields($(this).is(":checked")),resetModalClientesFactura()}),$('[data-bs-toggle="popover"]').popover({html:!0}),$("#modalDatosFactura").on("shown.bs.modal",function(){$("#cboClienteFactura").data("select2")||funClientesFactura(),setTimeout(function(){$("#cboClienteFactura").select2("open")},100)}),$("#modalDatosFactura").on("hidden.bs.modal",function(){resetModalClientesFactura()}),$("#cboCondicionIvaCliente").on("change",function(){$("#txtCuilCliente").val("")}),seleccionaCliente()}function funClientesFactura(){showLoading(),$("#cboClienteFactura").select2({ajax:{url:"/Sales/GetClientesByFacturar",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(t){return{search:t.term}},processResults:function(t){return{results:t.map(t=>({id:t.idCliente,text:t.nombre,cuil:t.cuil,telefono:t.telefono,direccion:t.direccion,condicionIva:t.condicionIva,comentario:t.comentario,color:"",total:""}))}}},placeholder:"Buscando cliente...",minimumInputLength:3,templateResult:formatResultsClients,allowClear:!0,dropdownParent:$("#modalDatosFactura .modal-content")}),$("#cboClienteFactura").on("select2:select",function(t){t=t.params.data;$("#txtNombreCliente").val(t.text),$("#txtCuilCliente").val(t.cuil),$("#txtTelefonoCliente").val(t.telefono),$("#txtDireccionCliente").val(t.direccion),$("#cboCondicionIvaCliente").val(t.condicionIva),$("#txtComentarioCliente").val(t.comentario),$("#txtIdClienteFactura").val(t.id)}),$("#txtCuilCliente").on("input",function(){var t;"4"==$("#cboCondicionIvaCliente").val()&&(t=formatCuil($(this).val()),$(this).val(t))}),$("#txtCuilCliente").on("keypress",function(t){var e=t.which||t.keyCode;(e<48||57<e)&&t.preventDefault()}),removeLoading()}function removeHyphens(t){return t.replace(/-/g,"")}function resetModalClientesFactura(){$("#cboClienteFactura").val(null).trigger("change"),$("#txtNombreCliente").val(""),$("#txtCuilCliente").val(""),$("#txtTelefonoCliente").val(""),$("#txtDireccionCliente").val(""),$("#cboCondicionIvaCliente").val(""),$("#txtComentarioCliente").val(""),$("#txtIdClienteFacturaCliente").val(0)}function toggleFields(t){$("#txtNombreCliente, #txtCuilCliente, #cboCondicionIvaCliente, #txtTelefonoCliente, #txtDireccionCliente, #txtComentarioCliente").prop("disabled",!t),$("#cboClienteFactura").prop("disabled",t),t?$("#switchGuardarNuevoClienteDiv").css("display","block"):($("#switchGuardarNuevoClienteDiv").css("display","none"),$("#switchGuardarNuevoCliente").prop("checked",!1))}async function seleccionaCliente(){$("#btnSeleccionarClienteFactura").on("click",function(){var a=$("input.input-validate-cliente").serializeArray().filter(t=>""==t.value.trim());if(0<a.length)o=`Debe completar los campos : "${a[0].name}"`,toastr.warning(o,""),$(`input[name="${a[0].name}"]`).focus();else{let t=!0;var o=$("#txtCuilCliente").val();if("4"==$("#cboCondicionIvaCliente").val()?(t=validateCuilCuit(),removeHyphens(o)):"1"==$("#cboCondicionIvaCliente").val()&&(t=validateDni()),t){a=document.getElementById("switchNuevoCliente").checked,o=document.getElementById("switchGuardarNuevoCliente").checked;let e=structuredClone({idCliente:0,nombre:"",cuil:null,telefono:null,direccion:null,condicionIva:null,isActive:!0});e.nombre=$("#txtNombreCliente").val(),e.direccion=$("#txtDireccionCliente").val(),e.cuil=$("#txtCuilCliente").val(),e.telefono=$("#txtTelefonoCliente").val(),e.condicionIva=$("#cboCondicionIvaCliente").val(),e.idCliente=$("#txtIdClienteFactura").val(),a&&o&&fetch("/Admin/CreateCliente",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{t.state?e.idCliente=t.object.idCliente:swal("Lo sentimos",t.message,"error")}).catch(t=>{}),$("#txtClienteParaFactura").val(`${e.nombre}  (CUIT: ${e.cuil})`),$("#txtClienteParaFactura").attr("cuil",e.cuil),$("#txtClienteParaFactura").attr("idcliente",e.idCliente),$("#btnFinalizarVentaParcial").prop("disabled",!1),$("#txtMinimoIdentificarConsumidor").toggle(!1),$("#modalDatosFactura").modal("hide")}else toastr.warning("El campo CUIL / CUIT / DNI debe ser completado de forma corecta, dependiendo de la condicion del IVA","")}})}function formatResultsClients(t){return t.loading?t.text:$(`<table width="100%">
            <tr>
                <td class="col-sm-8">
                    <p style="font-weight: bolder;margin:2px">${t.text}</p>
                    <em style="font-weight: bolder;margin:2px">${t.cuil}</em>
                </td>
            </tr>
         </table>`)}$("#tbVencimientos tbody").on("click",".btn-delete-vencimiento",function(t){t.preventDefault();let e=$(this).data("vencimiento"),a=$(this);swal({title:"¿Desea eliminar el vencimiento? ",text:"",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar vencimiento",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&(0==e.idVencimiento?a.closest("tr").remove():($(".showSweetAlert").LoadingOverlay("show"),fetch("/Inventory/DeleteVencimiento?idVencimiento="+e.idVencimiento,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(a.closest("tr").remove(),swal("Eliminado","El vencimiento ha sido eliminado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")})))})}),$("#btnAddVencimiento").on("click",function(){var t=structuredClone(BASIC_vencimientos);return t.fechaVencimiento=$("#txtfVencimiento").val(),t.fechaElaboracion=$("#txtfElaborado").val(),t.lote=$("#txtLote").val(),t.notificar=!0,addVencimientoTable(t),$("#txtfVencimiento").val(""),$("#txtfElaborado").val(""),$("#txtLote").val(""),!1}),$("#tbVencimientos tbody").on("click",".btn-danger",function(){rowSelectedProduct=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),0==$(this).data("vencimiento").idVencimiento&&rowSelectedProduct.remove()}),$("#bntModalImportar").on("click",function(){$("#modalImpprtar").modal("show")}),$("#btnImportar").on("click",function(){swal({title:"¿Está seguro?",text:`Se importaran ${cantProductosImportar} Productos`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, IMPORTAR",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&(t=$("#txtRutaImportar").val(),$(".showSweetAlert").LoadingOverlay("show"),fetch("/Inventory/ImportarProductos?path="+t,{method:"GET"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(swal("Exitoso!","Se han importado "+cantProductosImportar+" filas","success"),location.reload()):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),$("#btnCargarImportar").on("click",function(){$("#btnCargarImportar").LoadingOverlay("show");var t=$("#txtRutaImportar").val();fetch("/Inventory/CargarProductos?path="+t,{method:"GET"}).then(t=>($("#btnCargarImportar").LoadingOverlay("hide"),t.json())).then(t=>{if(t.state){cantProductosImportar=t.object.length,$("#lblCantidadProds").html("Cantidad de Productos: <strong> "+cantProductosImportar+".</strong>");let e=0;t.object.forEach(t=>{$("#tableImportarProductos tbody").append($("<tr>").append($("<td>").text(++e),$("<td>").text(t.description),$("<td>").text(t.barCode),$("<td>").text("1"==t.tipoVenta?"Kg":"U"),$("<td>").text(t.costPrice),$("<td>").text(t.porcentajeProfit),$("<td>").text(t.price),$("<td>").text(t.porcentajeProfit2),$("<td>").text(t.precio2),$("<td>").text(t.porcentajeProfit3),$("<td>").text(t.precio3),$("<td>").text(t.priceWeb),$("<td>").text(t.nameProveedor),$("<td>").text(t.nameCategory)))})}else swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#btnCargarImportar").LoadingOverlay("hide")})}),$("#btnNewProduct").on("click",function(){openModalProduct()}),$("#btnSaveMasivo").on("click",function(){var t;""==$("#txtPriceMasivo").val()&&""==$("#txtPrice2Masivo").val()&&""==$("#txtPrice3Masivo").val()&&""==$("#txtPorPorcentajeMasivo").val()&&""==$("#txtIvaMasivo").val()&&""==$("#cboStateMasivo").val()?toastr.warning("Debe completar alguno de los campos de Precio o Por %",""):""==$("#txtPriceMasivo").val()&&""==$("#txtPrice2Masivo").val()&&""==$("#txtPrice3Masivo").val()||""==$("#txtPorPorcentajeMasivo").val()||""!=$("#txtIvaMasivo").val()||""!=$("#cboStateMasivo").val()?(showLoading(),(t=structuredClone(BASIC_MASSIVE_EDIT)).idProductos=aProductos.map(t=>t[0]),t.precio=""!=$("#txtPriceMasivo").val()?$("#txtPriceMasivo").val().replace(".",","):"0",t.priceWeb=""!=$("#txtPriceWebMasivo").val()?$("#txtPriceWebMasivo").val().replace(".",","):"0",t.profit=""!=$("#txtProfitMasivo").val()?$("#txtProfitMasivo").val().replace(".",","):"0",t.costo=$("#txtCostoMasivo").val(),t.comentario=$("#txtComentarioMasivo").val(),"-1"!=$("#cboStateMasivo").val()&&(t.isActive="1"==$("#cboStateMasivo").val()),t.porPorcentaje=$("#txtPorPorcentajeMasivo").val(),t.iva=$("#txtIvaMasivo").val(),t.redondeo=$("#rounding").val(),t.precio2=""!=$("#txtPrice2Masivo").val()?$("#txtPrice2Masivo").val().replace(".",","):"0",t.porcentajeProfit2=""!=$("#txtProfit2Masivo").val()?$("#txtProfit2Masivo").val().replace(".",","):0,t.precio3=""!=$("#txtPrice3Masivo").val()?$("#txtPrice3Masivo").val().replace(".",","):"0",t.porcentajeProfit3=""!=$("#txtProfit3Masivo").val()?$("#txtProfit3Masivo").val().replace(".",","):0,$("#modalDataMasivo").find("div.modal-content").LoadingOverlay("show"),fetch("/Inventory/EditMassiveProducts",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalDataMasivo").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{removeLoading(),t.state?(location.reload(),$("#modalDataMasivo").modal("hide")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")})):toastr.warning("Puede completar solo uno de los campos Precio o Por %","")}),$("#btnSave").on("click",async function(){var t,e,a,o=$(".input-validate").serializeArray().filter(t=>""==t.value.trim()||null==t.value.trim());0<o.length?(t=`Debe completaro el campo : "${o[0].name}"`,toastr.warning(t,""),$(`input[name="${o[0].name}"]`).focus()):""==document.getElementById("cboTipoVenta").value?toastr.warning('Debe completaro el campo Tipo Venta"',""):((t=structuredClone(BASIC_MODEL_PRODUCTOS)).idProduct=parseInt($("#txtId").val()),t.barCode=$("#txtBarCode").val(),t.description=$("#txtDescription").val(),t.idCategory=$("#cboCategory").val(),t.quantity=$("#txtQuantity").val(),t.minimo=$("#txtMinimo").val(),t.price=$("#txtPrice").val().replace(/\./g,","),t.priceWeb=$("#txtPriceWeb").val(),t.porcentajeProfit=$("#txtProfit").val(),t.costPrice=$("#txtCosto").val().replace(/\./g,","),t.tipoVenta=$("#cboTipoVenta").val(),t.isActive=$("#cboState").val(),t.idProveedor=$("#cboProveedor").val(),t.comentario=$("#txtComentario").val(),t.iva=$("#txtIva").val(),t.priceWeb=(""!=$("#txtPriceWeb").val()&&null!=$("#txtPriceWeb").val()?$("#txtPriceWeb"):$("#txtPrice")).val().replace(/\./g,","),t.precio2=(""!=$("#txtPrice2").val()?$("#txtPrice2"):$("#txtPrice")).val().replace(/\./g,","),t.porcentajeProfit2=(""!=$("#txtProfit2").val()?$("#txtProfit2"):$("#txtProfit")).val().replace(/\./g,","),t.precio3=(""!=$("#txtPrice3").val()?$("#txtPrice3"):$("#txtPrice")).val().replace(/\./g,","),t.porcentajeProfit3=(""!=$("#txtProfit3").val()?$("#txtProfit3"):$("#txtProfit")).val().replace(/\./g,","),o=obtenerDatosTabla(),(e=new FormData).append("model",JSON.stringify(t)),e.append("vencimientos",JSON.stringify(o)),(o=document.getElementById("txtPhoto")).files&&o.files[0]&&(a=await compressImage(o=o.files[0],.7,300,300),e.append("photo",a,o.name)),$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idProduct?fetch("/Inventory/CreateProduct",{method:"POST",body:e}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProduct.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","El producto fué creado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Inventory/EditProduct",{method:"PUT",body:e}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProduct.row(rowSelectedProduct).data(t.object).draw(!1),rowSelectedProduct=null,$("#modalData").modal("hide"),swal("Exitoso!","El producto fué modificado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedProduct=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),showLoading();var t=tableDataProduct.row(rowSelectedProduct).data();fetch("/Inventory/GetProduct?IdProduct="+t.idProduct).then(t=>t.json()).then(t=>{removeLoading(),t.state?openModalProduct(t.object):swal("Lo sentimos",t.message,"error")})}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataProduct.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar el producto "${a.description}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Inventory/DeleteProduct?IdProduct="+a.idProduct,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProduct.row(e).remove().draw(),swal("Exitoso!","El producto fué eliminado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),$("#btnImprimir").on("click",function(){var t=structuredClone(BASIC_IMPRIMIR_PRECIOS);t.idProductos=aProductos.map(t=>parseInt(t[0])),t.listaPrecio=parseInt($("#cboListaPrecio").val()),t.fechaModificacion=document.getElementById("switchUltimaModificacion").checked,t.codigoBarras=document.getElementById("switchCodigoBarras").checked,showLoading(),$("#modalDataImprimirPrecios").modal("hide"),fetch("/Inventory/ImprimirListaPrecios",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{if(t.state){var e=atob(t.object),a=new Array(e.length);for(let t=0;t<e.length;t++)a[t]=e.charCodeAt(t);var o=new Uint8Array(a),o=new Blob([o],{type:"application/pdf;base64"}),o=URL.createObjectURL(o);window.open(o),removeLoading()}else swal("Lo sentimos",t.error,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")})}),$("#btnSaveMasivoTabla").click(function(){let t=[];showLoading(),$("#tablaProductosEditar tbody tr").each(function(){let a={};$(this).find("td").each(function(t){var e,t=$("#tablaProductosEditar th").eq(t).attr("title");null!=t&&(e=$(this).text().trim().replace("$ ","").replace(",","."),a[t.trim()]=e)}),t.push(a)}),$("#modalDataMasivo").find("div.modal-content").LoadingOverlay("show"),fetch("/Inventory/EditMassiveProductsForTable",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalDataMasivo").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{removeLoading(),t.state?(location.reload(),$("#modalDataMasivo").modal("hide")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalDataMasivo").find("div.modal-content").LoadingOverlay("hide")})}),$(document).ready(function(){$("#limpiarNotificaciones").on("click",function(){fetch("/Notification/LimpiarTodoNotificacion",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"}}).then(t=>t.json()).then(t=>{t.state?($(".dropdown-menu .dropdown-header").remove(),$("#listaNotificaciones").remove()):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalDataTurno").find("div.modal-content").LoadingOverlay("hide")})}),$(".notificacion").on("click",function(){""!=$(this).attr("accion")&&fetch("/Notification/UpdateNotificacion?idNotificacion="+$(this)[0].id,{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"}}).then(t=>t.json()).then(t=>{t.state?window.location.href=t.object.accion:swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalDataTurno").find("div.modal-content").LoadingOverlay("hide")})}),$("#btnChangePV").on("click",function(){fetch("/Tienda/GetTienda").then(t=>t.json()).then(t=>{if(0<t.data.length){$("#modalCambioTienda").modal("show");let a=0;t.data.forEach(t=>{let e="";t.tiendaActual&&(a=t.idTienda,e=" (Actual)"),$("#cboTiendas").append($("<option>").val(t.idTienda).text(t.nombre+" "+e))}),$("#cboTiendas").val(a)}})}),$("#btnCambiarTienda").on("click",function(){$("#modalCambioTienda").LoadingOverlay("show");var t=$("#cboTiendas").val();fetch("/Tienda/ChangeTienda?idTienda="+t,{method:"DELETE"}).then(t=>t.json()).then(t=>{t.state?location.reload():swal("Lo sentimos",t.message,"error")}).catch(t=>{})})}),$("#btnSaveTurno").on("click",function(){var t=$("#txtDescripcion").val();fetch("/Turno/CerrarTurno",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({descripcion:t})}).then(t=>($("#modalDataTurno").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?($("#modalDataTurno").modal("hide"),swal({title:"Se ha cerrado el turno.",text:"Se debe iniciar sesion nuevamente.",showCancelButton:!1,closeOnConfirm:!1},function(t){document.location.href="/"})):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalDataTurno").find("div.modal-content").LoadingOverlay("hide")})});let tbdataVenta,tbdataCompra,tbdataServicios,tbdataGastos;function setTotalesCredito(t,e,a){var o=parseFloat($("#txtNetoFinalCredito").attr("importe")),i=parseFloat($("#txtImporteIvaFinalCredito").attr("importe")),n=parseFloat($("#txtFacturadoFinalCredito").attr("importe")),o=($("#txtNetoFinalCredito").attr("importe",parseFloat(o+t).toFixed(2)),$("#txtImporteIvaFinalCredito").attr("importe",parseFloat(i+e).toFixed(2)),$("#txtFacturadoFinalCredito").attr("importe",parseFloat(n+a).toFixed(2)),$("#txtNetoFinalCredito").val("$ "+parseFloat(o+t).toFixed(2)),$("#txtImporteIvaFinalCredito").val("$ "+parseFloat(i+e).toFixed(2)),$("#txtFacturadoFinalCredito").val("$ "+parseFloat(n+a).toFixed(2)),parseFloat($("#txtImporteIvaFinalCredito").attr("importe"))),t=parseFloat($("#txtImporteIvaFinalDebito").attr("importe"));$("#txtNetoFinalCreditoResultado").val("$ "+parseFloat(i+e).toFixed(2)),$("#txtSaldo").val("$ "+parseFloat(t-o).toFixed(2))}function setTotalesDebito(t,e,a){var o=parseFloat($("#txtNetoFinalDebito").attr("importe")),i=parseFloat($("#txtImporteIvaFinalDebito").attr("importe")),n=parseFloat($("#txtFacturadoFinalDebito").attr("importe")),o=($("#txtNetoFinalDebito").attr("importe",parseFloat(o+t).toFixed(2)),$("#txtImporteIvaFinalDebito").attr("importe",parseFloat(i+e).toFixed(2)),$("#txtFacturadoFinalDebito").attr("importe",parseFloat(n+a).toFixed(2)),$("#txtNetoFinalDebito").val("$ "+parseFloat(o+t).toFixed(2)),$("#txtImporteIvaFinalDebito").val("$ "+parseFloat(i+e).toFixed(2)),$("#txtFacturadoFinalDebito").val("$ "+parseFloat(n+a).toFixed(2)),parseFloat($("#txtImporteIvaFinalCredito").attr("importe"))),t=parseFloat($("#txtImporteIvaFinalDebito").attr("importe"));$("#txtNetoFinalDebitoResultado").val("$ "+parseFloat(i+e).toFixed(2)),$("#txtSaldo").val("$ "+parseFloat(t-o).toFixed(2))}function LoadCompra(t){fetch("/Reports/GetIvaReport?idTipoIva=0&date="+t,{method:"GET"}).then(t=>t.json()).then(t=>{if(t.state){var e=t.object;if(e&&3==e.length){let t=[];"proveedores_0"==e[0].nombre&&(setTotalesCredito(e[0].totalSinIva,e[0].totalIva,e[0].totalFacurado),$("#txtNetoCredito0").val("$ "+e[0].totalSinIva),$("#txtImporteIvaCredito0").val("$ "+e[0].totalIva),$("#txtFacturadoCredito0").val("$ "+e[0].totalFacurado),t=t.concat(e[0].ivaRows)),"proveedores_10.5"==e[1].nombre&&(setTotalesCredito(e[1].totalSinIva,e[1].totalIva,e[1].totalFacurado),$("#txtNetoCredito105").val("$ "+e[1].totalSinIva),$("#txtImporteIvaCredito105").val("$ "+e[1].totalIva),$("#txtFacturadoCredito105").val("$ "+e[1].totalFacurado),t=t.concat(e[1].ivaRows)),"proveedores_21"==e[2].nombre&&(setTotalesCredito(e[2].totalSinIva,e[2].totalIva,e[2].totalFacurado),$("#txtNetoCredito21").val("$ "+e[2].totalSinIva),$("#txtImporteIvaCredito21").val("$ "+e[2].totalIva),$("#txtFacturadoCredito21").val("$ "+e[2].totalFacurado),t=t.concat(e[2].ivaRows)),null!=tbdataCompra&&tbdataCompra.destroy(),tbdataCompra=$("#tbdataCompra").DataTable({responsive:!0,data:t,columns:[{data:"fechaString"},{data:"proveedor"},{data:"tipoFactura"},{data:"factura"},{data:"importe",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importe+" </span>"}},{data:"importeIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeIva+" </span>"}},{data:"importeSinIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeSinIva+" </span>"}}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Compras IVA",exportOptions:{columns:[1,2,3,4,5,6,7]}},"pageLength"]})}}else swal("Lo sentimos",t.message,"error")}).catch(t=>{})}function LoadVenta(t){fetch("/Reports/GetIvaReport?idTipoIva=1&date="+t,{method:"GET"}).then(t=>t.json()).then(t=>{if(t.state){var e=t.object;if(e&&4==e.length){setTotalesDebito(e[0].totalSinIva,e[0].totalIva,e[0].totalFacurado),$("#txtNetoADebito").val("$ "+e[0].totalSinIva),$("#txtImporteIvaADebito").val("$ "+e[0].totalIva),$("#txtFacturadoADebito").val("$ "+e[0].totalFacurado),setTotalesDebito(e[1].totalSinIva,e[1].totalIva,e[1].totalFacurado),$("#txtNetoBDebito").val("$ "+e[1].totalSinIva),$("#txtImporteIvaBDebito").val("$ "+e[1].totalIva),$("#txtFacturadoBDebito").val("$ "+e[1].totalFacurado),setTotalesDebito(e[2].totalSinIva,e[2].totalIva,e[2].totalFacurado),$("#txtNetoCDebito").val("$ "+e[2].totalSinIva),$("#txtImporteIvaCDebito").val("$ "+e[2].totalIva),$("#txtFacturadoCDebito").val("$ "+e[2].totalFacurado),setTotalesDebito(e[3].totalSinIva,e[3].totalIva,e[3].totalFacurado),$("#txtNetoXDebito").val("$ "+e[3].totalSinIva),$("#txtImporteIvaXDebito").val("$ "+e[3].totalIva),$("#txtFacturadoXDebito").val("$ "+e[3].totalFacurado);let t=e[0].ivaRows.concat(e[1].ivaRows);t=(t=t.concat(e[2].ivaRows)).concat(e[3].ivaRows),null!=tbdataVenta&&tbdataVenta.destroy(),tbdataVenta=$("#tbdataVenta").DataTable({responsive:!0,data:t,columns:[{data:"fechaString"},{data:"metodoPago"},{data:"importe",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importe+" </span>"}},{data:"importeIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeIva+" </span>"}},{data:"importeSinIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeSinIva+" </span>"}}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Compras IVA",exportOptions:{columns:[1,2,3,4,5,6,7]}},"pageLength"]})}}else swal("Lo sentimos",t.message,"error")})}function LoadServiciosGastos(t){fetch("/Reports/GetIvaReport?idTipoIva=2&date="+t,{method:"GET"}).then(t=>t.json()).then(t=>{if(t.state){var e=t.object;if(e&&4==e.length){let t=[];"servicios_21"==e[0].nombre&&(setTotalesCredito(e[0].totalSinIva,e[0].totalIva,e[0].totalFacurado),$("#txtNetoCreditoServ21").val("$ "+e[0].totalSinIva),$("#txtImporteIvaCreditoServ21").val("$ "+e[0].totalIva),$("#txtFacturadoCreditoServ21").val("$ "+e[0].totalFacurado),t=t.concat(e[0].ivaRows)),"servicios_27"==e[1].nombre&&(setTotalesCredito(e[1].totalSinIva,e[1].totalIva,e[1].totalFacurado),$("#txtNetoCreditoServ27").val("$ "+e[1].totalSinIva),$("#txtImporteIvaCreditoServ27").val("$ "+e[1].totalIva),$("#txtFacturadoCreditoServ27").val("$ "+e[1].totalFacurado),t=t.concat(e[1].ivaRows)),"gastos_21"==e[2].nombre&&(setTotalesCredito(e[2].totalSinIva,e[2].totalIva,e[2].totalFacurado),$("#txtNetoCreditoGastos21").val("$ "+e[2].totalSinIva),$("#txtImporteIvaCreditoGastos21").val("$ "+e[2].totalIva),$("#txtFacturadoCreditoGastos21").val("$ "+e[2].totalFacurado),t=t.concat(e[2].ivaRows)),"gastos_0"==e[3].nombre&&(setTotalesCredito(e[3].totalSinIva,e[3].totalIva,e[3].totalFacurado),$("#txtNetoCreditoGastos0").val("$ "+e[3].totalSinIva),$("#txtImporteIvaCreditoGastos0").val("$ "+e[3].totalIva),$("#txtFacturadoCreditoGastos0").val("$ "+e[3].totalFacurado),t=t.concat(e[3].ivaRows)),$("#btnSearch").LoadingOverlay("hide"),null!=tbdataServicios&&tbdataServicios.destroy(),tbdataServicios=$("#tbdataServicios").DataTable({responsive:!0,data:t,columns:[{data:"fechaString"},{data:"gastos"},{data:"tipoFactura"},{data:"factura"},{data:"importe",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importe+" </span>"}},{data:"importeIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeIva+" </span>"}},{data:"importeSinIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeSinIva+" </span>"}}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Compras IVA",exportOptions:{columns:[1,2,3,4,5,6,7]}},"pageLength"]}),null!=tbdataGastos&&tbdataGastos.destroy(),tbdataGastos=$("#tbdataGastos").DataTable({responsive:!0,data:e[2].ivaRows,columns:[{data:"fechaString"},{data:"tipoGastos"},{data:"gastos"},{data:"tipoFactura"},{data:"factura"},{data:"importe",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importe+" </span>"}},{data:"importeIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeIva+" </span>"}},{data:"importeSinIva",className:"text-end",render:function(t,e,a){return"<span>$ "+a.importeSinIva+" </span>"}}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Compras IVA",exportOptions:{columns:[1,2,3,4,5,6,7]}},"pageLength"]})}}else swal("Lo sentimos",t.message,"error")}).catch(t=>{})}$(document).ready(function(){showLoading(),fetch("/Reports/GetFechasReporteIva").then(t=>{if(t.ok)return t.json();throw new Error("Network response was not ok")}).then(t=>{t.state?0<t.object.length&&t.object.forEach(t=>{$("#txtFecha").append($("<option>").val(t.dateId).text(t.dateText))}):swal("Lo sentimos",t.message,"error")}).catch(t=>{console.error("Error fetching fechas:",t)}),removeLoading()}),$("#btnSearch").click(function(){var t=$("#txtFecha").val();""==t.trim()?toastr.warning("","Debes seleccionar una fecha"):($("#btnSearch").LoadingOverlay("show"),$("#txtNetoFinalCredito").attr("importe",parseFloat(0)),$("#txtImporteIvaFinalCredito").attr("importe",parseFloat(0)),$("#txtFacturadoFinalCredito").attr("importe",parseFloat(0)),$("#txtNetoFinalDebito").attr("importe",parseFloat(0)),$("#txtImporteIvaFinalDebito").attr("importe",parseFloat(0)),$("#txtFacturadoFinalDebito").attr("importe",parseFloat(0)),LoadCompra(t),LoadVenta(t),LoadServiciosGastos(t))});let page=1,pageSize=12,isLoading=!1,hasMoreProducts=!0,debounceTimeout,productos=[];function loadMoreProducts(){var t,e;!isLoading&&hasMoreProducts&&(isLoading=!0,$("#loader").show(),t=$(".btnCategoria.active").attr("cat-id")||0,e=$("#input-search").val()||"",fetch(`/Shop/GetMoreProducts?page=${page}&pageSize=${pageSize}&categoryId=${t}&searchText=`+e).then(t=>{if(t.ok)return t.json();throw new Error("Network response was not ok.")}).then(t=>{t.hasMoreProducts||(hasMoreProducts=!1);var e="-page-"+page;let a=t.html.replace(/pluss-button/g,"pluss-button pluss"+e);a=a.replace(/less-button/g,"less-button less"+e),$("#dvCategoryResults").append(a),$("#loader").hide(),isLoading=!1,page++,attachButtonEvents(e)}).catch(t=>{console.error("Fetch error:",t),$("#loader").hide(),isLoading=!1}))}function searchToggle(t){var e=$(t).closest(".search-wrapper"),a=document.getElementById("input-search").value;e.hasClass("active")?e.hasClass("active")&&0==$(t).closest(".input-holder").length?(e.removeClass("active"),e.find(".search-input").val(""),""!==a&&$(".product-list").css("display","")):e.hasClass("active")&&3<=a.length&&SearchProductByText(a):(e.addClass("active"),event.preventDefault())}function SearchProductByText(t){page=1,hasMoreProducts=!0,$("#dvCategoryResults").empty(),fetch(`/Shop/GetMoreProducts?page=${page}&pageSize=${pageSize}&categoryId=${$(".btnCategoria.active").attr("cat-id")||0}&searchText=`+t).then(t=>{if(t.ok)return t.json();throw new Error("Network response was not ok.")}).then(t=>{t.hasMoreProducts||(hasMoreProducts=!1),$("#dvCategoryResults").append(t.html),$("#loader").hide(),isLoading=!1,page++}).catch(t=>{console.error("Fetch error:",t),$("#loader").hide(),isLoading=!1})}function debounce(a,o){return function(){let t=this,e=arguments;clearTimeout(debounceTimeout),debounceTimeout=setTimeout(()=>a.apply(t,e),o)}}function attachButtonEvents(t){$(".pluss"+t).on("click",function(){setValue(event.currentTarget,1)}),$(".less"+t).on("click",function(){setValue(event.currentTarget,-1)})}function opacityButtonArea(t,e,a){-1===e&&0===t?document.querySelector("#bottom-area-"+a).style.removeProperty("opacity"):1===e&&0<t&&(document.querySelector("#bottom-area-"+a).style.opacity=1)}function clean(){document.getElementById("btnCompras").innerText="Total: $0",document.getElementById("text-area-products").textContent="",$("#text-area-products").hide(),$("#btnTrash").hide(),productos=[],document.querySelectorAll(".input-producto").forEach(function(t){t.value=0;t=t.id.replace("prod-","");document.querySelector("#bottom-area-"+t).style.removeProperty("opacity")})}function resumenVenta(){if(0<productos.length){let e=0;productos.forEach(t=>{e+=t.total});productos.map(t=>`<tr>
                       <td class="table-products" style="border-right-color: #ffffff00;"><span class="text-muted">$ ${Number.parseFloat(t.price).toFixed(2)} x ${t.quantity} ${t.tipoVenta}</span>. - ${t.DescriptionProduct}</td>
                       <td class="table-products" style="font-size: 12px; text-align: right;"><strong>$ ${Number.parseFloat(t.total).toFixed(2)}</strong></td>
                    </tr>`).join("");tableDataShoop=tableDataShoop.concat(`<tr>
                       <td class="table-products" style="font-size: 14px; border-right-color: #ffffff00;"><strong>TOTAL</strong></td>
                       <td class="table-products" style="font-size: 14px; text-align: right;"><strong>$ ${Number.parseFloat(e).toFixed(2)}</strong></td>
                    </tr>`),document.querySelector("#tableProductos").innerHTML=tableDataShoop,$("#modalData").modal("show")}}function finalizarVenta(){var t=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());if(0<t.length)e=`Debe completar los campos : "${t[0].name}"`,toastr.warning(e),$(`input[name="${t[0].name}"]`).focus();else if(""==document.getElementById("cboFormaPago").value)toastr.warning("Debe completaro el campo Forma de Pago","");else if(0<productos.length){var e=document.getElementById("cboFormaPago"),t=e.options[e.selectedIndex].text;let a=structuredClone(BASIC_MODEL_SHOP),o=(a.nombre=$("#txtNombre").val(),a.telefono=$("#txtTelefono").val(),a.direccion=$("#txtDireccion").val(),a.metodoPago=$("#cboFormaPago").val(),a.comentario=$("#txtComentario").val(),document.getElementById("txtPhone").attributes.phoneNumber.value),i=0,n=(productos.forEach(t=>{i+=t.total}),"*NUEVO PEDIDO*%0A");n=n.concat(`
%0A· *Nombre*: ${a.nombre}
%0A· *Telefono*: ${a.telefono} 
%0A· *Direccion*: ${a.direccion} 
%0A· *Forma de pago*: ${t}
%0A· *Comentarios*: ${a.comentario} 
%0A· *TOTAL*: $${Number.parseFloat(i).toFixed(2)}%0A`),n+=productos.map(t=>`%0A - _${t.DescriptionProduct}_: ${t.quantity} `+t.tipoVenta).join(""),$("#modalData").modal("hide"),swal({title:"MUCHAS GRACIAS!",text:"Se abrirá un chat de Whatsapp con nosotros, para que nos envies el pedido.",type:"success"},function(t){window.open("https://wa.me/"+o+"?text="+n,"_blank"),productos.forEach(t=>{delete t.tipoVenta});var e={idFormaDePago:a.metodoPago,total:i,detailSales:productos,nombre:a.nombre,direccion:a.direccion,telefono:a.telefono,comentario:a.comentario,estado:0};fetch("/Shop/RegisterSale",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{t.state||swal("Lo sentimos",t.message,"error")}),clean()})}}$(window).scroll(function(){$(window).scrollTop()+$(window).height()>=$(document).height()-50&&hasMoreProducts&&!isLoading&&loadMoreProducts()}),$(document).ready(function(){loadMoreProducts(),$(".btnCategoria").on("click",function(){page=1,hasMoreProducts=!0,$("#dvCategoryResults").empty(),$(".btnCategoria").removeClass("active"),$(this).addClass("active"),loadMoreProducts()}),$("#search-icon").on("click",function(){searchToggle($(".search-icon")[0])}),$("#input-search").on("input",debounce(function(){searchToggle($(".search-icon")[0])},500)),$("#btnCloseSearchText").on("click",function(){$("#input-search").val(""),page=1,hasMoreProducts=!0,$("#dvCategoryResults").empty(),loadMoreProducts()}),$("#btnTrash").on("click",function(){clean()}),$("#btnCompras").on("click",function(){resumenVenta()}),$(".btnClose").on("click",function(){$("#modalData").modal("hide")}),$("#btnFinalizar").on("click",function(){finalizarVenta()}),otrasFunciones()});let BASIC_MODEL_SHOP={nombre:"",telefono:"",direccion:"",metodoPago:"",comentario:"",total:""};function setValue(t,o){let i=$(t).attr("idProduct");var t=document.getElementById("prod-"+i),n=document.getElementById("price-"+i),r=document.getElementById("desc-"+i);let l=parseFloat(t.value);if(-1!==o||0!==l){"U"===t.attributes.typeinput.value?l+=+o:l+=.5*o,opacityButtonArea(l,o,i),t.value=l;var o=productos.find(t=>t.idProduct===i);o?(o.quantity=l,o.total=l*o.price,0===l&&(productos=productos.filter(t=>t.idProduct!=i))):(o={idProduct:i,quantity:l,price:parseFloat(n.attributes.precio.value),DescriptionProduct:r.attributes.descProd.value,total:l*parseFloat(n.attributes.precio.value),tipoVenta:t.attributes.typeinput.value},productos.push(o));let e=0,a=document.getElementById("text-area-products");a.textContent="";r=productos.slice(-5);productos.forEach(t=>{e+=t.total}),r.forEach(t=>{a.innerText+=`· ${t.DescriptionProduct}: $${Number.parseFloat(t.price).toFixed(2)} x ${t.quantity} = $ ${Number.parseFloat(t.total).toFixed(2)} 
`}),$("#btnTrash").text(productos.length).append('<i class="mdi mdi-trash-can mdi-18px"></i>'),0<productos.length?($("#text-area-products").show(),$("#btnTrash").show()):($("#text-area-products").hide(),$("#btnTrash").hide()),document.getElementById("btnCompras").innerText="Total: $ "+e}}function otrasFunciones(){$(".js-fullheight").css("height",$(window).height()),$(window).resize(function(){$(".js-fullheight").css("height",$(window).height())}),setTimeout(function(){0<$("#ftco-loader").length&&$("#ftco-loader").removeClass("show")},1);{let e=0;$(".ftco-animate").waypoint(function(t){"down"!==t||$(this.element).hasClass("ftco-animated")||(e++,$(this.element).addClass("item-animate"),setTimeout(function(){$("body .ftco-animate.item-animate").each(function(t){let e=$(this);setTimeout(function(){var t=e.data("animate-effect");"fadeIn"===t?e.addClass("fadeIn ftco-animated"):"fadeInLeft"===t?e.addClass("fadeInLeft ftco-animated"):"fadeInRight"===t?e.addClass("fadeInRight ftco-animated"):e.addClass("fadeInUp ftco-animated"),e.removeClass("item-animate")},50*t,"easeInOutExpo")})},100))},{offset:"95%"})}$(".image-popup").magnificPopup({type:"image",closeOnContentClick:!0,closeBtnInside:!1,fixedContentPos:!0,mainClass:"mfp-no-margins mfp-with-zoom",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{verticalFit:!0},zoom:{enabled:!0,duration:300}}),$(".popup-youtube, .popup-vimeo, .popup-gmaps").magnificPopup({disableOn:700,type:"iframe",mainClass:"mfp-fade",removalDelay:160,preloader:!1,fixedContentPos:!1});$(".mouse-icon").on("click",function(t){return t.preventDefault(),$("html,body").animate({scrollTop:$(".goto-here").offset().top},500,"easeInOutExpo"),!1})}AOS.init({duration:800,easing:"slide"}),$(document).ready(function(){fetch("/Tienda/GetTienda").then(t=>{if(console.log(t),t.ok)return t.json();throw new Error("Network response was not ok.")}).then(t=>{console.log(t),1<t.data.length&&$("#cboTiendas").append($("<option>").val("-1").text("")),0<t.data.length&&t.data.forEach(t=>{$("#cboTiendas").append($("<option>").val(t.idTienda).text(t.nombre))})}).catch(t=>{console.error("Fetch error:",t)})}),$(document).ready(function(){$("#tbData").DataTable({responsive:!0,ajax:{url:"/Notification/GetNotificaciones",type:"GET",datatype:"json"},columnDefs:[{targets:[2],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY HH:mm"):"":t}}],columns:[{data:"idNotifications",visible:!1,searchable:!1},{data:"descripcion"},{data:"registrationDate"},{data:"isActive",render:function(t){return 1==t?'<span class="badge badge-info">Activo</span>':'<span class="badge badge-danger">Inactivo</span>'}},{data:"modificationUser"},{data:"modificationDateString"}],order:[[2,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Notificaciones",exportOptions:{columns:[1,2,3,4,5]}},"pageLength"]})});let proveedoresListPedido=[],tableDataPedido,rowSelectedPedido,BASIC_MODEL_PEDIDO_WEB={idPedido:0,importeEstimado:0,estado:1,comentario:"",idProveedor:0,registrationDate:null,registrationUser:"",cantidadProductos:0,productos:[]},BASIC_MODEL_RECIBIR={idPedido:0,importeEstimado:0,estado:1,comentario:"",idProveedor:0,registrationDate:null,registrationUser:"",productos:[],tipoFactura:null,nroFactura:null,iva:null,ivaImporte:null,importeSinIva:null,estadoPago:0,facturaPendiente:0};function calcularTotalCosto(){let a=0;$("#tablaProductos tbody").find("tr").each(function(){var t=$(this).find(".editable").text();let e=parseInt(""!=t?t:0);(isNaN(e)||e<1)&&(e=0);t=$(this).find("td:eq(2)").text().slice(1).trim(),t=parseFloat(t);a+=e*t}),$("#txtImporteEstimado").val(a)}function calcularTotalProductosRecibidos(){let a=0;$("#tablaProductosRecibidos tbody").find("tr").each(function(){var t=$(this).find(".editable").text();let e=parseInt(""!=t?t:0);(isNaN(e)||e<1)&&(e=0);t=$(this).find("td:eq(3)").text().slice(1).trim(),t=parseFloat(t);a+=e*t}),$("#txtImporteRecibido").val(a),calcularIva()}$(document).ready(function(){showLoading(),fetch("/Admin/GetProveedoresConProductos").then(t=>t.json()).then(t=>{t.state?((proveedoresListPedido=t.object).forEach(t=>{$("#cboProveedor").append($("<option>").val(t.idProveedor).text(t.nombre))}),removeLoading()):swal("Lo sentimos",t.message,"error")}),tableDataPedido=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Pedido/GetPedidos",type:"GET",datatype:"json"},columnDefs:[{targets:[3],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY HH:mm"):"":t}},{targets:[5],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY HH:mm"):"":t}}],columns:[{data:"idPedido",visible:!1,searchable:!1},{data:"orden",visible:!1,searchable:!1},{data:"proveedor.nombre"},{data:"registrationDate"},{data:"importeEstimadoString"},{data:"fechaCerrado"},{data:"estado",className:"text-center",render:function(t){return 0==t?'<span class="badge rounded-pill bg-danger">Cancelado</span>':1==t?'<span class="badge rounded-pill bg-info">Iniciado</span>':2==t?'<span class="badge rounded-pill bg-primary">Enviado</span>':'<span class="badge rounded-pill bg-success">Recibido</span>'}},{data:"estado",className:"text-center",render:function(t){return 2==t?'<button class="btn btn-secondary btn-sm btn-recibir">Recibir</button>':""}},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[1,"asc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Pedidos",exportOptions:{columns:[1,2,3,4,5,6]}},"pageLength"]}),new ClipboardJS("#btnCopiar"),$(document).on("blur",".editable",function(){var t=parseInt($(this).text());(isNaN(t)||t<0)&&$(this).text("")})}),$("#btnVolver").on("click",function(){$("#panelGenerarMensaje").hide(),$("#panelProductos").show()}),$("#tablaProductos tbody").on("blur",".editable",function(){calcularTotalCosto()}),$("#tablaProductosRecibidos tbody").on("blur",".editable",function(){calcularTotalProductosRecibidos()});let openModalPedido=(t=BASIC_MODEL_PEDIDO_WEB)=>{var e;switch($("#btnVolver").click(),$("#txtIdPedido").val(t.idPedido),0!=t.idPedido?(cargarTabla(t.productos,t.idProveedor,1==t.estado),$("#cboProveedor").val(t.idProveedor),$("#cboProveedor").prop("disabled",!0),$("#cboEstado").val(t.estado),setTimeout(function(){$("#cboEstado").prop("disabled",!0),$("#txtImporteEstimado").val(t.importeFinal??t.importeEstimado)},500),e=3===t.estado,$("#txtComentario, #btnGenerar, #cboEstado, #btnSave").prop("disabled",e)):$("#cboProveedor").prop("disabled",!1),null==t.fechaCerradoString||""==t.fechaCerradoString?document.getElementById("divFechaCerrado").style.display="none":(document.getElementById("divFechaCerrado").style.display="",$("#txtCerrado").val(t.fechaCerradoString),$("#txtCerradoUsuario").val(t.usuarioFechaCerrado)),t.estado){case 1:setTimeout(function(){$("#cboEstado").prop("disabled",!1)},500);break;case 2:$("#optionRecibido").hide(),$("#lblCantPedir").text("Cantidad Pedida");break;case 3:$("#optionRecibido").show(),$("#lblCantPedir").text("Cantidad Recibida"),$('label[for="txtImporteEstimado"]').text("Importe");break;default:$("#optionRecibido").hide(),$("#lblCantPedir").text("Cantidad a Pedir")}$("#modalData").modal("show")};function cargarTabla(s,e,t){let d=document.querySelector("#tablaProductos tbody");d.innerHTML="";var a=proveedoresListPedido.find(t=>t.idProveedor==e);let c=t?'class="editable" contenteditable="true"':"";a.products.forEach(e=>{var t=document.createElement("tr"),a=s.find(t=>t.idProducto==e.idProducto);let o="";var i=e.idProducto,n=e.description,r=e.costPrice,l=parseInt(null!=e.stocks&&0<e.stocks.length?e.stocks[0].stockActual:0);null!=a&&(o=null!=a.cantidadProductoRecibida?a.cantidadProductoRecibida:(null==a.cantidadProducto&&(a.cantidadProducto=""),a.cantidadProducto)),t.innerHTML=`
                              <td hidden>${i}</td>
                              <td>${n}</td>
                              <td>$ ${r}</td>
                              <td>${null!=l?l:0}</td>
                              <td ${c} inputmode="numeric" pattern="[0-9]*" min="0" >${o}</td>
                            `,d.appendChild(t)})}function limpiarTablaYTotal(){$("#tablaProductos tbody").empty(),$("#txtImporteEstimado").val(0),$("#cboProveedor").val(""),$("#txtComentario").val("")}$("#btnNew").on("click",function(){openModalPedido(),$("#cboEstado").val(1)}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedPedido=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataPedido.row(rowSelectedPedido).data();openModalPedido(t),calcularTotalCosto()}),$("#btnGenerar").on("click",function(){let e="Pedido:<br><br>",a=!1;$("#tablaProductos").find("tbody tr").each(function(){var t=$(this).find("td:eq(4)").text();0<parseInt(null!=t?t:0)&&(a=!0,e+="- "+$(this).find("td:eq(1)").text()+" x "+t.toLowerCase()+"<br>")}),a?($("#btnCopiar").attr("data-clipboard-target","#labelTabla"),$("#labelTabla").html(e),$("#panelGenerarMensaje").show(),$("#panelProductos").hide(),1==$("#cboEstado").val()&&$("#cboEstado").val(2)):($("#panelGenerarMensaje").hide(),$("#panelProductos").show()),document.querySelectorAll(".editable").forEach(function(t){t.addEventListener("click",function(){this.focus()}),t.addEventListener("input",function(){let t=parseFloat(this.textContent);isNaN(t)&&(t=0),this.textContent=t})})}),$("#cboProveedor").change(function(){$("#txtImporteEstimado").val(0);let e=$(this).val();var t=proveedoresListPedido.find(t=>t.idProveedor==e);cargarTabla(t.products,e,!0)}),$("#modalData").on("hidden.bs.modal",function(){limpiarTablaYTotal()}),$("#btnSave").on("click",function(){$("#modalData").find("div.modal-content").LoadingOverlay("show"),calcularTotalCosto();var t=structuredClone(BASIC_MODEL_PEDIDO_WEB);t.idPedido=parseInt($("#txtIdPedido").val()),t.importeEstimado=parseFloat($("#txtImporteEstimado").val()),t.comentario=$("#txtComentario").val(),t.idProveedor=$("#cboProveedor").val(),t.cantidadProductos=$("#txtDescripcionTipoDeGasto").val(),t.estado=parseInt($("#cboEstado").val());let e=[];$("#tablaProductos tbody tr").each(function(){var t=parseInt($(this).find("td:last-child").text());!isNaN(t)&&0<t&&(t={idProducto:parseInt($(this).find("td:eq(0)").text()),cantidadProducto:t},e.push(t))}),t.productos=e,t.cantidadProductos=e.length,0==t.idPedido?fetch("/Pedido/CreatePedido",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataPedido.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","Pedido fue creado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Pedido/UpdatePedidos",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?($("#modalData").modal("hide"),swal("Exitoso!","Pedido fue modificado","success"),location.reload()):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")})}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataPedido.row(e).data());1==a.estado&&swal({title:"Esta seguro?",text:`Eliminar pedido de "${a.proveedor.nombre} por $${a.importeEstimado}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Pedido/DeletePedido?idPedido="+a.idPedido,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataPedido.row(e).remove().draw(),swal("Exitoso!","El pedido  fue eliminada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),$("#tbData tbody").on("click",".btn-recibir",function(){rowSelectedPedido=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataPedido.row(rowSelectedPedido).data();openModalRecibido(t)});let openModalRecibido=(t=BASIC_MODEL_PEDIDO_WEB)=>{$("#txtIdPedidoRecibido").val(t.idPedido),$("#txtComentarioRecibido").val(t.comentario),$("#txtProveedorRecibido").val(t.proveedor.nombre),$("#txtFechaCreacion").val(t.registrationDateString),$("#txtCreationUser").val(t.registrationUser),$("#txtIdProveedor").val(t.proveedor.idProveedor),$("#txtIva").val(t.proveedor.iva??""),$("#cboTipoFactura").val(t.proveedor.tipoFactura??"");let a=0;$.each(t.productos,function(t,e){a+=e.cantidadProducto}),$("#txtCantidadProductos").val(a),cargarTablaRecibidos(t.productos,t.idProveedor),$("#modalDataRecibido").modal("show")};function cargarTablaRecibidos(t,e){let n=document.querySelector("#tablaProductosRecibidos tbody"),r=(n.innerHTML="",proveedoresListPedido.find(t=>t.idProveedor==e));t.forEach(e=>{var t=document.createElement("tr"),a=r.products.find(t=>t.idProducto==e.idProducto),o=e.idPedidoProducto,i=a.description;t.innerHTML=`
                              <td hidden>${o}</td>
                              <td hidden>${e.idProducto}</td>
                              <td>${i}</td>
                              <td>$ ${a.costPrice}</td>
                              <td>${e.cantidadProducto}</td>
                              <td class="editable" contenteditable="true" inputmode="numeric" pattern="[0-9]*" min="0" ></td>
                              <td class="editableText" contenteditable="true" inputmode="text"></td>
                              <td class="editableText" contenteditable="true" inputmode="text"></td>
                            `,n.appendChild(t)})}function mostrarAdvertencia(t){toastr.warning(t,""),$("#modalDataRecibido").find("div.modal-content").LoadingOverlay("hide")}function validarFecha(t){/^(\d{2})\/(\d{2})\/(\d{4})$/.test(t);var t=t.split("/"),e=parseInt(t[0],10),a=parseInt(t[1],10),t=parseInt(t[2],10);return!(isNaN(e)||isNaN(a)||isNaN(t)||e<1||31<e||a<1||12<a||t<1e3||9999<t)}function calcularIva(){var t=$("#txtImporteRecibido").val(),t=parseFloat(""==t?0:t),e=parseFloat($("#txtIva").val());isNaN(t)||isNaN(e)||(e=t-(t=t/(1+e/100)),$("#txtImporteSinIva").val(t.toFixed(2)),$("#txtImporteIva").val(e.toFixed(2)))}$("#btnCerrarPedido").on("click",function(){calcularTotalProductosRecibidos();var t=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());if(0<t.length)e=`Debe completar los campos : "${t[0].name}"`,toastr.warning(e,""),$(`input[name="${t[0].name}"]`).focus();else{$("#modalDataRecibido").find("div.modal-content").LoadingOverlay("show");var e=structuredClone(BASIC_MODEL_RECIBIR);let r=parseInt($("#txtIdPedidoRecibido").val()),l=(e.idPedido=r,e.importeEstimado=parseFloat($("#txtImporteRecibido").val()),e.comentario=$("#txtComentarioRecibido").val(),e.idProveedor=parseInt($("#txtIdProveedor").val()),e.tipoFactura=$("#cboTipoFactura").val(),e.nroFactura=$("#txtNroFactura").val(),e.iva=$("#txtIva").val(),e.ivaImporte=$("#txtImporteIva").val(),e.importeSinIva=$("#txtImporteSinIva").val(),e.estadoPago=parseInt($("#cboEstadoFactura").val()),e.facturaPendiente=document.querySelector("#cbxFacturaPendiente").checked,[]),s=!0,d=!1;$("#tablaProductosRecibidos tbody tr").each(function(){var t=parseInt($(this).find("td:eq(0)").text()),e=parseInt($(this).find("td:eq(1)").text()),a=parseInt($(this).find("td:eq(4)").text()),o=parseInt($(this).find("td:eq(5)").text());let i=$(this).find("td:eq(6)").text();var n=$(this).find("td:eq(7)").text();d=""==$(this).find("td:eq(5)").text(),""!=i?s=validarFecha(i):i=null,isNaN(o)||(t={idPedidoProducto:t,idPedido:r,idProducto:e,cantidadProducto:a,vencimiento:i,lote:n,cantidadProductoRecibida:o},l.push(t))}),e.productos=l,d?mostrarAdvertencia("Debe ingresar la cantidad recibida de todos los productos"):s?0!=e.idPedido&&fetch("/Pedido/CerrarPedidos",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(t=>($("#modalDataRecibido").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?($("#modalDataRecibido").modal("hide"),swal("Exitoso!","Pedido fue recibido","success"),location.reload()):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalDataRecibido").find("div.modal-content").LoadingOverlay("hide")}):mostrarAdvertencia("Debe ingresar fechas de vencimiento validas (dd/mm/aaaa)")}}),$("#txtIva").change(function(){calcularIva()}),$("#txtImporteRecibido").keyup(function(){calcularIva()}),(a=>{a(".ftco-animate").waypoint(function(t){"down"!==t||a(this.element).hasClass("ftco-animated")||(a(this.element).addClass("item-animate"),setTimeout(function(){a("body .ftco-animate.item-animate").each(function(t){var e=a(this);setTimeout(function(){var t=e.data("animate-effect");"fadeIn"===t?e.addClass("fadeIn ftco-animated"):"fadeInLeft"===t?e.addClass("fadeInLeft ftco-animated"):"fadeInRight"===t?e.addClass("fadeInRight ftco-animated"):e.addClass("fadeInUp ftco-animated"),e.removeClass("item-animate")},50*t,"easeInOutExpo")})},100))},{offset:"95%"})})(jQuery);let tableDataPromociones,rowSelectedPromocion,BASIC_MODEL_PROMOCION={idPromocion:0,nombre:"",idProducto:null,operador:null,cantidadProducto:null,idCategory:null,dias:null,precio:null,porcentaje:null,isActive:1,modificationDate:null,modificationUser:null},dataDays=[{id:1,text:"Lunes"},{id:2,text:"Martes"},{id:3,text:"Miercoles"},{id:4,text:"Jueves"},{id:5,text:"Viernes"},{id:6,text:"Sabado"},{id:7,text:"Domingo"}];function formatResults(t){return t.loading?t.text:$(`<table width="90%">
            <tr>
                <td style="width:60px">
                    <img style="height:60px;width:60px;margin-right:10px" src="data:image/png;base64,${t.photoBase64}"/>
                </td>
                <td>
                    <p style="font-weight: bolder;margin:2px">${t.text}</p>
                    <p>$ ${t.price}</p>
                </td>
            </tr>
         </table>`)}$(document).ready(function(){$("#cboProducto").select2({ajax:{url:"/Sales/GetProducts",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(t){return{search:t.term}},processResults:function(t){return{results:t.map(t=>({id:t.idProduct,text:t.description,brand:t.brand,category:t.nameCategory,photoBase64:t.photoBase64,price:parseFloat(t.price),tipoVenta:t.tipoVenta}))}}},placeholder:"Buscando producto...",minimumInputLength:1,templateResult:formatResults,allowClear:!0,dropdownParent:$("#modalData .modal-content")}),$("#cboCategoria").select2({ajax:{url:"/Inventory/GetCategoriesSearch",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(t){return{search:t.term}},processResults:function(t){return{results:t.map(t=>({id:t.idCategory,text:t.description}))}}},allowClear:!0,multiple:!0,placeholder:"Buscar categorias...",debug:!0,minimumInputLength:1,dropdownParent:$("#modalData .modal-content")}),$("#cboDias").select2({allowClear:!0,debug:!0,data:dataDays,multiple:!0,placeholder:"Buscar dias...",dropdownParent:$("#modalData .modal-content")}),tableDataPromociones=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Admin/GetPromociones",type:"GET",datatype:"json"},columns:[{data:"idPromocion",visible:!1,searchable:!1},{data:"nombre"},{data:"promocionString"},{data:"isActive",render:function(t){return 1==t?'<span class="badge badge-info btn btn-cambiar-estado">Activo</span>':'<span class="badge badge-danger btn btn-cambiar-estado">Inactivo</span>'}},{defaultContent:'<button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"110px"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Promociones",exportOptions:{columns:[1,2,3]}},"pageLength"]}),$(document).on("click","span.btn-cambiar-estado",function(t){let e;e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var a=tableDataPromociones.row(e).data();null==a&&(a=tableDataPromociones.row(e).data()),swal({title:"¿Desea cambiar el estado de la promocion? ",text:` 
 Nombre: ${a.nombre} 

 ${a.promocionString}  
  
 `,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, cambiar estado",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/CambiarEstadoPromocion?idPromocion="+a.idPromocion,{method:"PUT"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?location.reload():swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})})}),$("#btnNew").on("click",function(){openModalPromocion()}),$(document).on("select2:open",()=>{document.querySelector(".select2-search__field").focus()});let openModalPromocion=(t=BASIC_MODEL_PROMOCION)=>{var e;(0!=t.idPromocion?$("#cboDias").select2().val(t.dias):($("#cboDias").val(null).trigger("change"),$("#cboCategoria").val(null).trigger("change"),$("#cboProducto").val(null))).trigger("change"),$("#txtId").val(t.idPromocion),$("#txtNombre").val(t.nombre),$("#cboState").val(t.isActive?1:0),$("#cboOperador").val(t.operador),$("#txtCantidad").val(t.cantidadProducto),$("#txtPrecio").val(t.precio),$("#txtPorcentaje").val(t.porcentaje),null===t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#modalData").modal("show")};$("#btnSave").on("click",function(){var t,e=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):(null==$("#cboProducto").val()&&($("#cboOperador").val(""),$("#txtCantidad").val("")),""!=$("#txtPorcentaje").val()&&""!=$("#txtPrecio").val()?toastr.warning("Solo es posible completar un campo de PRECIO o PORCENTAJE",""):""==$("#txtPorcentaje").val()&&""==$("#txtPrecio").val()?toastr.warning("Debe completar al menos un campo de PRECIO o PORCENTAJE",""):((t=structuredClone(BASIC_MODEL_PROMOCION)).idPromocion=$("#txtId").val(),t.nombre=$("#txtNombre").val(),t.isActive="1"===$("#cboState").val(),t.operador=""!=$("#cboOperador").val()?$("#cboOperador").val():null,t.cantidadProducto=""!=$("#txtCantidad").val()?$("#txtCantidad").val():null,t.idProducto=""!=$("#cboProducto").val()?$("#cboProducto").val():null,t.idCategory=""!=$("#cboCategoria").val()?$("#cboCategoria").val():null,t.dias=""!=$("#cboDias").val()?$("#cboDias").val():null,t.precio=""!=$("#txtPrecio").val()?$("#txtPrecio").val():null,t.porcentaje=""!=$("#txtPorcentaje").val()?$("#txtPorcentaje").val():null,$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idPromocion?fetch("/Admin/CreatePromociones",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataPromociones.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","Promociones fué creada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Admin/UpdatePromociones",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataPromociones.row(rowSelectedPromocion).data(t.object).draw(!1),rowSelectedPromocion=null,$("#modalData").modal("hide"),swal("Exitoso!","Promociones fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")})))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedPromocion=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataPromociones.row(rowSelectedPromocion).data();openModalPromocion(t)}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataPromociones.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar Promociones "${a.nombre}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/DeletePromociones?idPromocion="+a.idPromocion,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataPromociones.row(e).remove().draw(),swal("Exitoso!","Promociones  fué eliminada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})});let tableDataProveedor,rowSelectedProveedor,tableDataMovimientos,tableDataProveedores,proveedoresList,monthNamesProveedores=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],BASIC_MODEL_PROVEEDOR={idProveedor:0,nombre:"",cuil:null,telefono:null,direccion:null,nombreContacto:null,telefono2:null,email:null,web:null,comentario:null,iva:null,registrationDate:null,modificationDate:null,modificationUser:null},BASIC_MODEL_PAGO={idProveedor:0,tipoFactura:null,nroFactura:null,iva:0,ivaImporte:0,importe:0,importeSinIva:0,comentario:null,estadoPago:0,facturaPendiente:0,modificationDate:null,modificationUser:null},openModalProveedor=($(document).ready(function(){showLoading(),tableDataProveedor=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Admin/GetProveedores",type:"GET",datatype:"json"},columns:[{data:"idProveedor",visible:!1,searchable:!1},{data:"nombre"},{data:"cuil"},{data:"nombreContacto"},{data:"telefono"},{data:"web"},{data:"comentario"},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[1,"asc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Proveedors",exportOptions:{columns:[1,2,3]}},"pageLength"]}),fetch("/Tienda/GetTienda").then(t=>t.json()).then(t=>{document.getElementById("divSwitchVisionGlobalProveedores").style.display=null!=t.data&&1<t.data.length?"":"none"}),cargarTablaGastos(!1),cargarTablaDinamica(!1),fetch("/Admin/GetProveedores").then(t=>t.json()).then(t=>{0<t.data.length&&(proveedoresList=t.data,t.data.forEach(t=>{$("#cboProveedor").append($("<option>").val(t.idProveedor).text(t.nombre))}))}),$(document).on("click","span.btn-pago-pagado",function(t){let e;e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");let a;a=(null==tableDataMovimientos?tableDataProveedores:tableDataMovimientos).row(e).data(),swal({title:"¿Desea cambiar el estado a Pagado? ",text:` 
 Factura: ${a.tipoFacturaString} ${a.nroFactura} 
 Importe: ${a.importeString}  
  
 `,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, cambiar estado",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/CambioEstadoPagoProveedor?idMovimiento="+a.idProveedorMovimiento,{method:"PUT"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?location.reload():swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),removeLoading()}),$("#switchVisionGlobalProveedores").change(function(){var t=$(this).is(":checked");cargarTablaGastosProveedores(t),cargarTablaDinamicaProveedores(t)}),$("#btnNuevoGasto").on("click",function(){$("#modalPago").modal("show")}),$("#cboProveedor").change(function(){let e=$(this).val();var t=proveedoresList.find(t=>t.idProveedor==e);null!=t?($("#txtCuilPago").val(t.cuil),$("#txtDireccionPago").val(t.direccion),$("#txtIva").val(null!=t.iva?t.iva:""),$("#cboTipoFacturaPago").val(t.tipoFactura??"")):($("#txtCuilPago").val(""),$("#txtDireccionPago").val(""),$("#txtIva").val(""),$("#cboTipoFacturaPago").val(""))}),(t=BASIC_MODEL_PROVEEDOR)=>{$("#txtId").val(t.idProveedor),$("#txtNombre").val(t.nombre),$("#txtCuil").val(t.cuil),$("#txtDireccion").val(t.direccion),$("#txtTelefono").val(t.telefono),$("#txtTelefono2").val(t.telefono2),$("#txtContacto").val(t.nombreContacto),$("#txtWeb").val(t.web),$("#txtEmail").val(t.email),$("#txtIvaProveedor").val(t.iva),$("#txtComentario").val(t.comentario),$("#cboTipoFactura").val(t.tipoFactura),null===t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),null!=tableDataMovimientos&&tableDataMovimientos.destroy();var e="/Admin/GetMovimientoProveedor?idProveedor="+t.idProveedor;tableDataMovimientos=$("#tbMovimientos").DataTable({responsive:!0,ajax:{url:e,type:"GET",datatype:"json"},columns:[{data:"idProveedorMovimiento",visible:!1,searchable:!1},{data:"registrationDateString"},{data:"importeString"},{data:"tipoFacturaString"},{data:"nroFactura"},{data:"estadoPago",className:"text-center",render:function(t){return 0==t?'<span class="badge rounded-pill bg-success">Pagado</span>':'<span class="btn btn-pago-pagado badge rounded-pill bg-warning text-dark">Pendiente</span>'}},{data:"registrationUser"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Pago Proveedores",exportOptions:{columns:[1,2,3,4,5]}},"pageLength"]}),$("#modalData").modal("show")});function cargarTablaGastosProveedores(t){t="/Admin/GetAllMovimientoProveedor?visionGlobal="+t;$.fn.DataTable.isDataTable("#tbDataGastos")&&$("#tbDataGastos").DataTable().clear().destroy(),tableDataProveedores=$("#tbDataGastos").DataTable({responsive:!0,pageLength:10,rowCallback:function(t,e){1==e.facturaPendiente&&$("td:eq(2)",t).addClass("factura-pendiente")},ajax:{url:t,type:"GET",datatype:"json"},columns:[{data:"idProveedorMovimiento",visible:!1,searchable:!1},{data:"registrationDateString"},{data:"nombreProveedor"},{data:"nroFactura",render:function(t,e,a){return"<span>"+a.tipoFacturaString+" </span><span> "+a.nroFactura+"</span>"}},{data:"comentario"},{data:"estadoPago",className:"text-center",render:function(t){return 0==t?'<span class="badge rounded-pill bg-success">Pagado</span>':'<span class="btn btn-sm btn-pago-pagado rounded-pill bg-warning text-dark">Pendiente</span>'}},{data:"importeString",className:"text-center"},{defaultContent:'<button class="btn btn-primary btn-edit-pago btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete-pago btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"130px",className:"text-center"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Gastos Proveedores",exportOptions:{columns:[1,2,3,4,5,6]}},"pageLength"]})}$("#btnNew").on("click",function(){openModalProveedor()}),$("#btnSave").on("click",function(){var t,e=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):((t=structuredClone(BASIC_MODEL_PROVEEDOR)).idProveedor=$("#txtId").val(),t.nombre=$("#txtNombre").val(),t.direccion=$("#txtDireccion").val(),t.cuil=$("#txtCuil").val(),t.telefono=$("#txtTelefono").val(),t.telefono2=$("#txtTelefono2").val(),t.nombreContacto=$("#txtContacto").val(),t.web=$("#txtWeb").val(),t.email=$("#txtEmail").val(),t.iva=$("#txtIvaProveedor").val(),t.comentario=$("#txtComentario").val(),t.tipoFactura=parseInt($("#cboTipoFactura").val()),$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idProveedor?fetch("/Admin/CreateProveedor",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProveedor.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","Proveedor fué creada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Admin/UpdateProveedor",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProveedor.row(rowSelectedProveedor).data(t.object).draw(!1),rowSelectedProveedor=null,$("#modalData").modal("hide"),swal("Exitoso!","Proveedor fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),$("#btnSavePago").on("click",function(){var t,e=$("input.input-validate-pago").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):""==$("#cboProveedor").val()?toastr.warning("Debe seleccionar un proveedor",""):((t=structuredClone(BASIC_MODEL_PAGO)).idProveedorMovimiento=parseInt($("#txtIdPagoProveedor").val()),t.idProveedor=$("#cboProveedor").val(),t.tipoFactura=$("#cboTipoFacturaPago").val(),t.nroFactura=$("#txtNroFactura").val(),t.iva=""!=$("#txtIva").val()?$("#txtIva").val():0,t.ivaImporte=""!=$("#txtImporteIva").val()?$("#txtImporteIva").val():0,t.importe=$("#txtImporte").val(),t.importeSinIva=""!=$("#txtImporteSinIva").val()?$("#txtImporteSinIva").val():0,t.comentario=$("#txtComentarioPago").val(),t.estadoPago=parseInt($("#cboEstado").val()),t.facturaPendiente=document.querySelector("#cbxFacturaPendiente").checked,$("#modalPago").find("div.modal-content").LoadingOverlay("show"),0==t.idProveedorMovimiento?fetch("/Admin/RegistrarPagoProveedor",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalPago").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProveedores.row.add(t.object).draw(!1),$("#modalPago").modal("hide"),swal("Exitoso!","Pago a proveedor fué creada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalPago").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Admin/UpdatePagoProveedor",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalPago").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProveedores.row(rowSelectedProveedor).data(t.object).draw(!1),rowSelectedProveedor=null,$("#modalPago").modal("hide"),swal("Exitoso!","Pago a proveedor fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalPago").find("div.modal-content").LoadingOverlay("hide")}))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedProveedor=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataProveedor.row(rowSelectedProveedor).data();openModalProveedor(t)}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataProveedor.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar Proveedor "${a.nombre}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/DeleteProveedor?idProveedor="+a.idProveedor,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProveedor.row(e).remove().draw(),swal("Exitoso!","Proveedor  fué eliminada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})}),$("#tbDataGastos tbody").on("click",".btn-edit-pago",function(){rowSelectedProveedor=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataProveedores.row(rowSelectedProveedor).data();openModalPago(t)}),$("#tbDataGastos tbody").on("click",".btn-delete-pago",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataProveedores.row(e).data());swal({title:"¿Está seguro?",text:"Eliminar el pago",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/DeletePagoProveedor?idPagoProveedor="+a.idProveedorMovimiento,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataProveedores.row(e).remove().draw(),swal("Exitoso!","El pago a producto fué eliminado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})});let openModalPago=(t=BASIC_MODEL_PAGO)=>{var e;$("#txtIdPagoProveedor").val(t.idProveedorMovimiento),$("#txtCuilPago").val(t.proveedor.cuil),$("#txtDireccionPago").val(t.proveedor.direccion),$("#cboTipoFactura").val(t.tipoFactura),$("#txtNroFactura").val(t.nroFactura),$("#txtIva").val(t.iva),$("#txtImporteIva").val(t.ivaImporte),$("#txtImporte").val(t.importe),$("#txtImporteSinIva").val(t.importeSinIva),$("#txtComentarioPago").val(t.comentario),$("#cboEstado").val(t.estadoPago),$("#cboProveedor").val(t.idProveedor),document.getElementById("cbxFacturaPendiente").checked=t.facturaPendiente,null===t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#modalPago").modal("show")};function calcularIva(){var t=$("#txtImporte").val(),t=parseFloat(""==t?0:t),e=parseFloat($("#txtIva").val());isNaN(t)||isNaN(e)||(e=t-(t=t/(1+e/100)),$("#txtImporteSinIva").val(t.toFixed(2)),$("#txtImporteIva").val(e.toFixed(2)))}function cargarTablaDinamicaProveedores(t){t="/Admin/GetProveedorTablaDinamica?visionGlobal="+t;$("#wdr-component").LoadingOverlay("show"),fetch(t,{method:"GET"}).then(t=>($("#wdr-component").LoadingOverlay("hide"),t.json())).then(t=>{var e,a;t.state?t.object!=[]&&(a=new Date,e="fecha.Month."+monthNamesProveedores[a.getMonth()],a="fecha.Year."+a.getFullYear(),window.pivot&&window.pivot.dispose(),window.pivot=new WebDataRocks({container:"#wdr-component",toolbar:!0,report:{dataSource:{data:t.object},formats:[{name:"currency",currencySymbol:"$"}],slice:{reportFilters:[{uniqueName:"fecha.Day"},{uniqueName:"fecha.Month",filter:{members:[e]}},{uniqueName:"fecha.Year",filter:{members:[a]}}],rows:[{uniqueName:"nombre_Proveedor",sort:"desc"},{uniqueName:"tipo_Factura",sort:"desc"},{uniqueName:"nro_Factura",sort:"desc"}],columns:[{uniqueName:"[Measures]"}],measures:[{uniqueName:"importe",caption:"Importe",aggregation:"sum",active:!0,format:"currency"},{uniqueName:"importe_Sin_Iva",caption:"Importe sin IVA",aggregation:"sum",active:!0,format:"currency"},{uniqueName:"iva_Importe",caption:"Importe IVA",aggregation:"sum",active:!0,format:"currency"}]}},global:{localization:"https://cdn.webdatarocks.com/loc/es.json"}})):swal("Lo sentimos",t.message,"error")})}$("#txtIva").change(function(){calcularIva()}),$("#txtImporte").keyup(function(){calcularIva()});let tableDataReportProds;function setToday(){var t=new Date,t=new Date(t.getFullYear(),t.getMonth(),t.getDate());$("#txtStartDate, #txtEndDate").datepicker("setDate",t),$("#btnSearch").click()}$(document).ready(function(){$("#txtStartDate").datepicker({dateFormat:"dd/mm/yy"}),$("#txtEndDate").datepicker({dateFormat:"dd/mm/yy"}),fetch("/Inventory/GetCategories").then(t=>t.json()).then(t=>{$("#cboCategory").append($("<option>").val("Todo").text("Todo")),0<t.data.length&&t.data.forEach(t=>{$("#cboCategory").append($("<option>").val(t.description).text(t.description))})})}),$("#btnSearch").click(function(){var t,e,a=$("#txtStartDate").val();""==a.trim()?toastr.warning("","Debes ingresar al menos la fecha de inicio"):(""==$("#txtEndDate").val().trim()&&$("#txtEndDate").datepicker("setDate",a),t=$("#txtEndDate").val().trim(),e=$("#cboCategory").val(),null!=tableDataReportProds&&tableDataReportProds.destroy(),e={processing:!0,ajax:{url:`/Reports/GetProductsReport?idCategoria=${e}&startDate=${a}&endDate=`+t,type:"GET",datatype:"json"},columns:[{data:"productName"},{data:"categoria"},{data:"proveedor"},{data:"precio1",render:function(t,e,a){return"<span>"+a.precio1+" / "+a.tipoVenta+" </span>"}},{data:"precio2",render:function(t,e,a){return"<span>"+a.precio2+" / "+a.tipoVenta+" </span>"}},{data:"precio3",render:function(t,e,a){return"<span>"+a.precio3+" / "+a.tipoVenta+" </span>"}},{data:"costo"},{data:"stock"},{data:"cantidad"}],order:[[8,"desc"]],scrollX:!0,dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Productos Vendidos"},"pageLength"]},tableDataReportProds=$("#tbdata").DataTable(e))});let idSale,rowSelectedHistoric,SEARCH_VIEW={searchDate:()=>{$("#txtStartDate").val(""),$("#txtEndDate").val(""),$("#txtSaleNumber").val(""),$(".search-date").show(),$(".search-sale").hide()},searchSale:()=>{$("#txtStartDate").val(""),$("#txtEndDate").val(""),$("#txtSaleNumber").val(""),$(".search-sale").show(),$(".search-date").hide()}},isHealthySaleHistory=!1;async function healthcheck(){(isHealthySaleHistory=await getHealthcheck())?document.getElementById("lblErrorPrintService").style.display="none":document.getElementById("lblErrorPrintService").style.display=""}function createTable(e){if($("#tbsale tbody").html(""),0<e.length){let a=0,t=e.reduce((t,e)=>(t[e.saleNumber]=void 0===t[e.saleNumber]?1:t[e.saleNumber]+=1,t),{});e.forEach(t=>{a+=parseFloat(t.totalDecimal);var e=!1;"Presupuesto"==t.typeDocumentSale&&(e=!0,t.typeDocumentSale=t.typeDocumentSale+" "),$("#tbsale tbody").append($("<tr>").append($("<td>").append($("<span>").text(t.registrationDate),t.isWeb?$("<i>").addClass("mdi mdi-web ms-3").attr("title","Venta Web").tooltip():null),$("<td>").text(t.saleNumber),$("<td>").text(t.typeDocumentSale).append(""!=e?$("<button>").addClass("btn btn-success btn-sm btn-pago").append($("<i>").addClass("mdi mdi-cash-usd")).data("sale",t):""),$("<td>").text(t.cantidadProductos),$("<td>").text("$ "+t.total),$("<td>").append($("<button>").addClass("btn btn-info btn-sm").append($("<i>").addClass("mdi mdi-eye")).data("sale",t))))}),$("#lblCantidadVentas").html("Cantidad de Ventas: <strong> "+Object.keys(t).length+".</strong>"),$("#lbltotal").html("Total: <strong>$ "+a+".</strong>")}}function setToday(){var t=(new Date).toLocaleString("es-AR",{timeZone:"America/Argentina/Buenos_Aires"}).split(",")[0].split("/"),t=new Date(t[2],t[1]-1,t[0]);$("#txtStartDate, #txtEndDate").datepicker("setDate",t),$("#btnSearch").click()}function turnoActual(){showLoading(),fetch("/Sales/HistoryTurnoActual").then(t=>($(".card-body").find("div.row").LoadingOverlay("hide"),t.json())).then(t=>{removeLoading(),createTable(t)})}$(document).ready(function(){SEARCH_VIEW.searchDate(),$("#txtStartDate").datepicker({dateFormat:"dd/mm/yy"}),$("#txtEndDate").datepicker({dateFormat:"dd/mm/yy"}),fetch("/Sales/ListTypeDocumentSale").then(t=>t.json()).then(t=>{$("#cboTypeDocumentSale").append($("<option>").val("").text("")),0<t.state?0<t.object.length&&t.object.forEach(t=>{$("#cboTypeDocumentSale").append($("<option>").val(t.idTypeDocumentSale).text(t.description))}):swal("Lo sentimos",t.message,"error")});var t=$("#txtSaleNumberByClient").text().trim();""!=t&&($("#cboSearchBy").val("number"),SEARCH_VIEW.searchSale(),$("#txtSaleNumberSearch").val(t),$("#btnSearch").click()),healthcheck()}),$("#cboSearchBy").change(function(){"date"==$("#cboSearchBy").val()?SEARCH_VIEW.searchDate():SEARCH_VIEW.searchSale()}),$("#btnSearch").click(function(){if("date"==$("#cboSearchBy").val()){if(""==$("#txtStartDate").val().trim())return void toastr.warning("","Debes ingresar al menos la fecha de inicio.")}else if(""==$("#txtSaleNumberSearch").val().trim())return void toastr.warning("","Debes ingresar el número de venta");var t=$("#txtSaleNumberSearch").val(),e=$("#txtStartDate").val(),a=(""==$("#txtEndDate").val().trim()&&$("#txtEndDate").datepicker("setDate",e),$("#txtEndDate").val().trim()),o=$(".filtro-presupuesto:checked").attr("id");showLoading(),fetch(`/Sales/History?saleNumber=${t}&startDate=${e}&endDate=${a}&presupuestos=`+o).then(t=>t.json()).then(t=>{removeLoading(),createTable(t)})}),$("#tbsale tbody").on("click",".btn-pago",function(){rowSelectedHistoric=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var e=$(this).data("sale");$("#modalPago").modal("show"),$("#txtTotalParcial").val(e.total),$("#btnFinalizar").click(function(){var t=$("#cboTypeDocumentSale").val();if(""==t)return toastr.warning("Debe completar la forma de pago",""),!1;fetch(`/Sales/UpstatSale?idSale=${e.idSale}&formaPago=`+t).then(t=>{$("#modalPago").modal("hide"),swal("Exitoso!","Se ha modificado la venta!","success"),$("#btnSearch").click()})})}),$("#tbsale tbody").on("click",".btn-info",function(){var t=$(this).data("sale");$("#txtRegistrationDate").val(t.registrationDate),$("#txtSaleNumber").val(t.saleNumber),$("#txtRegisterUser").val(t.registrationUser),$("#txtDocumentType").val(t.typeDocumentSale),$("#txtClientName").val(t.clientName),$("#txtTotal").val(t.total),$("#txtDescRec").val(t.descuentoRecargo),idSale=t.idSale,$("#tbProducts tbody").html(""),t.detailSales.forEach(t=>{$("#tbProducts tbody").append($("<tr>").append($("<td>").text(t.descriptionProduct),$("<td>").text(t.quantity),$("<td>").text("$ "+t.price+" ").append(null!=t.promocion?$("<i>").addClass("mdi mdi-percent").attr("data-toggle","tooltip").attr("title",t.promocion):""),$("<td>").text("$ "+t.total)))}),$("#linkPrint").attr("href","/Sales/ShowPDFSale?idSale="+t.saleNumber),$("#modalData").modal("show")}),$("#printTicket").click(function(){showLoading(),fetch("/Sales/PrintTicket?idSale="+idSale,{}).then(t=>t.json()).then(t=>{t.state?($("#modalData").modal("hide"),isHealthySaleHistory&&""!=t.object.nombreImpresora&&(printTicket(t.object.ticket,t.object.nombreImpresora,t.object.imagesTicket),swal("Exitoso!","Ticket impreso!","success"),removeLoading())):swal("Lo sentimos","Error al generar el ticket "+t.message,"error")})});let originalTab=document.getElementById("nuevaVenta"),AllTabsForSale=[],buttonCerrarTab='<button class="close" type="button" title="Cerrar tab">×</button>',tabID=0,formaDePagoID=0,promociones=[],productSelected=null,formasDePagosList=[],isHealthySale=!1,ajustes=null,ProducstTab={idTab:0,products:[]};function inicializarConsultarPrecios(){$("#modalConsultarPrecio").on("shown.bs.modal",function(){$("#cboSearchProductConsultarPrecio").data("select2")||funConsultarPrecio(),setTimeout(function(){$("#cboSearchProductConsultarPrecio").select2("open")},100)}),$("#modalConsultarPrecio").on("hidden.bs.modal",function(){resetModaConsultarPreciol()})}async function healthcheck(){(isHealthySale=await getHealthcheck())?document.getElementById("lblErrorPrintService").style.display="none":document.getElementById("lblErrorPrintService").style.display=""}function changeCboTypeDocumentSaleParcial(t,e){var a=formasDePagosList.find(t=>t.idTypeDocumentSale==e);null!=a&&($("#cboFactura"+t).val(a.tipoFactura),$("#cboFactura"+t).trigger("change"))}function validateTipoFacturaAndMonto(t){var e=$("#cboFactura"+t).val(),a=$("#txtTotalParcial"+t).val();0==e?updateUIFormaDePago(!0,!1,!0):(1==e||2==e)&&parseFloat(a)>parseFloat(ajustes.minimoIdentificarConsumidor)?updateUIFormaDePago(!0,!0,!0):updateUIFormaDePago(!1,!1,!1),$("#btnFinalizarVentaParcial").prop("disabled",null==$("#cboTypeDocumentSaleParcial"+t).val())}function updateUIFormaDePago(t,e,a){$("#btnFinalizarVentaParcial").prop("disabled",t),$("#txtMinimoIdentificarConsumidor").toggle(e),document.getElementById("divClienteSeleccionado").style.display=a?"":"none"}function formatResults(t){return t.loading?t.text:$(`<table width="90%">
            <tr>
                <td style="width:60px">
                    <img style="height:60px;width:60px;margin-right:10px" src="data:image/png;base64,${t.photoBase64}"/>
                </td>
                <td>
                    <p style="font-weight: bolder;margin:2px">${t.text}</p>
                    <p>$ ${formatNumber(t.price)}</p>
                </td>
            </tr>
         </table>`)}function formatResultsBuscarPrecio(t){return t.loading?t.text:$(`<table width="90%">
            <tr>
                <td>
                    <p style="font-weight: bolder;margin:2px">${t.text}</p>
                </td>
            </tr>
         </table>`)}function formatResultsClients(t){return t.loading?t.text:$(`<table width="100%">
            <tr>
                <td class="col-sm-8">
                    <p style="font-weight: bolder;margin:2px">${t.text}</p>
                    <em style="font-weight: bolder;margin:2px">${t.cuil}</em>
                </td>
                <td class="col-sm-4">
                    <p style="font-weight: bolder;" class="${t.color}">${t.total}</p>
                </td>
            </tr>
         </table>`)}function showProducts_Prices(e,t){let a=0,o=0,i=0,n=0;$("#tbProduct"+e+" tbody").html(""),t.products.forEach(t=>{t.row=i,a+=parseFloat(t.total),o+=parseFloat(t.total),$("#tbProduct"+e+" tbody").append($("<tr>").append($("<td>").append($("<button>").addClass("btn btn-danger btn-delete btn-sm delete-item-"+e).append($("<i>").addClass("mdi mdi-trash-can")).data("idproduct",t.idproduct).data("idTab",e).data("row",i)),$("<td>").text(t.descriptionproduct),$("<td>").text(t.quantity),$("<td>").text("$ "+t.price),$("<td>").text("$ "+t.total),$("<td>").append(null!=t.promocion?$("<i>").addClass("mdi mdi-percent").attr("data-toggle","tooltip").attr("title",t.promocion):""))),null!=t.diferenciapromocion&&(n+=-1*parseFloat(t.diferenciapromocion),o+=parseFloat(t.diferenciapromocion)),i++}),$("#txtTotal"+e).val("$ "+formatNumber(a)),$("#txtTotal"+e).attr("totalReal",parseFloat(a).toFixed(2)),$("#txtPromociones"+e).html("$ "+formatNumber(n)),$("#txtSubTotal"+e).html("$ "+formatNumber(o)),$("#txtSubTotal"+e).attr("subTotalReal",parseFloat(a).toFixed(2)),$("#lblCantidadProductos"+e).html("Cantidad de Articulos: <strong> "+t.products.length+"</strong>")}function cleanSaleParcial(){$("#cboTypeDocumentSaleParcial").val(""),$("#cboFactura").val(""),$("#txtClienteParaFactura").attr("cuil",""),$("#txtClienteParaFactura").attr("idCliente",""),document.getElementById("divClienteSeleccionado").style.display="none";for(let t=1;t<formaDePagoID+1;t++){var e=document.getElementById("nuevaFormaDePago"+t);null!=e&&e.remove()}formaDePagoID=0}function calcularSuma(){var t,e,a=getSumaSubTotales();return 0!==a?(t=0<a?"FALTA":"SOBRA",e=Math.abs(a),$("#txtSumaSubtotales").html(t+` <strong>$ ${e}</strong>`).show()):$("#txtSumaSubtotales").hide(),a}function calcularMinimoIdentificarConsumidor(t){""!=ajustes.minimoIdentificarConsumidor&&parseFloat(t)>parseFloat(ajustes.minimoIdentificarConsumidor)?($("#txtMinimoIdentificarConsumidor").html("El total supera el minimo para identificar al consumidor. Debe ingresar el CUIL / CUIT / DNI si va a facturarlo."),$("#txtMinimoIdentificarConsumidor").show()):$("#txtMinimoIdentificarConsumidor").hide()}function getSumaSubTotales(){var t=document.querySelectorAll(".inputSubtotal");let e=0;t.forEach(function(t){t=parseFloat(t.value).toFixed(2);!isNaN(t)&&0<t&&(e+=parseFloat(t))});t=$("#txtTotalView").val();return parseFloat(t)-parseFloat(e)}function getVentaForRegister(){let e=getTabActiveId();var t=AllTabsForSale.find(t=>t.idTab==e).products,a=$("#txtDescRec"+e).attr("totalDescRec");let o=$("#txtTotalParcial").val(),i=[];""==$("#cboCliente"+e).val()?$(".cboFormaDePago").each(function(t){t={total:parseFloat((0===t?$("#txtTotalParcial"):$("#txtTotalParcial"+t)).val()).toFixed(2),formaDePago:(0===t?$("#cboTypeDocumentSaleParcial"):$("#cboTypeDocumentSaleParcial"+t)).val()};i.push(t)}):o=$("#txtSubTotal"+e).attr("subTotalReal");var n=$("#txtClienteParaFactura").attr("cuil"),r=$("#txtClienteParaFactura").attr("idCliente");return{idTypeDocumentSale:$("#cboTypeDocumentSaleParcial").val(),clientId:""!=$("#cboCliente"+e).val()?$("#cboCliente"+e).val():null,total:parseFloat(o).toFixed(2),detailSales:t,tipoMovimiento:""!=$("#cboCliente"+e).val()?2:null,imprimirTicket:document.querySelector("#cboImprimirTicket").checked,multiplesFormaDePago:i!=[]?i:null,descuentorecargo:null!=a?a.replace(".",","):null,idClienteFactura:""!=r?parseInt(r):null,cuilFactura:""!=n?n:null}}function registrationSale(a){showLoading();let o=getVentaForRegister();fetch("/Sales/RegisterSale",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(o)}).then(t=>t.json()).then(t=>{var e;removeLoading(),t.state?(null!=(e=document.getElementById("profile-tab"+a).querySelector("span"))&&(e.textContent=t.object.saleNumber),null!=t.object.idSale?$("#btnImprimirTicket"+a).attr("idSale",t.object.idSale):(e=t.object.idSaleMultiple.slice(0,-1),$("#btnImprimirTicket"+a).attr("idSalesMultiple",e)),AllTabsForSale=AllTabsForSale.filter(t=>t.idTab!=a),cleanSaleParcial(),2<$(".tab-venta").length&&(e=document.getElementsByClassName("tab-venta")[0].getAttribute("data-bs-target"),$("#btnAgregarProducto"+e[e.length-1]).is(":disabled"))&&($(e).remove(),document.getElementsByClassName("li-tab")[0].remove()),disableAfterVenta(a),isHealthySale&&o.imprimirTicket&&null!=t.object.nombreImpresora&&""!=t.object.nombreImpresora&&null!=t.object.ticket&&""!=t.object.ticket&&printTicket(t.object.ticket,t.object.nombreImpresora,t.object.imagesTicket),newTab()):swal("Lo sentimos","La venta no fué registrada. Error: "+t.message,"error")})}function disableAfterVenta(t){$("#btnAgregarProducto"+t).prop("disabled",!0),$("#cboSearchProduct"+t).prop("disabled",!0),$("#cboDescRec"+t).prop("disabled",!0),$("#txtPeso"+t).prop("disabled",!0),$("#cboCliente"+t).prop("disabled",!0),$(".delete-item-"+t).prop("disabled",!0),$("#btnFinalizeSaleParcial"+t).prop("disabled",!0),$("#btnFinalizeSaleParcial"+t).hide(),$("#btnImprimirTicket"+t).prop("hidden",!1)}function resetModaConsultarPreciol(){$("#cboSearchProductConsultarPrecio").val(null).trigger("change"),$("#txtPrecioConsultarPrecio").val(""),$("#imgProductConsultarPrecio").attr("src",""),$("#lblProductName").text("")}function funConsultarPrecio(){$("#cboSearchProductConsultarPrecio").select2({ajax:{url:"/Sales/GetProductsVerPrecios",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(t){return{search:t.term}},processResults:function(t){return{results:t.map(t=>({id:t.idProduct,text:t.description,category:t.idCategory,photoBase64:t.photoBase64,price:t.price,tipoVenta:t.tipoVenta}))}}},placeholder:"Buscando producto...",minimumInputLength:2,templateResult:formatResultsBuscarPrecio,allowClear:!0,dropdownParent:$("#modalConsultarPrecio .modal-content")}),$("#cboSearchProductConsultarPrecio").on("select2:select",function(t){t=t.params.data;productSelected=t,$("#txtPrecioConsultarPrecio").val(t.price),$("#lblProductName").text(t.text),$("#imgProductConsultarPrecio").attr("src","data:image/png;base64,"+t.photoBase64)})}function newTab(){tabID++,$("#tab-list").append($('<li class="nav-item li-tab" role="presentation">    <button class="nav-link tab-venta" id="profile-tab'+tabID+'" data-bs-toggle="tab" data-bs-target="#tab'+tabID+'" type="button" role="tab" aria-controls="tab'+tabID+'" aria-selected="false">     <span>Nueva venta</span> <a class="close" type="button" title="Cerrar tab" id="cerrarTab'+tabID+'">&nbsp; ×</a>   </button>   </li>')),$("#tab-content").append($('<div class="tab-pane fade" id="tab'+tabID+'">    </div>'));var t=originalTab.cloneNode(!0),t=(t.id="nuevaVenta"+tabID,t.querySelector("#cboSearchProduct").id="cboSearchProduct"+tabID,t.querySelector("#tbProduct").id="tbProduct"+tabID,t.querySelector("#txtTotal").id="txtTotal"+tabID,t.querySelector("#btnFinalizeSaleParcial").id="btnFinalizeSaleParcial"+tabID,t.querySelector("#cboCliente").id="cboCliente"+tabID,t.querySelector("#txtPeso").id="txtPeso"+tabID,t.querySelector("#btnAgregarProducto").id="btnAgregarProducto"+tabID,t.querySelector("#lblCantidadProductos").id="lblCantidadProductos"+tabID,t.querySelector("#cboDescRec").id="cboDescRec"+tabID,t.querySelector("#txtSubTotal").id="txtSubTotal"+tabID,t.querySelector("#txtPromociones").id="txtPromociones"+tabID,t.querySelector("#txtDescRec").id="txtDescRec"+tabID,t.querySelector("#btnImprimirTicket").id="btnImprimirTicket"+tabID,$("#tab"+tabID).append(t),$("#btnFinalizeSaleParcial"+tabID).attr("tabId",tabID),$("#cboDescRec"+tabID).attr("tabId",tabID),{idTab:tabID,products:[]});AllTabsForSale.push(t),addFunctions(tabID),lastTab(),$("#cboSearchProduct"+tabID).val("").trigger("change"),$("#cboSearchProduct"+tabID).select2("open")}function addFunctions(n){$("#btnImprimirTicket"+n).on("click",function(){var t=$("#btnImprimirTicket"+n).attr("idsale");showLoading(),null!=t?fetch("/Sales/PrintTicket?idSale="+t).then(t=>t.json()).then(t=>{removeLoading(),isHealthySale&&null!=t.object.nombreImpresora&&""!=t.object.nombreImpresora&&null!=t.object.ticket&&""!=t.object.ticket&&printTicket(t.object.ticket,t.object.nombreImpresora),swal("Exitoso!","Ticket impreso!","success")}):(t=$("#btnImprimirTicket"+n).attr("idSalesMultiple").split(",").map(Number).map(t=>"idSales="+t).join("&"),fetch("/Sales/PrintMultiplesTickets?"+t).then(t=>t.json()).then(t=>{removeLoading(),isHealthySale&&null!=t.object.nombreImpresora&&""!=t.object.nombreImpresora&&null!=t.object.ticket&&""!=t.object.ticket&&printTicket(t.object.ticket,t.object.nombreImpresora),swal("Exitoso!","Ticket impreso!","success")}))}),$("#tbProduct"+n+" tbody").on("dblclick","tr",async function(){let e=$(this).index(),a=AllTabsForSale.find(t=>t.idTab==n),o=a.products.filter(t=>t.row==e);swal({title:"Cambio de precio",text:o[0].descriptionproduct+" ($"+o[0].price+")",type:"input",showCancelButton:!0,closeOnConfirm:!1,inputPlaceholder:"ingrese el nuevo precio"},async function(t){return!!await validateCode()&&!1!==t&&(""===t?(toastr.warning("","debes ingresar el monto"),!1):(t=parseFloat(t).toFixed(2),isNaN(t)?(toastr.warning("","debes ingresar un valor numérico"),!1):(o[0].price=t,o[0].total=(t*parseFloat(o[0].quantity)).toFixed(2),showProducts_Prices(n,a),void swal.close())))})}),$("#txtPeso"+n).on("keypress",function(t){""!=$("#txtPeso"+n).val()&&13===t.which&&($(this).attr("disabled","disabled"),agregarProductoEvento(n),$("#txtPeso"+n).val(""),$(this).removeAttr("disabled"))}),$("#cboDescRec"+n).change(function(){var t,e=$(this).attr("tabId"),a=$("#txtSubTotal"+e).attr("subTotalReal");""!=a&&(t=$("#cboDescRec"+e).val(),t=parseFloat(a*(t/100)),$("#txtDescRec"+n).html("$ "+t.toFixed(2)),$("#txtDescRec"+n).attr("totalDescRec",t.toFixed(2)),$("#txtTotal"+e).val("$ "+parseFloat(parseFloat(a)+t).toFixed(2)),$("#txtTotal"+e).attr("totalReal",parseFloat(parseFloat(a)+t).toFixed(2)))}),$("#cboCliente"+n).select2({ajax:{url:"/Sales/GetClientes",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(t){return{search:t.term}},processResults:function(t){return{results:t.map(t=>({id:t.idCliente,text:t.nombre,total:t.total,cuil:t.cuil,color:t.color}))}}},placeholder:"Buscando cliente...",minimumInputLength:3,templateResult:formatResultsClients,allowClear:!0}),$("#cboCliente"+n).on("select2:select",function(t){t.params.data}),$("#cboSearchProduct"+n).select2({ajax:{url:"/Sales/GetProducts",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(t){return{search:t.term}},processResults:function(t){return{results:t.map(t=>({id:t.idProduct,text:t.description,category:t.idCategory,photoBase64:t.photoBase64,price:t.price,tipoVenta:t.tipoVenta,categoryProducty:t.categoryProducty}))}}},placeholder:"Buscando producto...",minimumInputLength:3,templateResult:formatResults,allowClear:!0}),$("#cboSearchProduct"+n).on("select2:select",function(t){let e=t.params.data,a=(productSelected=e,0);var o,t=AllTabsForSale.find(t=>t.idTab==n);if(0!==t.products.length&&1==(o=t.products.filter(t=>t.idproduct==e.id&&null==t.promocion&&2==e.tipoVenta)).length&&(a=o[0].quantity,t.products.splice(o[0].row,1)),2==e.tipoVenta)return(""==(o=$("#txtPeso"+n).val())||!1!==o&&!isNaN(o))&&(setNewProduct(o=""==o?1:parseFloat(o),a,e,t,n),void $("#txtPeso"+n).val(""));let i=document.getElementById("txtPeso"+n);window.setTimeout(()=>i.focus(),0)}),$("#btnAgregarProducto"+n).on("click",function(){agregarProductoEvento(n)})}function agregarProductoEvento(e){var t=parseFloat($("#txtPeso"+e).val());if(!1===t||""===t||isNaN(t))return!1;if(null===productSelected)return!1;let a=0;var o,i=AllTabsForSale.find(t=>t.idTab==e);0!==i.products.length&&1==(o=i.products.filter(t=>t.idproduct==productSelected.id&&null==t.promocion)).length&&(a=o[0].quantity,i.products.splice(o[0].row,1)),setNewProduct(t,a,productSelected,i,e)}function setNewProduct(t,e,a,o,i){t=parseFloat(t)+parseFloat(e),a.total=t*parseFloat(a.price),a.quantity=Math.trunc(1e4*t)/1e4,a=applyPromociones(t,a,o),e=new Producto;e.idproduct=a.id,e.descriptionproduct=a.text,e.quantity=a.quantity,e.price=formatNumber(a.price),e.total=formatNumber(a.total),e.tipoVenta=a.tipoVenta,e.categoryProducty=a.categoryProducty,a.promocion&&(e.promocion=a.promocion,e.diferenciapromocion=a.diferenciapromocion.toFixed(2).toString()),o.products.push(e),showProducts_Prices(i,o),$("#cboSearchProduct"+i).val("").trigger("change"),$("#cboSearchProduct"+i).select2("open"),$("#txtPeso"+i).val("")}function formatNumber(t){return"string"==typeof t&&(t=parseFloat(t.replace(",","."))),Number.isInteger(t)?t.toString():t.toFixed(2)}function applyPromociones(t,e,a){let o=(new Date).getDay().toString();var i=promociones.find(t=>t.dias.includes(o)&&!t.idProducto&&0===t.idCategory.length),n=promociones.find(t=>t.idCategory.includes(e.category)&&!t.idProducto&&(!t.dias.length||t.dias.includes(o))),r=promociones.find(t=>parseInt(t.idProducto)===e.id);return r?e=applyForProduct(r,t,e,a):n?(e=calcularPrecioPorcentaje(e,n,t)).promocion=n.nombre:i&&((e=calcularPrecioPorcentaje(e,i,t)).promocion=i.nombre),e}function containsCategoria(t,e){return t.includes(e)}function containsDias(t){var e=(new Date).getDay().toString();return t.includes(e)}function applyForProduct(t,e,a,o){let i=!1;if(null===t.operador&&null!==t.precio)a=calcularPrecioPorcentaje(a,t,e),i=!0;else if(null!==t.operador)switch(t.operador){case 0:if(e<t.cantidadProducto)return a;var n=e%t.cantidadProducto;if(0==n)a=calcularPrecioPorcentaje(a,t,e),i=!0;else if(0<n){var r=parseFloat(a.price);if(isNaN(r))return a;var l=new Producto,r=(l.idproduct=a.id,l.descriptionproduct=a.text,l.categoryProducty=a.categoryProducty,l.quantity=n,l.price=r.toFixed(2).toString(),l.total=(r*n).toFixed(2).toString(),o.products.push(l),e-n);a=calcularPrecioPorcentaje(a,t,r),i=!0}break;case 1:e>t.cantidadProducto&&(a=calcularPrecioPorcentaje(a,t,e),i=!0)}return i&&(a.promocion=t.nombre),a}function calcularPrecioPorcentaje(t,e,a){e=null!==e.precio?e.precio:parseFloat(t.price)*(1-e.porcentaje/100);return t.diferenciapromocion=parseFloat(t.price)*a-e*a,t.total=e*a,t.price=e,t.quantity=a,t}function lastTab(){$("#tab-list button:last").tab("show")}function getTabActiveId(){var t=document.getElementsByClassName(" nav-link tab-venta active")[0].id;return t[t.length-1]}async function validateCode(){return!ajustes.needControl||new Promise((e,a)=>{swal({title:"Codigo de Seguridad",type:"input",showCancelButton:!0,closeOnConfirm:!0,inputPlaceholder:"password..."},function(t){!1===t?e(!1):fetch("/Admin/ValidateSecurityCode?encryptedCode="+t,{method:"POST"}).then(t=>t.json()).then(t=>{t.state?e(t.object):e(!1),swal.close()}).catch(t=>{a(!1)})})})}$(document).ready(function(){fetch("/Sales/ListTypeDocumentSale").then(t=>t.json()).then(t=>{t.state?(formasDePagosList=t.object,0<t.object.length&&t.object.forEach(t=>{$("#cboTypeDocumentSaleParcial").append($("<option>").val(t.idTypeDocumentSale).text(t.description))})):swal("Lo sentimos",t.message,"error")}),fetch("/Admin/GetPromocionesActivas").then(t=>t.json()).then(t=>{t.state?promociones=t.object:swal("Lo sentimos",t.message,"error")}),fetch("/Admin/GetAjustesVentas").then(t=>t.json()).then(t=>{t.state?(ajustes=t.object,document.getElementById("cboImprimirTicket").checked=ajustes.imprimirDefault):swal("Lo sentimos",t.message,"error")}),newTab(),healthcheck(),inicializarConsultarPrecios()}),$("#btnBuscarCliente").on("click",function(){$("#modalDatosFactura").modal("show"),inicializarClientesFactura()}),$("#cboTypeDocumentSaleParcial").change(function(){changeCboTypeDocumentSaleParcial("",$(this).val())}),$("#cboFactura").change(function(){validateTipoFacturaAndMonto("")}),$("#txtTotalParcial").change(function(){validateTipoFacturaAndMonto("")}),$(document).on("select2:open",()=>{document.querySelector(".select2-search__field").focus()}),$(document).on("click","button.btn-delete",async function(){if(!await validateCode())return!1;let e=$(this).data("idTab");var t=$(this).data("row"),a=AllTabsForSale.find(t=>t.idTab==e);a.products.splice(t,1),showProducts_Prices(e,a)}),$(document).on("click","button.finalizarSaleParcial",function(){cleanSaleParcial();let e=$(this).attr("tabId");var t;AllTabsForSale.find(t=>t.idTab==e).products.length<1?toastr.warning("","Debe ingresar productos"):null!=(""!=$("#cboCliente"+e).val()?$("#cboCliente"+e).val():null)?(t=$("#cboCliente"+e)[0].innerText,swal({title:`¿Desea agregar la venta a la cuenta corriente de ${t}?`,text:"",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-info",confirmButtonText:"Si, Agregar",cancelButtonText:"No, Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&registrationSale(e)})):(calcularMinimoIdentificarConsumidor(t=$("#txtTotal"+e).attr("totalReal")),$("#txtTotalView").val(t),$("#txtTotalParcial").val(t),$("#txtSumaSubtotales").val(0),$("#btnCalcSubTotales").attr("idFormaDePago",0),$("#txtTotalParcial").on("change",function(){calcularSuma()}),$("#btnCalcSubTotales").on("click",function(){var t=getSumaSubTotales(),e=$("#txtTotalParcial").val();$("#txtTotalParcial").val(parseFloat(t).toFixed(2)+parseFloat(e).toFixed(2)),calcularSuma()}),$("#modalDividirPago").removeAttr("idTab"),$("#modalDividirPago").attr("idTab",e),$("#modalDividirPago").modal("show"))}),$(document).on("click","button.btnAddFormaDePago",function(){formaDePagoID++,$("#formaDePagoPanel").append($('<div class="form-row" id="formaPago'+formaDePagoID+'"></div>'));var t=document.getElementById("formaDePagoPanel").cloneNode(!0);return t.id="nuevaFormaDePago"+formaDePagoID,t.querySelector("#txtTotalParcial").id="txtTotalParcial"+formaDePagoID,t.querySelector("#cboTypeDocumentSaleParcial").id="cboTypeDocumentSaleParcial"+formaDePagoID,t.querySelector("#btnAddNuevaFormaDePago").id="btnAddNuevaFormaDePago"+formaDePagoID,t.querySelector("#cboFactura").id="cboFactura"+formaDePagoID,$("#rowDividirPago").append(t),$("#txtTotalParcial"+formaDePagoID).val(0),$("#txtTotalParcial"+formaDePagoID).on("change",function(t){calcularSuma()}),$("#cboFactura"+formaDePagoID).change(function(){validateTipoFacturaAndMonto("")}),$("#txtTotalParcial"+formaDePagoID).change(function(){validateTipoFacturaAndMonto("")}),$("#cboTypeDocumentSaleParcial"+formaDePagoID).change(function(){var t=$(this).val();changeCboTypeDocumentSaleParcial(formaDePagoID,t)}),$("#cboTypeDocumentSaleParcial"+formaDePagoID).trigger("change"),!1}),$("#btnFinalizarVentaParcial").on("click",function(){$("#btnFinalizarVentaParcial").closest("div.card-body").LoadingOverlay("show"),0!==$(".cboFormaDePago").filter(function(){return""===$(this).val()}).length?toastr.warning("Debe completaro el campo Forma de Pago",""):0<getSumaSubTotales()?toastr.warning("La suma de los sub totales no es igual al total.",""):($("#modalDividirPago").modal("hide"),registrationSale($("#modalDividirPago").attr("idtab")))}),document.onkeyup=async function(t){var e;return t.altKey&&78==t.which?(newTab(),!1):113==t.which?(e=getTabActiveId(),$("#cboSearchProduct"+e).select2("close"),$("#btnFinalizeSaleParcial"+e).click(),!1):120==t.which?($("#modalConsultarPrecio").modal("show"),!1):void 0},$("#btn-add-tab").click(function(){newTab()}),$("#tab-list").on("click",".close",async function(){if(!await validateCode())return!1;var t=$(this).parents("button").attr("data-bs-target");$(this).parents("li").remove(),$(t).remove(),(1===$(".nav-item").length?newTab:lastTab)()});class Producto{idproduct=0;descriptionproduct="";quantity=0;price=0;total=0;promocion=null;diferenciapromocion=null;tipoVenta=0;categoryProducty=""}(o=>{o(window).stellar({responsive:!0,parallaxBackgrounds:!0,parallaxElements:!0,horizontalScrolling:!1,hideDistantElements:!1,scrollProperty:"scroll"}),o(".js-fullheight").css("height",o(window).height()),o(window).resize(function(){o(".js-fullheight").css("height",o(window).height())}),setTimeout(function(){0<o("#ftco-loader").length&&o("#ftco-loader").removeClass("show")},1),o.Scrollax(),o(".home-slider").owlCarousel({loop:!0,autoplay:!0,margin:0,animateOut:"fadeOut",animateIn:"fadeIn",nav:!1,autoplayHoverPause:!1,items:1,navText:["<span class='ion-md-arrow-back'></span>","<span class='ion-chevron-right'></span>"],responsive:{0:{items:1},600:{items:1},1e3:{items:1}}}),o(".carousel-testimony").owlCarousel({center:!0,loop:!0,items:1,margin:30,stagePadding:0,nav:!1,navText:['<span class="ion-ios-arrow-back">','<span class="ion-ios-arrow-forward">'],responsive:{0:{items:1},600:{items:3},1e3:{items:3}}}),o("nav .dropdown").hover(function(){var t=o(this);t.addClass("show"),t.find("> a").attr("aria-expanded",!0),t.find(".dropdown-menu").addClass("show")},function(){var t=o(this);t.removeClass("show"),t.find("> a").attr("aria-expanded",!1),t.find(".dropdown-menu").removeClass("show")}),o("#dropdown04").on("show.bs.dropdown",function(){console.log("show")}),o(window).scroll(function(){var t=o(this).scrollTop(),e=o(".ftco_navbar"),a=o(".js-scroll-wrap");150<t&&(e.hasClass("scrolled")||e.addClass("scrolled")),t<150&&e.hasClass("scrolled")&&e.removeClass("scrolled sleep"),350<t&&(e.hasClass("awake")||e.addClass("awake"),0<a.length)&&a.addClass("sleep"),t<350&&(e.hasClass("awake")&&(e.removeClass("awake"),e.addClass("sleep")),0<a.length)&&a.removeClass("sleep")}),o("#section-counter").waypoint(function(t){var a;"down"!==t||o(this.element).hasClass("ftco-animated")||(a=o.animateNumber.numberStepFactories.separator(","),o(".number").each(function(){var t=o(this),e=t.data("number");console.log(e),t.animateNumber({number:e,numberStep:a},7e3)}))},{offset:"95%"}),o(".ftco-animate").waypoint(function(t){"down"!==t||o(this.element).hasClass("ftco-animated")||(o(this.element).addClass("item-animate"),setTimeout(function(){o("body .ftco-animate.item-animate").each(function(t){var e=o(this);setTimeout(function(){var t=e.data("animate-effect");"fadeIn"===t?e.addClass("fadeIn ftco-animated"):"fadeInLeft"===t?e.addClass("fadeInLeft ftco-animated"):"fadeInRight"===t?e.addClass("fadeInRight ftco-animated"):e.addClass("fadeInUp ftco-animated"),e.removeClass("item-animate")},50*t,"easeInOutExpo")})},100))},{offset:"95%"}),o(".smoothscroll[href^='#'], #ftco-nav ul li a[href^='#']").on("click",function(t){t.preventDefault();var e=this.hash,t=o(".navbar-toggler");o("html, body").animate({scrollTop:o(e).offset().top},700,"easeInOutExpo",function(){window.location.hash=e}),t.is(":visible")&&t.click()}),o("body").on("activate.bs.scrollspy",function(){console.log("nice")}),o(".image-popup").magnificPopup({type:"image",closeOnContentClick:!0,closeBtnInside:!1,fixedContentPos:!0,mainClass:"mfp-no-margins mfp-with-zoom",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{verticalFit:!0},zoom:{enabled:!0,duration:300}}),o(".popup-youtube, .popup-vimeo, .popup-gmaps").magnificPopup({disableOn:700,type:"iframe",mainClass:"mfp-fade",removalDelay:160,preloader:!1,fixedContentPos:!1}),o(".mouse-icon").on("click",function(t){return t.preventDefault(),o("html,body").animate({scrollTop:o(".goto-here").offset().top},500,"easeInOutExpo"),!1}),setInterval(function(){},1e3)})(jQuery);let tableDataStock,rowSelectedStock;function cargarTablaVencimientos(){$("#tbDataVencimientos").DataTable({createdRow:function(t,e,a){2==e.estado?$(t).addClass("vencidoClass"):1==e.estado?$(t).addClass("proximoClass"):$(t).addClass("aptoClass")},pageLength:25,ajax:{url:"/Inventory/GetVencimientos",type:"GET",datatype:"json"},columnDefs:[{targets:[2,4],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY"):"":t}}],columns:[{data:"idVencimiento",visible:!1,searchable:!1},{data:"estado",visible:!1,searchable:!1},{data:"fechaVencimiento"},{data:"producto"},{data:"fechaElaboracion"},{data:"lote"}],order:[[1,"desc"],[2,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Vencimientos",exportOptions:{columns:[2,3,4,5]}},"pageLength"],drawCallback:function(t){filtrarTabla()}}),tableDataStock=$("#tbDataStock").DataTable({responsive:!0,ajax:{url:"/Inventory/GetStocks",type:"GET",datatype:"json"},columns:[{data:"idStock",visible:!1,searchable:!1},{data:"producto.description"},{data:"stockActual"},{data:"stockMinimo"}],order:[[2,"asc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte categories",exportOptions:{columns:[1,2]}},"pageLength"]})}function filtrarTabla(){var t=$(".filtro-vencimientos:checked").val();$("#tbDataVencimientos tbody tr").hide(),"0"===t?$("#tbDataVencimientos tbody tr").show():"1"===t?$(".proximoClass").show():"2"===t&&$(".vencidoClass").show()}$(document).ready(function(){cargarTablaVencimientos(),$(".filtro-vencimientos").change(function(){filtrarTabla()})});let tableDataTienda,rowSelectedTienda,BASIC_MODEL_TIENDA={idTienda:0,nombre:"",idListaPrecio:1,modificationDate:null,modificationUser:null,telefono:"",direccion:"",logo:"",cuit:0,condicionIva:null,puntoVenta:null,certificadoPassword:""},openModalTienda=($(document).ready(function(){$("#general").show(),$("#facturacion").hide(),$("#carroCompras").hide(),tableDataTienda=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Tienda/GetTienda",type:"GET",datatype:"json"},columns:[{data:"idTienda",visible:!1,searchable:!1},{data:"nombre",render:function(t,e,a){let o="";return t+" "+(o=1==a.tiendaActual?'<span class="mdi mdi-star"  data-bs-toggle="tooltip" data-bs-placement="bottom" title="Actual"></span>':o)}},{data:"telefono"},{data:"direccion"},{data:"idListaPrecio",render:function(t){return"Lista "+t}},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Tiendas",exportOptions:{columns:[1,2,4,5]}},"pageLength"]})}),(t=BASIC_MODEL_TIENDA)=>{var e;$("#txtId").val(t.idTienda),$("#txtNombre").val(t.nombre),$("#cboListaPrecios").val(t.idListaPrecio),$("#txtTelefono").val(t.telefono),$("#txtDireccion").val(t.direccion),$("#imgTienda").attr("src","data:image/png;base64,"+t.photoBase64),null===t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#modalData").modal("show")});$("#btnNew").on("click",function(){openModalTienda()}),$("#btnSave").on("click",function(){var t,e,a,o=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<o.length?(t=`Debe completar los campos : "${o[0].name}"`,toastr.warning(t,""),$(`input[name="${o[0].name}"]`).focus()):((t=structuredClone(BASIC_MODEL_TIENDA)).idTienda=parseInt($("#txtId").val()),t.nombre=$("#txtNombre").val(),t.idListaPrecio=parseInt($("#cboListaPrecios").val()),t.telefono=$("#txtTelefono").val(),t.direccion=$("#txtDireccion").val(),o=document.getElementById("fileLogo"),(e=new FormData).append("Logo",o.files[0]),e.append("model",JSON.stringify(t)),$("#modalData").find("div.modal-content").LoadingOverlay("show"),o=0==t.idTienda?"/Tienda/CreateTienda":"/Tienda/UpdateTienda",a=0==t.idTienda?"POST":"PUT",0==t.idTienda?fetch(o,{method:a,body:e}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataTienda.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","La tienda fué creada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch(o,{method:a,body:e}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{$("#modalData").modal("hide"),t.state?($("#modalData").modal("hide"),swal("Exitoso!","Punto de venta fué modificado","success"),location.reload()):(rowSelectedTienda=null,swal("Lo sentimos",t.message,"error"))}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedTienda=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataTienda.row(rowSelectedTienda).data();openModalTienda(t)}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataTienda.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar tienda "${a.nombre}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Tienda/DeleteTienda?idTienda="+a.idTienda,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataTienda.row(e).remove().draw(),swal("Exitoso!","Punto de venta fué eliminado","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})});let tableDataTipoVenta,rowSelectedFormaPago,BASIC_MODEL_TIPO_VENTA={idTypeDocumentSale:0,description:"",isActive:1,web:1,tipoFactura:0},openModalTipoVenta=($(document).ready(function(){tableDataTipoVenta=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Admin/GetTipoVenta",type:"GET",datatype:"json"},columns:[{data:"idTypeDocumentSale",visible:!1,searchable:!1},{data:"description"},{data:"tipoFacturaString"},{data:"web",render:function(t){return 1==t?'<input type="checkbox" checked disabled>':'<input type="checkbox" disabled>'}},{data:"comision",render:function(t,e,a){return t?t+" %":""}},{data:"isActive",render:function(t){return 1==t?'<span class="badge badge-info">Activo</span>':'<span class="badge badge-danger">Inactivo</span>'}},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-pencil"></i></button><button class="btn btn-danger btn-delete btn-sm"><i class="mdi mdi-trash-can"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Formas de Pago",exportOptions:{columns:[1,2,3,4]}},"pageLength"]})}),(t=BASIC_MODEL_TIPO_VENTA)=>{$("#txtId").val(t.idTypeDocumentSale),$("#txtNombre").val(t.description),$("#cboState").val(t.isActive?1:0),$("#cboTipoFactura").val(t.tipoFactura),$("#cboWeb").val(t.web?1:0),$("#txtComision").val(t.comision),document.querySelector("#cboWeb").checked=t.web,$("#modalData").modal("show")});$("#btnNew").on("click",function(){openModalTipoVenta()}),$("#btnSave").on("click",function(){var t,e=$("input.input-validate").serializeArray().filter(t=>""==t.value.trim());0<e.length?(t=`Debe completar los campos : "${e[0].name}"`,toastr.warning(t,""),$(`input[name="${e[0].name}"]`).focus()):((t=structuredClone(BASIC_MODEL_TIPO_VENTA)).idTypeDocumentSale=parseInt($("#txtId").val()),t.description=$("#txtNombre").val(),t.isActive="1"===$("#cboState").val(),t.web=document.querySelector("#cboWeb").checked,t.tipoFactura=parseInt($("#cboTipoFactura").val()),t.comision=$("#txtComision").val(),$("#modalData").find("div.modal-content").LoadingOverlay("show"),0==t.idTypeDocumentSale?fetch("/Admin/CreateTipoVenta",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataTipoVenta.row.add(t.object).draw(!1),$("#modalData").modal("hide"),swal("Exitoso!","Tipo de Venta fué creada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}):fetch("/Admin/UpdateTipoVenta",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataTipoVenta.row(rowSelectedFormaPago).data(t.object).draw(!1),rowSelectedFormaPago=null,$("#modalData").modal("hide"),swal("Exitoso!","Tipo de Venta fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")}))}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedFormaPago=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataTipoVenta.row(rowSelectedFormaPago).data();openModalTipoVenta(t)}),$("#tbData tbody").on("click",".btn-delete",function(){let e,a=(e=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr"),tableDataTipoVenta.row(e).data());swal({title:"¿Está seguro?",text:`Eliminar Tipo de Venta "${a.nombre}"`,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&($(".showSweetAlert").LoadingOverlay("show"),fetch("/Admin/DeleteTipoVenta?idTypeDocumentSale="+a.idTypeDocumentSale,{method:"DELETE"}).then(t=>($(".showSweetAlert").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataTipoVenta.row(e).remove().draw(),swal("Exitoso!","Tipo de Venta  fué eliminada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$(".showSweetAlert").LoadingOverlay("hide")}))})});let tableDataTurno,rowSelectedTurno,BASIC_MODEL_TURNO={idturno:0,descripcion:"",fecha:"",horaInicio:"",horaFin:""},openModalTurno=($(document).ready(function(){tableDataTurno=$("#tbData").DataTable({responsive:!0,ajax:{url:"/turno/GetTurnos",type:"GET",datatype:"json"},columnDefs:[{targets:[1],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY"):"":t}}],columns:[{data:"idTurno",visible:!1,searchable:!1},{data:"fechaInicio"},{data:"horaInicio"},{data:"horaFin"},{data:"modificationUser"},{data:"descripcion"},{data:"total"},{defaultContent:'<button class="btn btn-primary btn-sm me-2 btn-edit"><i class="mdi mdi-eye"></i></button>',orderable:!1,searchable:!1,width:"80px"}],order:[[1,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Turnos",exportOptions:{columns:[1,2,3,4,5,6]}},"pageLength"]})}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedTurno=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataTurno.row(rowSelectedTurno).data();openModalTurno(t)}),(t=BASIC_MODEL_TURNO)=>{$("#txtId").val(t.idTurno),$("#txtDescripcion").val(t.descripcion),$("#txtFecha").val(t.fecha),$("#txtHoraInicio").val(t.horaInicio),$("#txtHoraFin").val(t.horaFin),$("#txtTotal").val(t.total),fetch("/Turno/GetOneTurno?idTurno="+t.idTurno,{method:"GET"}).then(t=>($("div.container-fluid").LoadingOverlay("hide"),t.json())).then(t=>{if(t.state){$("#contMetodosPago").empty();var e=t.object,a=document.getElementById("contMetodosPago");for(i=0;i<e.ventasPorTipoVenta.length;++i){var o=document.createElement("li");o.innerText=e.ventasPorTipoVenta[i].descripcion+": $"+e.ventasPorTipoVenta[i].total,a.appendChild(o)}}else swal("Lo sentimos",t.message,"error")}).catch(t=>{$("div.container-fluid").LoadingOverlay("hide")}),$("#modalData").modal("show")});$("#btnSave").on("click",function(){var t=structuredClone(BASIC_MODEL_TURNO);t.idTurno=parseInt($("#txtId").val()),t.descripcion=$("#txtDescripcion").val(),fetch("/Turno/UpdateTurno",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>($("#modalData").find("div.modal-content").LoadingOverlay("hide"),t.json())).then(t=>{t.state?(tableDataTurno.row(rowSelectedTurno).data(t.object).draw(!1),rowSelectedTurno=null,$("#modalData").modal("hide"),swal("Exitoso!","Turno fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{$("#modalData").find("div.modal-content").LoadingOverlay("hide")})});let tableDataVentaWeb,rowSelectedVentaWeb,productSelectedVentaWeb=null,isHealthySaleWeb=!1,formasDePagosListVentaWeb=[],BASIC_MODEL_VENTA_WEB={idVentaWeb:0,description:"",nombre:"",direccion:"",telefono:"",comentario:"",totalString:"",formaDePago:null,estado:0,detailSales:null,idTienda:0,registrationDate:null,modificationDate:null,modificationUser:null,isEdit:null,editUser:null,editText:null,editDate:null,idClienteFactura:null,cuilFactura:null,imprimirTicket:!1},openModalEditVentaWeb=($(document).ready(function(){$('[data-toggle="popover"]').popover({html:!0,trigger:"focus"}),fetch("/Sales/ListTypeDocumentSale").then(t=>t.json()).then(t=>{t.state?(formasDePagosListVentaWeb=t.object,0<t.object.length&&t.object.forEach(t=>{$("#cboTypeDocumentSale").append($("<option>").val(t.idTypeDocumentSale).text(t.description))})):swal("Lo sentimos",t.message,"error")}),tableDataVentaWeb=$("#tbData").DataTable({responsive:!0,ajax:{url:"/Shop/GetVentasWeb",type:"GET",datatype:"json"},columnDefs:[{targets:[1],render:function(t,e,a){return"display"===e||"filter"===e?t?moment(t).format("DD/MM/YYYY HH:mm"):"":t}}],columns:[{data:"idVentaWeb",visible:!1,searchable:!1},{data:"registrationDate"},{data:"nombre"},{data:"direccion"},{data:"telefono"},{data:"totalString"},{data:"estado",render:function(t){return 0==t?'<span class="badge badge-info">Nueva</span>':1==t?'<span class="badge badge-success">Finalizada</span>':2==t?'<span class="badge badge-danger">Cerrada</span>':void 0}},{defaultContent:'<button class="btn btn-primary btn-edit btn-sm me-2"><i class="mdi mdi-eye"></i></button>',orderable:!1,searchable:!1,width:"60px"}],order:[[0,"desc"]],dom:"Bfrtip",buttons:[{text:"Exportar Excel",extend:"excelHtml5",title:"",filename:"Reporte Ventas Web",exportOptions:{columns:[1,2,3,4,5,6]}},"pageLength"]}),fetch("/Tienda/GetTienda").then(t=>t.json()).then(t=>{0<t.data.length&&t.data.forEach(t=>{$("#cboTienda").append($("<option>").val(t.idTienda).text(t.nombre))})}),fetch("/Sales/ListTypeDocumentSale").then(t=>t.json()).then(t=>{0<t.state?0<t.object.length&&t.object.forEach(t=>{$("#txtFormaPago").append($("<option>").val(t.idTypeDocumentSale).text(t.description))}):swal("Lo sentimos",t.message,"error")}),healthcheck()}),$("#printTicket").click(function(){var t;showLoading(),isHealthySaleWeb&&(t=parseInt($("#txtId").val()),fetch("/Shop/PrintTicketVentaWeb?idVentaWeb="+t).then(t=>(removeLoading(),t.json())).then(t=>{t.state?($("#modalData").modal("hide"),isHealthySaleWeb&&""!=t.object.nombreImpresora&&""!=t.object.ticket&&(printTicket(t.object.ticket,t.object.nombreImpresora,t.object.imagesTicket),swal("Exitoso!","Ticket impreso!","success"))):swal("Lo sentimos","No se ha podido imprimir el ticket. Error: "+t.message,"error")}))}),(t=BASIC_MODEL_VENTA_WEB)=>{var e;$("#modalData").modal("show"),$("#btnSave").text("Guardar Cambios"),document.getElementById("divSearchproducts").style.display="none",document.querySelector("#txtNombre").disabled=!0,document.querySelector("#txtTelefono").disabled=!0,document.querySelector("#txtDireccion").disabled=!0,document.querySelector("#txtFormaPago").disabled=!0,document.querySelector("#txtComentario").disabled=!0,$("#txtId").val(t.idVentaWeb),$("#txtFecha").val(t.fecha),$("#txtTotal").val(t.total),$("#txtNombre").val(t.nombre),$("#txtTelefono").val(t.telefono),$("#txtDireccion").val(t.direccion),$("#txtFormaPago").val(t.idFormaDePago),$("#txtComentario").val(t.comentario),$("#cboState").val(t.estado),$("#cboTienda").val(t.idTienda),t.isEdit?(document.getElementById("popoverEdit").style.display="",$("#popoverEdit").attr("data-bs-content",t.editText),new bootstrap.Popover(document.getElementById("popoverEdit"),{html:!0}).setContent({".popover-body":t.editText})):document.getElementById("popoverEdit").style.display="none",document.querySelector("#cboState").disabled=0<t.estado,document.querySelector("#cboTienda").disabled=0<t.estado,document.querySelector("#btnEdit").disabled=0<t.estado,document.querySelector("#btnSave").disabled=0<t.estado,null===t.modificationUser?document.getElementById("divModif").style.display="none":(document.getElementById("divModif").style.display="",e=new Date(t.modificationDate),$("#txtModificado").val(e.toLocaleString()),$("#txtModificadoUsuario").val(t.modificationUser)),$("#tbProducts tbody").html(""),t.detailSales.forEach(t=>{addNewProduct(t.idDetailSale,t.descriptionProduct,t.quantity,t.tipoVentaString,t.price,t.total,t.idProduct)}),$("#modalData").on("shown.bs.modal",function(){select2Modal()}),$("#cboSearchProduct").on("select2:select",function(e){e=e.params.data;if(2==(productSelectedVentaWeb=e).tipoVenta){e=$("#txtPeso").val();if(""!=e&&(!1===e||isNaN(e)))return!1;var e=""==e?1:parseFloat(e),a=Number.parseFloat(productSelectedVentaWeb.price);addNewProduct(0,productSelectedVentaWeb.text,e,"U",a,a*e,productSelectedVentaWeb.id),$("#txtPeso").val("");let t=document.getElementById("txtPeso");window.setTimeout(()=>t.focus(),0),updateTotal(),void $("#cboSearchProduct").val("").trigger("change")}else{let t=document.getElementById("txtPeso");window.setTimeout(()=>t.focus(),0),updateTotal(),$("#cboSearchProduct").val("").trigger("change")}}),$("#btnAgregarProducto").on("click",function(){functionAddProducto()}),$("#txtPeso").on("keypress",function(t){""!=$("#txtPeso").val()&&13===t.which&&($(this).attr("disabled","disabled"),functionAddProducto(),$("#txtPeso").val(""),$(this).removeAttr("disabled"))})});function functionAddProducto(){var t,e=parseFloat($("#txtPeso").val());return!1!==e&&""!==e&&!isNaN(e)&&null!==productSelectedVentaWeb&&(t=Number.parseFloat(productSelectedVentaWeb.price),addNewProduct(0,productSelectedVentaWeb.text,e,"Kg",t,t*e,productSelectedVentaWeb.id),updateTotal(),void $("#cboSearchProduct").val("").trigger("change"))}function addNewProduct(t,e,a,o,i,n,r){var l=$("#divSearchproducts").is(":visible"),e=$("<tr>").append($("<td>").html('<button class="btn btn-danger btn-sm delete-row" style="padding-top: 0px;padding-bottom: 0px;">-</button>'),$("<td>").text(e),$("<td>").text(a+" / "+o),$("<td>").text("$ "+Number.parseFloat(i).toFixed(2)),$("<td>").text("$ "+Number.parseFloat(n).toFixed(2)).data("idDetailSale",t).data("idProducto",r));l||e.find(".delete-row").hide(),$("#tbProducts tbody").append(e)}function updateTotal(){let e=0;$("#tbProducts tbody tr").each(function(){var t=parseFloat($(this).find("td").eq(4).text().replace("$","").trim());e+=t}),$("#txtTotal").val(""+e.toFixed(2))}async function editarVentaWeb(){var t=structuredClone(BASIC_MODEL_VENTA_WEB);if(t.idTienda=parseInt($("#cboTienda").val()),isNaN(t.idTienda))$("#cboTienda").focus(),toastr.warning("Debe seleccionar una Tienda","");else{t.idVentaWeb=parseInt($("#txtId").val());let e=parseInt($("#cboState").val());t.estado=e,t.idFormaDePago=1==e?$("#cboTypeDocumentSale").val():parseInt($("#txtFormaPago").val()),t.imprimirTicket=document.querySelector("#cboImprimirTicket").checked,t.total=parseFloat($("#txtTotal").val()),t.comentario=$("#txtComentario").val(),t.nombre=$("#txtNombre").val(),t.telefono=$("#txtTelefono").val(),t.direccion=$("#txtDireccion").val();var o=$("#txtClienteParaFactura").attr("cuil"),i=$("#txtClienteParaFactura").attr("idCliente");t.cuilFactura=""!=o?o:null,t.idClienteFactura=""!=i?parseInt(i):null;let a=[];$("#tbProducts tbody tr").each(function(){var t=$(this),t={brandProduct:null,categoryProducty:"",descriptionProduct:t.find("td").eq(1).text(),idDetailSale:t.find("td").eq(4).data("idDetailSale"),idProduct:t.find("td").eq(4).data("idProducto"),idSale:null,idSaleNavigation:null,idVentaWeb:0,price:parseFloat(t.find("td").eq(3).text().replace("$","").trim()),producto:null,promocion:null,quantity:parseFloat(t.find("td").eq(2).text().split(" / ")[0]),tipoVenta:"Kg"==t.find("td").eq(2).text().split(" / ")[1]?1:2,tipoVentaString:t.find("td").eq(2).text().split(" / ")[1],total:parseFloat(t.find("td").eq(4).text().replace("$","").trim())};a.push(t)}),t.detailSales=a,showLoading(),fetch("/Shop/UpdateVentaWeb",{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>(removeLoading(),t.json())).then(t=>{t.state?(tableDataVentaWeb.row(rowSelectedVentaWeb).data(t.object).draw(!1),rowSelectedVentaWeb=null,$("#modalData").modal("hide"),isHealthySaleWeb&&""!=t.object.nombreImpresora&&1==e&&""!=t.object.ticket?printTicket(t.object.ticket,t.object.nombreImpresora,t.object.imagesTicket):swal("Exitoso!","La Venta Web fué modificada","success")):swal("Lo sentimos",t.message,"error")}).catch(t=>{removeLoading()})}}function select2Modal(){$("#cboSearchProduct").select2({ajax:{url:"/Sales/GetProducts",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(t){return{search:t.term}},processResults:function(t){return{results:t.map(t=>({id:t.idProduct,text:t.description,brand:t.brand,category:t.idCategory,photoBase64:t.photoBase64,price:t.price,tipoVenta:t.tipoVenta}))}}},placeholder:"Buscando producto...",minimumInputLength:2,templateResult:function(t){if(t.loading)return t.text;t=$(`<table width="90%">
                <tr>
                    <td style="width:60px">
                        <img style="height:60px;width:60px;margin-right:10px" src="data:image/png;base64,${t.photoBase64}"/>
                    </td>
                    <td>
                        <p style="font-weight: bolder;margin:2px">${t.text}</p>
                        <p>$ ${parseFloat(t.price).toFixed(2)}</p>
                    </td>
                </tr>
             </table>`);return t},allowClear:!0,dropdownParent:$("#modalData")})}async function healthcheck(){(isHealthySaleWeb=await getHealthcheck())?document.getElementById("lblErrorPrintService").style.display="none":(document.getElementById("lblErrorPrintService").style.display="",document.querySelector("#printTicket").disabled=!0)}$("#btnEdit").click(function(){let e="none"===document.getElementById("divSearchproducts").style.display;document.getElementById("divSearchproducts").style.display=e?"":"none",document.getElementById("cboSearchProduct").style.display=e?"":"none";["#txtNombre","#txtTelefono","#txtDireccion","#txtFormaPago","#txtComentario"].forEach(t=>{document.querySelector(t).disabled=!e}),$(".delete-row").each(function(){this.style.display=e?"":"none"})}),$(document).on("click",".delete-row",function(){$(this).closest("tr").remove(),updateTotal()}),$("#btnSave").on("click",function(){var t;1==parseInt($("#cboState").val())?($("#modalData").modal("hide"),$("#modalPago").modal("show"),$("#txtClienteParaFactura").attr("cuil",""),$("#txtClienteParaFactura").attr("idCliente",""),t=parseFloat($("#txtTotal").val()),$("#txtTotalFinalizarVenta").val(t),t=parseInt($("#txtFormaPago").val()),$("#cboTypeDocumentSale").val(t),$("#cboTypeDocumentSale").trigger("change")):editarVentaWeb()}),$("#btnFinalizarVenta").on("click",function(){editarVentaWeb()}),$("#tbData tbody").on("click",".btn-edit",function(){rowSelectedVentaWeb=$(this).closest("tr").hasClass("child")?$(this).closest("tr").prev():$(this).closest("tr");var t=tableDataVentaWeb.row(rowSelectedVentaWeb).data();openModalEditVentaWeb(t)}),$("#cboState").on("change",function(){"1"==$(this).val()?$("#btnSave").text("Finalizar Venta"):$("#btnSave").text("Guardar Cambios")}),$("#cboTypeDocumentSale").change(function(){let e=$(this).val();var t=formasDePagosListVentaWeb.find(t=>t.idTypeDocumentSale==e);null!=t&&($("#cboFactura").val(t.tipoFactura),$("#cboFactura").trigger("change"))}),$("#btnBuscarCliente").on("click",function(){$("#modalDatosFactura").modal("show"),inicializarClientesFactura()});let urlPrintService="https://localhost:4568";async function fetchWithTimeout(t,e={}){var{timeout:a=1e4}=e;let o=new AbortController;a=setTimeout(()=>o.abort(),a),t=await fetch(t,{...e,signal:o.signal});return clearTimeout(a),t}async function getHealthcheck(){try{var t=await fetchWithTimeout(urlPrintService+"/healthcheck",{timeout:5e3});return t.ok?!0===(await t.json()).success:(console.error("Healthcheck failed: "+t.statusText),!1)}catch(t){return"AbortError"===t.name?console.error("Healthcheck request timed out"):console.error("Error during healthcheck:",t),!1}}async function getPrinters(){try{var t,e=await fetchWithTimeout(urlPrintService+"/getprinters",{timeout:1e4});if(e.ok)return(t=await e.json()).success?t.printers:(console.error("Error fetching printers:",t.error),[]);throw new Error("Network response was not ok: "+e.statusText)}catch(t){return"AbortError"===t.name?console.error("GetPrinters request timed out"):console.error("Error fetching printers:",t),[]}}async function printTicket(t,e,a){try{var o=await fetchWithTimeout(urlPrintService+"/imprimir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nombreImpresora:e,text:t,images:a}),timeout:15e3});if(!o.ok)throw new Error("Network response was not ok: "+o.statusText);var i=await o.json();i.success?console.log("Documento enviado a la impresora con éxito"):console.error("Error al enviar el documento a la impresora:",i.error)}catch(t){"AbortError"===t.name?(alert("Error: La solicitud de impresión ha excedido el tiempo de espera."),console.error("Print request timed out")):(alert("Error al enviar el documento a la impresora: "+t.message),console.error("Error:",t))}}